import{d as Q,s as W,r as A,o as tt,x as et,b as g,e as p,f as n,h as x,u as I,H as U,p as $,n as M,F as D,q as X,g as N,j as Z,z as G,t as k,_ as ot}from"./index-0e60331d.js";import{useDatabaseStore as st}from"./database-6609ebe8.js";import{T as Y}from"./thumbs-up-a95a937c.js";import"./supabase-b4265a88.js";const nt={class:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 p-6"},at={class:"mb-8"},rt={class:"text-3xl font-bold text-gray-900 dark:text-white flex items-center"},it={class:"bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden mb-6"},lt={class:"flex"},ct={key:0,class:"flex justify-center items-center py-12"},ut={key:0,class:"bg-white dark:bg-gray-800 rounded-xl p-8 text-center shadow-md"},dt={class:"bg-gray-100 dark:bg-gray-700 p-4 rounded-full inline-flex items-center justify-center mb-4"},mt=["onClick"],gt={class:"p-4"},pt={class:"font-semibold text-lg mb-2 line-clamp-2"},vt={class:"flex items-center text-sm text-gray-600 dark:text-gray-400 mb-3"},_t={class:"mr-3"},ft={class:"flex flex-wrap gap-1 mb-3"},kt={key:0,class:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full"},yt={key:0,class:"bg-white dark:bg-gray-800 rounded-xl p-8 text-center shadow-md"},ht={class:"bg-gray-100 dark:bg-gray-700 p-4 rounded-full inline-flex items-center justify-center mb-4"},bt=["onClick"],xt={class:"p-4"},wt={class:"font-semibold text-lg mb-2 line-clamp-2"},Ct={class:"flex items-center text-sm text-gray-600 dark:text-gray-400 mb-3"},It={class:"mr-3"},St={class:"flex flex-wrap gap-1 mb-3"},At={key:0,class:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full"},Dt=Q({__name:"LikedFavoritesPage",setup(Nt){const B=W(),C=A("liked"),v=A([]),_=A([]),J=A(!0),K=()=>{var m,s,c;const i=localStorage.getItem("currentUser");if(i)try{return((m=JSON.parse(i).id)==null?void 0:m.toString())||null}catch(u){console.error("Failed to parse current user:",u)}const t=localStorage.getItem("authStore");if(t)try{return((c=(s=JSON.parse(t).user)==null?void 0:s.id)==null?void 0:c.toString())||null}catch(u){console.error("Failed to parse auth store:",u)}return console.warn("âš ï¸ æœªæ‰¾åˆ°å½“å‰ç”¨æˆ·IDï¼Œè¯·å…ˆç™»å½•"),null},E=i=>{const t=new Date(i);return t.toLocaleDateString("zh-CN")+" "+t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})},R=async()=>{try{J.value=!0;const i=st(),t=K();if(!t){console.log("ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•åŠ è½½ç‚¹èµæ”¶è—æ•°æ®"),v.value=[],_.value=[];return}console.log("å¼€å§‹åŠ è½½ç”¨æˆ·ç‚¹èµæ”¶è—æ•°æ®ï¼Œç”¨æˆ·ID:",t);let m=!1,s=null;try{if(s=await i.getClient(),s||(console.log("æ•°æ®åº“å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œå°è¯•é‡æ–°è¿æ¥..."),await i.reconnect(),s=await i.getClient()),!s)throw new Error("æ•°æ®åº“å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥");m=!0}catch(c){console.warn("âš ï¸ æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œå°è¯•ç›´æ¥è¿æ¥:",c.message);try{const{createClient:u}=await G(()=>import("./index-31c5edd2.js"),[]),y="https://aonlahundnkxuyxfsmcy.supabase.co",h="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";y&&h&&(s=u(y,h),console.log("âœ… ä½¿ç”¨ç›´æ¥è¿æ¥çš„Supabaseå®¢æˆ·ç«¯"),m=!0)}catch(u){console.warn("âš ï¸ ç›´æ¥è¿æ¥ä¹Ÿå¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨:",u.message),m=!1}}if(m&&s)try{console.log("ğŸ“Š å¼€å§‹ä»æ•°æ®åº“åŠ è½½ç‚¹èµå’Œæ”¶è—æ•°æ®...");const{data:c,error:u}=await s.from("post_likes").select(`
            post_id,
            created_at,
            posts:post_id (
              id,
              title,
              content,
              created_at,
              view_count,
              like_count,
              comment_count,
              favorite_count,
              user:user_id (
                id,
                username,
                nickname
              )
            )
          `).eq("user_id",t).order("created_at",{ascending:!1});u?(console.warn("âš ï¸ æ•°æ®åº“åŠ è½½ç‚¹èµå¤±è´¥ï¼Œåˆ‡æ¢åˆ°æœ¬åœ°å­˜å‚¨:",u.message),m=!1):(console.log("âœ… ç‚¹èµå¸–å­æ•°æ®æŸ¥è¯¢æˆåŠŸï¼Œæ•°é‡:",(c||[]).length),v.value=(c||[]).map(d=>{var a,o,f;const e=d.posts,b=((a=e.user)==null?void 0:a.nickname)||((o=e.user)==null?void 0:o.username)||"åŒ¿åç”¨æˆ·";return{id:e.id,name:e.title,provider:b,duration:"å¸–å­",rating:e.like_count||0,url:`/post/${e.id}`,matchPoints:((f=e.content)==null?void 0:f.substring(0,100))+(e.content.length>100?"...":""),type:"ç¤¾åŒºå¸–å­",interaction:{liked:!0,saved:!1,likesCount:e.like_count||0},likedUsers:["å½“å‰ç”¨æˆ·"],favoritedUsers:[],likeCount:e.like_count||0,favoriteCount:e.favorite_count||0,postDetails:{id:e.id,author:b,content:e.content,createdAt:e.created_at,viewCount:e.view_count||0,commentCount:e.comment_count||0}}}),console.log("âœ… æ•°æ®åº“ç‚¹èµå¸–å­åŠ è½½å®Œæˆï¼Œæ•°é‡:",v.value.length),console.log("ğŸ“‹ ç‚¹èµå¸–å­è¯¦æƒ…:",v.value.map(d=>({id:d.id,title:d.name,author:d.provider,likedUsers:d.likedUsers}))));const{data:y,error:h}=await s.from("post_favorites").select(`
            post_id,
            created_at,
            posts:post_id (
              id,
              title,
              content,
              created_at,
              view_count,
              like_count,
              comment_count,
              favorite_count,
              user:user_id (
                id,
                username,
                nickname
              )
            )
          `).eq("user_id",t).order("created_at",{ascending:!1});h?(console.warn("âš ï¸ æ•°æ®åº“åŠ è½½æ”¶è—å¤±è´¥ï¼Œåˆ‡æ¢åˆ°æœ¬åœ°å­˜å‚¨:",h.message),m=!1):(console.log("âœ… æ”¶è—å¸–å­æ•°æ®æŸ¥è¯¢æˆåŠŸï¼Œæ•°é‡:",(y||[]).length),_.value=(y||[]).map(d=>{var a,o,f;const e=d.posts,b=((a=e.user)==null?void 0:a.nickname)||((o=e.user)==null?void 0:o.username)||"åŒ¿åç”¨æˆ·";return{id:e.id,name:e.title,provider:b,duration:"å¸–å­",rating:e.favorite_count||0,url:`/post/${e.id}`,matchPoints:((f=e.content)==null?void 0:f.substring(0,100))+(e.content.length>100?"...":""),type:"ç¤¾åŒºå¸–å­",interaction:{liked:!1,saved:!0,likesCount:e.like_count||0},likedUsers:[],favoritedUsers:["å½“å‰ç”¨æˆ·"],likeCount:e.like_count||0,favoriteCount:e.favorite_count||0,postDetails:{id:e.id,author:b,content:e.content,createdAt:e.created_at,viewCount:e.view_count||0,commentCount:e.comment_count||0}}}),console.log("âœ… æ•°æ®åº“æ”¶è—å¸–å­åŠ è½½å®Œæˆï¼Œæ•°é‡:",_.value.length),console.log("ğŸ“‹ æ”¶è—å¸–å­è¯¦æƒ…:",_.value.map(d=>({id:d.id,title:d.name,author:d.provider,favoritedUsers:d.favoritedUsers}))))}catch(c){console.warn("âš ï¸ æ•°æ®åº“æŸ¥è¯¢å¼‚å¸¸ï¼Œåˆ‡æ¢åˆ°æœ¬åœ°å­˜å‚¨:",c.message),m=!1}if(!m){console.log("ğŸ”„ ä½¿ç”¨æœ¬åœ°å­˜å‚¨åŠ è½½ç‚¹èµæ”¶è—æ•°æ®ï¼Œå¹¶å°è¯•è·å–å¸–å­è¯¦æƒ…");const c=`edumatch_likes_${t}`,u=JSON.parse(localStorage.getItem(c)||"[]"),y=`edumatch_favorites_${t}`,h=JSON.parse(localStorage.getItem(y)||"[]"),d=async a=>{var o,f,O,z;try{console.log(`ğŸ” å°è¯•è·å–å¸–å­ ${a} çš„è¯¦ç»†ä¿¡æ¯...`);let w=await i.getClient();if(w||(console.log("ğŸ”— æ•°æ®åº“å®¢æˆ·ç«¯æœªè¿æ¥ï¼Œå°è¯•é‡æ–°è¿æ¥..."),await i.reconnect(),w=await i.getClient()),w){console.log("âœ… ä½¿ç”¨æ•°æ®åº“å­˜å‚¨å®¢æˆ·ç«¯è·å–å¸–å­è¯¦æƒ…");const{data:r,error:l}=await w.from("community_posts").select(`
                id,
                title,
                content,
                created_at,
                view_count,
                like_count,
                comment_count,
                favorite_count,
                user:user_id (
                  id,
                  username,
                  nickname
                )
              `).eq("id",a).single();if(!l&&r){const S=((o=r.user)==null?void 0:o.nickname)||((f=r.user)==null?void 0:f.username)||"åŒ¿åç”¨æˆ·";return console.log(`âœ… æˆåŠŸè·å–å¸–å­è¯¦æƒ…: ${r.title} (ä½œè€…: ${S})`),{title:r.title,author:S,content:r.content,createdAt:r.created_at,viewCount:r.view_count||0,commentCount:r.comment_count||0,likeCount:r.like_count||0,favoriteCount:r.favorite_count||0}}else console.warn("âŒ æ•°æ®åº“æŸ¥è¯¢å¤±è´¥:",l==null?void 0:l.message)}console.log("ğŸ”„ å°è¯•ç›´æ¥è¿æ¥Supabaseè·å–å¸–å­è¯¦æƒ…...");const{createClient:H}=await G(()=>import("./index-31c5edd2.js"),[]),V="https://aonlahundnkxuyxfsmcy.supabase.co",L="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(V&&L){const r=H(V,L),{data:l,error:S}=await r.from("community_posts").select(`
                id,
                title,
                content,
                created_at,
                view_count,
                like_count,
                comment_count,
                favorite_count,
                user:user_id (
                  id,
                  username,
                  nickname
                )
              `).eq("id",a).single();if(!S&&l){const T=((O=l.user)==null?void 0:O.nickname)||((z=l.user)==null?void 0:z.username)||"åŒ¿åç”¨æˆ·";return console.log(`âœ… ç›´æ¥è¿æ¥æˆåŠŸè·å–å¸–å­è¯¦æƒ…: ${l.title} (ä½œè€…: ${T})`),{title:l.title,author:T,content:l.content,createdAt:l.created_at,viewCount:l.view_count||0,commentCount:l.comment_count||0,likeCount:l.like_count||0,favoriteCount:l.favorite_count||0}}}console.log("ğŸ” å°è¯•ä»æœ¬åœ°å­˜å‚¨çš„ç¤¾åŒºå¸–å­æ•°æ®ä¸­æŸ¥æ‰¾...");const q="edumatch_community_posts",P=JSON.parse(localStorage.getItem(q)||"[]");if(P&&Array.isArray(P)){const r=P.find(l=>l.id===a);if(r)return console.log(`âœ… ä»æœ¬åœ°ç¼“å­˜ä¸­æ‰¾åˆ°å¸–å­: ${r.title}`),{title:r.title||"å­¦ä¹ ç»éªŒåˆ†äº«",author:r.author||"ç¤¾åŒºç”¨æˆ·",content:r.content||"è¿™æ˜¯ä¸€ç¯‡æ¥è‡ªç¤¾åŒºçš„å­¦ä¹ ç»éªŒåˆ†äº«",createdAt:r.created_at||new Date().toISOString(),viewCount:r.view_count||0,commentCount:r.comment_count||0,likeCount:r.like_count||0,favoriteCount:r.favorite_count||0}}}catch(w){console.warn(`âŒ è·å–å¸–å­ ${a} è¯¦æƒ…å¤±è´¥:`,w.message)}return console.log(`âš ï¸ æ— æ³•è·å–å¸–å­ ${a} çš„è¯¦æƒ…ï¼Œä½¿ç”¨é»˜è®¤å€¼`),{title:"å­¦ä¹ ç»éªŒåˆ†äº«",author:"ç¤¾åŒºç”¨æˆ·",content:"è¿™æ˜¯ä¸€ç¯‡æ¥è‡ªç¤¾åŒºçš„å­¦ä¹ ç»éªŒåˆ†äº«ï¼Œå†…å®¹æš‚æ—¶æ— æ³•åŠ è½½",createdAt:new Date().toISOString(),viewCount:0,commentCount:0,likeCount:0,favoriteCount:0}},e=u.map(async a=>{const o=await d(a.post_id);return{id:a.post_id,name:o.title,provider:o.author,duration:"å¸–å­",rating:0,url:`/post/${a.post_id}`,matchPoints:o.content.substring(0,100)+(o.content.length>100?"...":""),type:"ç¤¾åŒºå¸–å­",interaction:{liked:!0,saved:!1,likesCount:o.likeCount},likedUsers:["å½“å‰ç”¨æˆ·"],favoritedUsers:[],likeCount:o.likeCount,favoriteCount:o.favoriteCount,postDetails:{id:a.post_id,author:o.author,content:o.content,createdAt:o.createdAt,viewCount:o.viewCount,commentCount:o.commentCount}}}),b=h.map(async a=>{const o=await d(a.post_id);return{id:a.post_id,name:o.title,provider:o.author,duration:"å¸–å­",rating:0,url:`/post/${a.post_id}`,matchPoints:o.content.substring(0,100)+(o.content.length>100?"...":""),type:"ç¤¾åŒºå¸–å­",interaction:{liked:!1,saved:!0,likesCount:o.likeCount},likedUsers:[],favoritedUsers:["å½“å‰ç”¨æˆ·"],likeCount:o.likeCount,favoriteCount:o.favoriteCount,postDetails:{id:a.post_id,author:o.author,content:o.content,createdAt:o.createdAt,viewCount:o.viewCount,commentCount:o.commentCount}}});v.value=await Promise.all(e),_.value=await Promise.all(b),console.log("âœ… æœ¬åœ°å­˜å‚¨ç‚¹èµå¸–å­åŠ è½½å®Œæˆï¼Œæ•°é‡:",v.value.length),console.log("âœ… æœ¬åœ°å­˜å‚¨æ”¶è—å¸–å­åŠ è½½å®Œæˆï¼Œæ•°é‡:",_.value.length),console.log("ğŸ“‹ ç‚¹èµå¸–å­è¯¦æƒ…:",v.value.map(a=>({id:a.id,title:a.name,author:a.provider}))),console.log("ğŸ“‹ æ”¶è—å¸–å­è¯¦æƒ…:",_.value.map(a=>({id:a.id,title:a.name,author:a.provider})))}}catch(i){console.error("åŠ è½½ç”¨æˆ·ç‚¹èµæ”¶è—æ•°æ®å¤±è´¥:",i),v.value=[],_.value=[]}finally{J.value=!1}},j=i=>{B.push(`/post/${i}`)},F=i=>{C.value=i};return tt(()=>{R()}),(i,t)=>{const m=et("router-link");return g(),p("div",nt,[n("div",at,[n("h1",rt,[x(I(U),{class:"h-8 w-8 mr-3 text-red-500"}),t[2]||(t[2]=$(" ç‚¹èµæ”¶è— ",-1))]),t[3]||(t[3]=n("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"æŸ¥çœ‹ä½ ç‚¹èµå’Œæ”¶è—çš„å­¦ä¹ èµ„æº",-1))]),n("div",it,[n("div",lt,[n("button",{onClick:t[0]||(t[0]=s=>F("liked")),class:M(`flex-1 py-4 px-6 flex items-center justify-center transition-colors ${C.value==="liked"?"bg-blue-600 text-white":"hover:bg-gray-100 dark:hover:bg-gray-700"}`)},[x(I(Y),{class:"h-5 w-5 mr-2"}),t[4]||(t[4]=n("span",{class:"font-medium"},"æˆ‘çš„ç‚¹èµ",-1))],2),n("button",{onClick:t[1]||(t[1]=s=>F("favorites")),class:M(`flex-1 py-4 px-6 flex items-center justify-center transition-colors ${C.value==="favorites"?"bg-red-500 text-white":"hover:bg-gray-100 dark:hover:bg-gray-700"}`)},[x(I(U),{class:"h-5 w-5 mr-2"}),t[5]||(t[5]=n("span",{class:"font-medium"},"æˆ‘çš„æ”¶è—",-1))],2)])]),J.value?(g(),p("div",ct,[...t[6]||(t[6]=[n("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1),n("span",{class:"ml-3 text-lg text-gray-600 dark:text-gray-300"},"æ­£åœ¨åŠ è½½ç‚¹èµæ”¶è—æ•°æ®...",-1)])])):(g(),p("div",{key:C.value,class:"space-y-6"},[C.value==="liked"?(g(),p(D,{key:0},[v.value.length===0?(g(),p("div",ut,[n("div",dt,[x(I(Y),{class:"h-8 w-8 text-gray-400"})]),t[8]||(t[8]=n("h3",{class:"text-lg font-medium mb-2"},"æš‚æ— ç‚¹èµå†…å®¹",-1)),t[9]||(t[9]=n("p",{class:"text-gray-500 dark:text-gray-400 mb-6"},"æµè§ˆç¤¾åŒºå¸–å­å¹¶ç‚¹èµï¼Œè¿™é‡Œå°†æ˜¾ç¤ºä½ å–œæ¬¢çš„å†…å®¹",-1)),x(m,{to:"/community",class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors inline-block"},{default:X(()=>[...t[7]||(t[7]=[$(" å»ç¤¾åŒºçœ‹çœ‹ ",-1)])]),_:1})])):N("",!0),(g(!0),p(D,null,Z(v.value,s=>{var c;return g(),p("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 transition-all duration-150 hover:shadow-md cursor-pointer",onClick:u=>j(s.id)},[n("div",gt,[n("h3",pt,k(s.name),1),n("div",vt,[n("span",_t,"ä½œè€…ï¼š"+k(s.provider),1),n("span",null,"å‘å¸ƒæ—¶é—´ï¼š"+k(E(((c=s.postDetails)==null?void 0:c.createdAt)||s.created_at)),1)]),n("div",ft,[t[10]||(t[10]=n("span",{class:"text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full"}," ç‚¹èµå¸–å­ ",-1)),s.type?(g(),p("span",kt,k(s.type),1)):N("",!0)])])],8,mt)}),128))],64)):(g(),p(D,{key:1},[_.value.length===0?(g(),p("div",yt,[n("div",ht,[x(I(U),{class:"h-8 w-8 text-gray-400"})]),t[12]||(t[12]=n("h3",{class:"text-lg font-medium mb-2"},"æš‚æ— æ”¶è—å†…å®¹",-1)),t[13]||(t[13]=n("p",{class:"text-gray-500 dark:text-gray-400 mb-6"},"æµè§ˆç¤¾åŒºå¸–å­å¹¶æ”¶è—ï¼Œè¿™é‡Œå°†æ˜¾ç¤ºä½ ä¿å­˜çš„å†…å®¹",-1)),x(m,{to:"/community",class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors inline-block"},{default:X(()=>[...t[11]||(t[11]=[$(" å»ç¤¾åŒºçœ‹çœ‹ ",-1)])]),_:1})])):N("",!0),(g(!0),p(D,null,Z(_.value,s=>{var c;return g(),p("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 transition-all duration-150 hover:shadow-md cursor-pointer",onClick:u=>j(s.id)},[n("div",xt,[n("h3",wt,k(s.name),1),n("div",Ct,[n("span",It,"ä½œè€…ï¼š"+k(s.provider),1),n("span",null,"å‘å¸ƒæ—¶é—´ï¼š"+k(E(((c=s.postDetails)==null?void 0:c.createdAt)||s.created_at)),1)]),n("div",St,[t[14]||(t[14]=n("span",{class:"text-xs bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 px-2 py-1 rounded-full"}," æ”¶è—å¸–å­ ",-1)),s.type?(g(),p("span",At,k(s.type),1)):N("",!0)])])],8,bt)}),128))],64))]))])}}}),Et=ot(Dt,[["__file","E:/å‰ç«¯åˆçº§è¯¾ç¨‹/program/EduMatch/src/views/LikedFavoritesPage.vue"]]);export{Et as default};
