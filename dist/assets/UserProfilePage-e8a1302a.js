import{c as $,d as P,r as m,B as F,o as R,b as o,e as i,f as e,n as f,t as l,h as g,u as c,p,F as j,j as E,g as A,H as q,_ as L,D as Z,s as G,A as Q,m as B,U as W}from"./index-0e60331d.js";import{useDatabaseStore as Y}from"./database-6609ebe8.js";import{B as M}from"./book-open-67c82c70.js";import{C as ee}from"./clock-5f91b538.js";import{T as te}from"./thumbs-up-a95a937c.js";import{A as se}from"./arrow-left-38377726.js";import{M as O}from"./message-square-581d132d.js";import"./supabase-b4265a88.js";/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=$("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=$("DollarSignIcon",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=$("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=$("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=$("StarIcon",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=$("UserXIcon",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),de={class:"bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-md border border-gray-100 dark:border-gray-700 transition-transform hover:-translate-y-1"},ce={class:"p-4 border-b border-gray-100 dark:border-gray-700 relative"},ue={class:"pl-6"},ge={class:"font-bold text-lg mb-1 line-clamp-1"},xe={class:"flex items-center text-sm text-gray-500 dark:text-gray-400"},ye={class:"p-4"},ve={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 mb-4"},me={class:"flex items-start"},he={class:"text-sm text-gray-700 dark:text-gray-300"},be={class:"mb-4"},ke={class:"text-sm font-semibold text-gray-500 dark:text-gray-400 mb-2 flex items-center"},fe={class:"space-y-1"},pe={class:"line-clamp-1"},_e={key:0,class:"text-sm text-blue-500"},we={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4"},Ce={class:"flex items-center"},$e={class:"bg-gray-100 dark:bg-gray-700 p-2 rounded-lg mr-2"},Ie={class:"text-sm font-medium"},Se={class:"flex items-center"},Ue={class:"bg-gray-100 dark:bg-gray-700 p-2 rounded-lg mr-2"},De={class:"text-sm font-medium"},je={class:"flex items-center"},Ee={class:"bg-gray-100 dark:bg-gray-700 p-2 rounded-lg mr-2"},Me={class:"text-sm font-medium"},Ne={class:"flex space-x-3 mb-4"},Be=P({__name:"ResourceCard",props:{resource:{type:Object,required:!0},rank:{type:Number,required:!0}},setup(x){const k=x,b=a=>{switch(a){case 1:return"bg-yellow-500 text-white";case 2:return"bg-gray-400 text-white";case 3:return"bg-amber-700 text-white";default:return"bg-blue-500 text-white"}},v=()=>{const a=localStorage.getItem("currentUser");if(a)try{return JSON.parse(a).id.toString()}catch(r){console.error("Failed to parse current user:",r)}return"default_user"},n=()=>`resource_interaction_${v()}_${k.resource.id}`,d=m(()=>{const a=localStorage.getItem(n());return a?JSON.parse(a):{liked:!1,saved:!1,likesCount:0}});F(d,a=>{localStorage.setItem(n(),JSON.stringify(a))},{deep:!0}),R(()=>{const a=`resource_details_${k.resource.id}`;localStorage.getItem(a)||localStorage.setItem(a,JSON.stringify(k.resource))});const _=a=>{window.open(a,"_blank","noopener,noreferrer"),w()},w=()=>{try{const r=`resource_history_${v()}`,h=localStorage.getItem(r);let y=h?JSON.parse(h):[];const S=y.findIndex(U=>U.resource.id===k.resource.id);S>=0?y[S].timestamp=Date.now():(y.unshift({resource:k.resource,timestamp:Date.now()}),y.length>100&&(y=y.slice(0,100))),localStorage.setItem(r,JSON.stringify(y))}catch(a){console.error("Failed to save history:",a)}},C=()=>{d.value={...d.value,liked:!d.value.liked,likesCount:d.value.liked?d.value.likesCount-1:d.value.likesCount+1},console.log(d.value.liked?"已取消点赞":"点赞成功")},I=()=>{d.value={...d.value,saved:!d.value.saved},console.log(d.value.saved?"已取消收藏":"收藏成功")};return(a,r)=>(o(),i("div",de,[e("div",ce,[e("div",{class:f(`absolute -top-2 -left-2 w-8 h-8 rounded-full ${b(x.rank)} flex items-center justify-center font-bold text-sm z-10`)},l(x.rank),3),e("div",ue,[e("h3",ge,l(x.resource.name||x.resource.title),1),e("div",xe,[e("span",null,l(x.resource.provider),1)])])]),e("div",ye,[e("div",ve,[e("div",me,[g(c(re),{class:"h-5 w-5 text-blue-500 mr-2 flex-shrink-0 mt-0.5"}),e("p",he,l(x.resource.matchPoints),1)])]),e("div",be,[e("h4",ke,[g(c(M),{class:"h-4 w-4 mr-1"}),r[1]||(r[1]=p(" 内容大纲 ",-1))]),e("ul",fe,[(o(!0),i(j,null,E((x.resource.contentOutline||[]).slice(0,3),(h,y)=>(o(),i("li",{key:y,class:"flex items-start text-sm text-gray-700 dark:text-gray-300"},[r[2]||(r[2]=e("span",{class:"text-blue-500 mr-2"},"•",-1)),e("span",pe,l(h),1)]))),128)),(x.resource.contentOutline||[]).length>3?(o(),i("li",_e," +"+l((x.resource.contentOutline||[]).length-3)+" 更多内容 ",1)):A("",!0)])]),e("div",we,[e("div",Ce,[e("div",$e,[g(c(ee),{class:"h-4 w-4 text-gray-500 dark:text-gray-400"})]),e("div",null,[r[3]||(r[3]=e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"学习时长",-1)),e("div",Ie,l(x.resource.duration),1)])]),e("div",Se,[e("div",Ue,[g(c(ne),{class:"h-4 w-4 text-yellow-500"})]),e("div",null,[r[4]||(r[4]=e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"用户评分",-1)),e("div",De,l(x.resource.rating)+"/10",1)])]),e("div",je,[e("div",Ee,[g(c(ae),{class:"h-4 w-4 text-green-500"})]),e("div",null,[r[5]||(r[5]=e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"资源类型",-1)),e("div",Me,l(x.resource.type),1)])])]),e("div",Ne,[e("button",{onClick:C,class:f(`flex-1 flex items-center justify-center px-3 py-2 rounded-lg transition-colors ${d.value.liked?"bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300"}`)},[g(c(te),{class:f(`h-4 w-4 mr-1 ${d.value.liked?"fill-current":""}`)},null,8,["class"]),e("span",null,l(d.value.likesCount),1)],2),e("button",{onClick:I,class:f(`flex-1 flex items-center justify-center px-3 py-2 rounded-lg transition-colors ${d.value.saved?"bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300"}`)},[g(c(q),{class:f(`h-4 w-4 mr-1 ${d.value.saved?"fill-current":""}`)},null,8,["class"]),e("span",null,l(d.value.saved?"已收藏":"收藏"),1)],2)]),e("button",{onClick:r[0]||(r[0]=h=>_(x.resource.url)),class:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors hover:scale-105 active:scale-95"},[r[6]||(r[6]=p(" 立即学习 ",-1)),g(c(oe),{class:"h-4 w-4 ml-2"})])])]))}}),Oe=L(Be,[["__file","E:/前端初级课程/program/EduMatch/src/components/ResourceCard.vue"]]),Pe={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},Fe={key:0,class:"flex items-center justify-center min-h-screen"},Re={key:1,class:"flex items-center justify-center min-h-screen"},Ae={class:"text-center"},qe={class:"text-red-500 mb-4"},Le={class:"text-gray-600 dark:text-gray-300 mb-6"},Te={key:2},He={class:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700"},Je={class:"max-w-6xl mx-auto px-4 py-4"},ze={class:"bg-white dark:bg-gray-800 shadow-md"},Ve={class:"max-w-6xl mx-auto px-4 py-8"},Ke={class:"flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8"},Xe={class:"flex-shrink-0"},Ze={class:"w-24 h-24 md:w-32 md:h-32 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center"},Ge=["src","alt"],Qe={class:"flex-1 text-center md:text-left"},We={class:"mb-4"},Ye={class:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-2"},et={class:"text-gray-500 dark:text-gray-400"},tt={key:0,class:"mb-6"},st={class:"text-gray-700 dark:text-gray-300 leading-relaxed"},rt={class:"flex flex-wrap justify-center md:justify-start gap-8 mb-6"},at={class:"text-center"},ot={class:"text-2xl font-bold text-gray-900 dark:text-white"},lt={class:"text-center"},nt={class:"text-2xl font-bold text-gray-900 dark:text-white"},it={class:"text-center"},dt={class:"text-2xl font-bold text-gray-900 dark:text-white"},ct={class:"flex flex-wrap justify-center md:justify-start gap-3"},ut=["disabled"],gt={class:"max-w-6xl mx-auto px-4 py-8"},xt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md"},yt={class:"border-b border-gray-200 dark:border-gray-700"},vt={class:"flex space-x-8"},mt={class:"p-6"},ht={key:0},bt={key:0,class:"text-center py-12"},kt={key:1,class:"text-center py-12"},ft={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},pt={key:1},_t={key:0,class:"text-center py-12"},wt={key:1,class:"text-center py-12"},Ct={key:2,class:"space-y-6"},$t=["onClick"],It={class:"flex items-start justify-between mb-4"},St={class:"text-lg font-semibold text-gray-900 dark:text-white"},Ut={class:"text-sm text-gray-500 dark:text-gray-400"},Dt={class:"text-gray-700 dark:text-gray-300 mb-4 line-clamp-3"},jt={class:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400"},Et={class:"flex items-center space-x-4"},Mt={class:"flex items-center"},Nt={class:"flex items-center"},Bt=P({__name:"UserProfilePage",setup(x){const k=Z(),b=G(),v=Y(),n=m({id:"",username:"",nickname:"",email:"",avatar_url:"",bio:"",created_at:""}),d=m({resourceCount:0,postCount:0}),_=m([]),w=m([]),C=m(!0),I=m(""),a=m("resources"),r=m(!1),h=m(!1),y=Q(()=>JSON.parse(localStorage.getItem("currentUser")||"{}").id===n.value.id),S=async()=>{try{const s=k.params.userId;console.log("正在获取用户信息，用户ID:",s);const t=await v.getUserById(s);if(!t){console.error("用户不存在，用户ID:",s),I.value="用户不存在";return}n.value={...t,bio:t.bio||"这个人很懒，还没有写个人签名~"},console.log("成功获取用户信息:",n.value),await U(),await D(),y.value||await T()}catch(s){console.error("获取用户信息失败:",s),s.value="获取用户信息失败"}finally{C.value=!1}},U=async()=>{try{const[s,t]=await Promise.all([v.getUserResourceCount(n.value.id),v.getUserPostCount(n.value.id)]);d.value={resourceCount:s||0,postCount:t||0}}catch(s){console.error("获取用户统计失败:",s)}},T=async()=>{if(!y.value)try{const s=localStorage.getItem("currentUser");if(!s){r.value=!1;return}const t=JSON.parse(s);t&&t.id&&(r.value=await v.isFollowing(t.id,n.value.id))}catch(s){console.error("检查关注状态失败:",s),r.value=!1}},D=async()=>{try{const[s,t]=await Promise.all([v.getUserResources(n.value.id),v.getUserPosts(n.value.id)]);_.value=s||[],w.value=t||[]}catch(s){console.error("获取用户内容失败:",s)}},H=async()=>{if(!y.value){if(!localStorage.getItem("currentUser")){b.push("/login");return}h.value=!0;try{r.value?(await v.unfollowUser(n.value.id),r.value=!1):(await v.followUser(n.value.id),r.value=!0)}catch(t){console.error("关注操作失败:",t);const u=t instanceof Error?t.message:"关注操作失败，请稍后再试";showToast(u,"error")}finally{h.value=!1}}},J=s=>{b.push(`/resource/${s}`)},z=s=>{b.push(`/post/${s}`)},V=s=>{const t=s.target;t.style.display="none"},N=s=>s?new Date(s).toLocaleDateString("zh-CN"):"未知",K=async()=>{a.value==="resources"&&_.value.length===0?await D():a.value==="posts"&&w.value.length===0&&await D()};return R(()=>{S()}),F(a,K),(s,t)=>(o(),i("div",Pe,[C.value?(o(),i("div",Fe,[...t[5]||(t[5]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e("p",{class:"text-gray-600 dark:text-gray-300"},"正在加载用户信息...")],-1)])])):I.value?(o(),i("div",Re,[e("div",Ae,[e("div",qe,[g(c(ie),{class:"h-16 w-16 mx-auto"})]),t[6]||(t[6]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},"用户信息加载失败",-1)),e("p",Le,l(I.value),1),e("button",{onClick:t[0]||(t[0]=u=>c(b).back()),class:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors mr-4"}," 返回上一页 "),e("button",{onClick:S,class:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," 重新加载 ")])])):(o(),i("div",Te,[e("div",He,[e("div",Je,[e("button",{onClick:t[1]||(t[1]=u=>c(b).back()),class:"flex items-center text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors"},[g(c(se),{class:"h-5 w-5 mr-2"}),t[7]||(t[7]=p(" 返回 ",-1))])])]),e("div",ze,[e("div",Ve,[e("div",Ke,[e("div",Xe,[e("div",Ze,[n.value.avatar_url?(o(),i("img",{key:0,src:n.value.avatar_url,alt:n.value.nickname||n.value.username,class:"w-full h-full object-cover",onError:V},null,40,Ge)):(o(),B(c(W),{key:1,class:"w-12 h-12 md:w-16 md:h-16 text-gray-400 dark:text-gray-500"}))])]),e("div",Qe,[e("div",We,[e("h1",Ye,l(n.value.nickname||n.value.username),1),e("p",et," @"+l(n.value.username),1)]),n.value.bio?(o(),i("div",tt,[e("p",st,l(n.value.bio),1)])):A("",!0),e("div",rt,[e("div",at,[e("div",ot,l(d.value.resourceCount),1),t[8]||(t[8]=e("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"发布资源",-1))]),e("div",lt,[e("div",nt,l(d.value.postCount),1),t[9]||(t[9]=e("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"发布帖子",-1))]),e("div",it,[e("div",dt,l(N(n.value.created_at)),1),t[10]||(t[10]=e("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"加入时间",-1))])]),e("div",ct,[y.value?(o(),i("button",{key:0,onClick:t[2]||(t[2]=u=>c(b).push("/profile")),class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," 编辑资料 ")):(o(),i("button",{key:1,onClick:H,disabled:r.value||h.value,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},l(r.value?"已关注":"关注"),9,ut))])])])])]),e("div",gt,[e("div",xt,[e("div",yt,[e("nav",vt,[e("button",{onClick:t[3]||(t[3]=u=>a.value="resources"),class:f(["py-4 px-1 border-b-2 font-medium text-sm transition-colors",a.value==="resources"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"])},[g(c(M),{class:"inline-block h-5 w-5 mr-2"}),t[11]||(t[11]=p(" 发布资源 ",-1))],2),e("button",{onClick:t[4]||(t[4]=u=>a.value="posts"),class:f(["py-4 px-1 border-b-2 font-medium text-sm transition-colors",a.value==="posts"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"])},[g(c(O),{class:"inline-block h-5 w-5 mr-2"}),t[12]||(t[12]=p(" 发布帖子 ",-1))],2)])]),e("div",mt,[a.value==="resources"?(o(),i("div",ht,[C.value?(o(),i("div",bt,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-500 dark:text-gray-400"},"加载中...",-1)])])):_.value.length===0?(o(),i("div",kt,[g(c(M),{class:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),t[14]||(t[14]=e("p",{class:"text-gray-500 dark:text-gray-400"},"该用户还没有发布任何资源",-1))])):(o(),i("div",ft,[(o(!0),i(j,null,E(_.value,u=>(o(),B(Oe,{key:u.id,resource:u,onClick:X=>J(u.id)},null,8,["resource","onClick"]))),128))]))])):(o(),i("div",pt,[C.value?(o(),i("div",_t,[...t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-500 dark:text-gray-400"},"加载中...",-1)])])):w.value.length===0?(o(),i("div",wt,[g(c(O),{class:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),t[16]||(t[16]=e("p",{class:"text-gray-500 dark:text-gray-400"},"该用户还没有发布任何帖子",-1))])):(o(),i("div",Ct,[(o(!0),i(j,null,E(w.value,u=>(o(),i("div",{key:u.id,class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:X=>z(u.id)},[e("div",It,[e("h3",St,l(u.title),1),e("span",Ut,l(N(u.created_at)),1)]),e("p",Dt,l(u.content),1),e("div",jt,[e("div",Et,[e("span",Mt,[g(c(q),{class:"h-4 w-4 mr-1"}),p(" "+l(u.likes_count||0),1)]),e("span",Nt,[g(c(le),{class:"h-4 w-4 mr-1"}),p(" "+l(u.comments_count||0),1)])]),e("span",null,l(u.category||"未分类"),1)])],8,$t))),128))]))]))])])])]))]))}}),Ht=L(Bt,[["__file","E:/前端初级课程/program/EduMatch/src/views/UserProfilePage.vue"]]);export{Ht as default};
