import{c as D,d as H,r as u,o as J,b as l,e as t,j as y,g as v,l as x,w as _,v as M,F as P,m as T,y as Q,t as i,i as w,s as W,k as X,a as n,U as Y,n as ee,z as te,_ as se}from"./index-f8367010.js";import{useDatabaseStore as re}from"./database-93964f75.js";import{S as ae}from"./search-853977b4.js";import{C as oe}from"./clock-967056bc.js";import{T as le}from"./thumbs-up-75f56b62.js";import{B as ne}from"./book-open-103438f5.js";import"./supabase-a1abc191.js";/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=D("AwardIcon",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=D("ChevronDownIcon",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=D("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=D("PenLineIcon",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),ue={class:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 p-6"},ge={class:"mb-8"},ye={class:"text-3xl font-bold text-gray-900 dark:text-white flex items-center"},ve={class:"grid grid-cols-1 lg:grid-cols-4 gap-6"},xe={class:"lg:col-span-1 space-y-6"},be={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md"},me={class:"relative"},pe={class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},fe={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md"},he={class:"font-semibold mb-4 flex items-center"},ke={key:0,class:"flex flex-wrap gap-2"},_e=["onClick"],we={class:"ml-1 text-xs opacity-70"},Ce={key:1,class:"text-gray-500 dark:text-gray-400 text-sm"},Me={class:"lg:col-span-3"},Pe={class:"mb-6 flex justify-between items-center bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md"},Te={class:"font-bold text-xl flex items-center"},De={class:"relative"},Le={class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},je={key:0,class:"flex justify-center py-12"},Se={key:1,class:"text-center py-12"},Ve={key:2,class:"space-y-6"},Be={class:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center"},$e={class:"flex items-center"},ze={class:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600 dark:text-blue-400 font-semibold mr-3"},Ue={class:"font-medium"},qe={class:"flex items-center text-xs text-gray-500 dark:text-gray-400"},Ie={class:"flex items-center"},Ne={class:"p-4"},Ee={class:"text-lg font-semibold mb-2 hover:text-blue-600 dark:hover:text-blue-400 transition-colors cursor-pointer"},Oe={class:"text-gray-600 dark:text-gray-300 mb-3 text-sm"},Ae={key:0,class:"flex flex-wrap gap-2 mb-4"},Ke={class:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg text-xs"},Fe={class:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700"},Re=["onClick"],Ze={class:"text-sm"},Ge={class:"flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"},He={class:"text-sm"},Je={class:"flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"},Qe={key:3,class:"mt-8 text-center"},We=["disabled"],Xe={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},Ye={class:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},et={class:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700"},tt={class:"space-y-3"},st={class:"flex flex-wrap gap-2"},rt=["onClick"],at={class:"flex items-center space-x-2"},ot=["disabled"],lt={key:0,class:"flex flex-wrap gap-2"},nt=["onClick"],it={class:"flex justify-end space-x-3 pt-4"},dt=["disabled"],ct={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},ut=H({__name:"CommunityPage",setup(gt){const z=re(),d=u([]),C=u([]),m=u(""),L=u("latest"),c=u(!1),p=u(0),j=u(!0),f=u(!1),h=u(!1),a=u({title:"",content:"",tags:[]}),b=u(""),U=["前端开发","后端开发","数据库","算法与数据结构","系统设计","DevOps","学习资源","项目经验","求职面试"],q=r=>r?new Date(r).toLocaleDateString("zh-CN"):"",k=async()=>{const{supabaseService:r}=await te(()=>import("./supabase-a1abc191.js"),["assets/supabase-a1abc191.js","assets/index-f8367010.js","assets/index-9da2352e.css"]);return r.getClient()},S=async()=>{if(!(c.value||!j.value)){c.value=!0;try{const r=await k(),{data:e,error:s}=await r.from("community_posts").select("*").order("created_at",{ascending:!1}).range(p.value*10,(p.value+1)*10-1);if(s){console.error("获取社区帖子失败:",s);return}p.value===0?d.value=e||[]:d.value=[...d.value,...e||[]],j.value=(e||[]).length===10,p.value++}catch(r){console.error("加载社区数据失败:",r)}finally{c.value=!1}}},I=async()=>{try{C.value=[]}catch(r){console.error("加载热门标签失败:",r),C.value=[]}},N=async()=>{if(!m.value.trim()){await S();return}c.value=!0;try{const{data:r,error:e}=await z.getClient().from("community_posts").select("*").or(`title.ilike.%${m.value}%,content.ilike.%${m.value}%`).order("created_at",{ascending:!1}).limit(20);if(e){console.error("搜索帖子失败:",e);return}d.value=r||[]}catch(r){console.error("搜索失败:",r)}finally{c.value=!1}},E=async()=>{p.value=0,j.value=!0,c.value=!0;try{let e=(await k()).from("community_posts").select("*");switch(L.value){case"latest":e=e.order("created_at",{ascending:!1});break;case"popular":e=e.order("views_count",{ascending:!1});break;case"mostLiked":e=e.order("likes_count",{ascending:!1});break}const{data:s,error:o}=await e.range(0,9);if(o){console.error("排序失败:",o);return}d.value=s||[]}catch(r){console.error("排序失败:",r)}finally{c.value=!1}},O=async r=>{c.value=!0;try{const e=await k(),{data:s,error:o}=await e.from("community_posts").select("*").eq("category",r).order("created_at",{ascending:!1}).limit(20);if(o){console.error("按标签过滤失败:",o);return}d.value=s||[]}catch(e){console.error("过滤失败:",e)}finally{c.value=!1}},A=()=>{S()},K=async r=>{var e;try{const s=await k(),{error:o}=await s.from("community_posts").update({likes_count:(((e=d.value.find(V=>V.id===r))==null?void 0:e.likes_count)||0)+1}).eq("id",r);if(o){console.error("点赞失败:",o);return}const g=d.value.find(V=>V.id===r);g&&(g.likes_count=(g.likes_count||0)+1)}catch(s){console.error("点赞失败:",s)}},F=async()=>{if(!a.value.title.trim()||!a.value.content.trim()){alert("请填写标题和内容");return}h.value=!0;try{const r=await k(),e={title:a.value.title,content:a.value.content,category:a.value.tags.join(", ")||"学习经验",author:"管理员",likes_count:0,views_count:0,comments_count:0,created_at:new Date().toISOString()},{data:s,error:o}=await r.from("community_posts").insert([e]).select();if(o){console.error("❌ 发布失败:",o),alert("发布失败："+o.message);return}console.log("✅ 发布成功:",s),s&&s.length>0&&d.value.unshift({...s[0],author:s[0].author||"管理员",likes_count:s[0].likes_count||0,views_count:s[0].views_count||0,comments_count:s[0].comments_count||0}),f.value=!1,a.value={title:"",content:"",tags:[]};const g=document.createElement("div");g.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",g.textContent="学习经验发布成功！",document.body.appendChild(g),setTimeout(()=>{document.body.removeChild(g)},3e3)}catch(r){console.error("❌ 发布失败:",r),alert("发布失败，请重试")}finally{h.value=!1}},R=r=>{const e=a.value.tags.indexOf(r);e>-1?a.value.tags.splice(e,1):a.value.tags.push(r)},B=()=>{const r=b.value.trim();r&&(a.value.tags.includes(r)||a.value.tags.push(r),b.value="")},Z=r=>{a.value.tags.splice(r,1)},G=()=>{f.value=!1,a.value={title:"",content:"",tags:[]},b.value=""};return J(()=>{S(),I()}),(r,e)=>(n(),l("div",ue,[t("div",ge,[t("h1",ye,[y(v(Y),{class:"h-8 w-8 mr-3 text-blue-600 dark:text-blue-400"}),e[7]||(e[7]=x(" 学习社区 ",-1))]),e[8]||(e[8]=t("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"与学习伙伴交流，分享学习经验",-1))]),t("div",ve,[t("div",xe,[t("div",be,[t("div",me,[t("div",pe,[y(v(ae),{class:"h-4 w-4"})]),_(t("input",{type:"text",placeholder:"搜索社区内容","onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),onInput:N,class:"w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg outline-none text-sm"},null,544),[[M,m.value]])])]),t("button",{onClick:e[1]||(e[1]=s=>f.value=!0),class:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl p-4 shadow-md transition-all duration-300 flex items-center justify-center space-x-2 font-medium"},[y(v(ce),{class:"w-5 h-5"}),e[9]||(e[9]=t("span",null,"发表我的经验",-1))]),t("div",fe,[t("h3",he,[y(v(ie),{class:"h-4 w-4 mr-2 text-blue-600 dark:text-blue-400"}),e[10]||(e[10]=x(" 热门标签 ",-1))]),C.value.length>0?(n(),l("div",ke,[(n(!0),l(P,null,T(C.value,s=>(n(),l("a",{key:s.id,href:"#",onClick:o=>O(s.name),class:"px-3 py-1 bg-gray-100 dark:bg-gray-700 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 rounded-full text-sm flex items-center transition-all duration-200 hover:scale-105 active:scale-95"},[x(i(s.name)+" ",1),t("span",we,"("+i(s.count)+")",1)],8,_e))),128))])):(n(),l("div",Ce," 暂无热门标签 "))])]),t("div",Me,[t("div",Pe,[t("h2",Te,[y(v($),{class:"h-5 w-5 mr-2 text-blue-600 dark:text-blue-400"}),e[11]||(e[11]=x(" 最新讨论 ",-1))]),t("div",De,[_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>L.value=s),onChange:E,class:"appearance-none bg-gray-100 dark:bg-gray-700 border-none outline-none rounded-lg px-3 py-2 pr-8 text-sm cursor-pointer"},[...e[12]||(e[12]=[t("option",{value:"latest"},"最新发布",-1),t("option",{value:"popular"},"最热讨论",-1),t("option",{value:"mostLiked"},"最多点赞",-1)])],544),[[Q,L.value]]),t("div",Le,[y(v(de),{class:"h-4 w-4 text-gray-500"})])])]),c.value?(n(),l("div",je,[...e[13]||(e[13]=[t("div",{class:"text-gray-500 dark:text-gray-400"},"加载中...",-1)])])):d.value.length===0?(n(),l("div",Se,[...e[14]||(e[14]=[t("div",{class:"text-gray-500 dark:text-gray-400 mb-4"}," 暂无社区内容 ",-1),t("p",{class:"text-sm text-gray-400 dark:text-gray-500"}," 成为第一个分享学习经验的人吧！ ",-1)])])):(n(),l("div",Ve,[(n(!0),l(P,null,T(d.value,(s,o)=>(n(),l("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-md transition-all duration-300 hover:shadow-lg"},[t("div",Be,[t("div",$e,[t("div",ze,i(s.author[0]),1),t("div",null,[t("h4",Ue,i(s.author),1),t("div",qe,[t("span",null,i(q(s.created_at)),1),e[15]||(e[15]=t("span",{class:"mx-1"},"•",-1)),t("span",Ie,[y(v(oe),{class:"h-3 w-3 mr-1"}),x(" "+i(s.views_count||0)+" 浏览 ",1)])])])])]),t("div",Ne,[t("h3",Ee,i(s.title),1),t("p",Oe,i(s.content),1),s.category?(n(),l("div",Ae,[t("span",Ke,i(s.category),1)])):w("",!0),t("div",Fe,[t("button",{onClick:g=>K(s.id),class:"flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"},[y(v(le),{class:"h-4 w-4 mr-1"}),t("span",Ze,i(s.likes_count||0),1)],8,Re),t("button",Ge,[y(v($),{class:"h-4 w-4 mr-1"}),t("span",He,i(s.comments_count||0),1)]),t("button",Je,[y(v(ne),{class:"h-4 w-4 mr-1"}),e[16]||(e[16]=t("span",{class:"text-sm"},"收藏",-1))])])])]))),128))])),d.value.length>0?(n(),l("div",Qe,[t("button",{onClick:A,disabled:c.value,class:"px-6 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 rounded-full text-gray-700 dark:text-gray-300 transition-colors shadow-sm"},i(c.value?"加载中...":"加载更多内容"),9,We)])):w("",!0)])]),f.value?(n(),l("div",Xe,[t("div",Ye,[t("div",et,[e[18]||(e[18]=t("h2",{class:"text-xl font-bold text-gray-900 dark:text-white"},"发表学习经验",-1)),t("button",{onClick:e[3]||(e[3]=s=>f.value=!1),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors"},[...e[17]||(e[17]=[t("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:W(F,["prevent"]),class:"p-6 space-y-4"},[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 经验标题 * ",-1)),_(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.title=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"分享你的学习经验..."},null,512),[[M,a.value.title]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 经验内容 * ",-1)),_(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.content=s),rows:"8",required:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"详细描述你的学习经验、技巧、心得..."},null,512),[[M,a.value.content]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 分类标签 ",-1)),t("div",tt,[t("div",st,[(n(),l(P,null,T(U,s=>t("button",{key:s,type:"button",onClick:o=>R(s),class:ee(`px-3 py-1 rounded-full text-sm transition-all ${a.value.tags.includes(s)?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}`)},i(s),11,rt)),64))]),t("div",at,[_(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>b.value=s),type:"text",onKeyup:X(B,["enter"]),placeholder:"输入自定义标签，按回车添加",class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white text-sm"},null,544),[[M,b.value]]),t("button",{type:"button",onClick:B,disabled:!b.value.trim(),class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors text-sm"}," 添加 ",8,ot)]),a.value.tags.length>0?(n(),l("div",lt,[e[22]||(e[22]=t("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"已选择：",-1)),(n(!0),l(P,null,T(a.value.tags,(s,o)=>(n(),l("span",{key:o,class:"inline-flex items-center px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full text-xs"},[x(i(s)+" ",1),t("button",{type:"button",onClick:g=>Z(o),class:"ml-1 hover:text-blue-800 dark:hover:text-blue-300"},[...e[21]||(e[21]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,nt)]))),128))])):w("",!0)])]),t("div",it,[t("button",{type:"button",onClick:G,class:"px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"}," 取消 "),t("button",{type:"submit",disabled:h.value,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white rounded-lg transition-colors flex items-center"},[h.value?(n(),l("svg",ct,[...e[24]||(e[24]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V8C6.47 4 4 5.47 4 8s-.47 4-4 4 4.47 4 8zm0 0a8 8 0 1008z"},null,-1)])])):w("",!0),x(" "+i(h.value?"发布中...":"发布经验"),1)],8,dt)])],32)])])):w("",!0)]))}}),ht=se(ut,[["__file","D:/education resource/EduMatch/src/views/CommunityPage.vue"]]);export{ht as default};
