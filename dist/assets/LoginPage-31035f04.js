import{d as V,u as C,r as c,g as J,h as T,a as m,b as t,w as P,i as v,v as x,j as y,n as U,t as w,e as h,k as _,o as p,l as I,m as j,_ as B}from"./index-7612b546.js";import{useDatabaseStore as D}from"./database-ff9128f9.js";import"./supabase-f74fb3ee.js";const z={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4"},L={class:"max-w-md mx-auto bg-white rounded-lg shadow-lg p-8"},M={key:0,class:"mt-1 text-xs text-red-600"},O=["disabled"],F={class:"mt-6 text-center"},G={class:"mt-4 text-center"},R=V({__name:"LoginPage",setup(X){const g=C(),k=D(),l=c(!1),a=c(""),o=c("success"),r=J({username:"",password:""});async function S(s){const u=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",u);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function E(){if(!r.username||!r.password){a.value="请填写用户名和密码",o.value="error";return}if(r.password.length<6){a.value="密码不能少于6位",o.value="error";return}l.value=!0,a.value="";try{let s=null;try{s=await k.getUserByUsername(r.username)}catch(n){console.warn("数据库存储连接失败，尝试直接连接Supabase:",n.message);const{createClient:b}=await j(()=>import("./index-31c5edd2.js"),[]),i="https://aonlahundnkxuyxfsmcy.supabase.co",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(i&&f){const A=b(i,f),{data:N,error:d}=await A.from("users").select("*").eq("username",r.username).single();d&&d.code!=="PGRST116"?console.error("直接Supabase连接失败:",d):s=N}}if(!s){a.value="用户不存在",o.value="error";return}const e=await S(r.password);if(s.password_hash!==e){a.value="密码错误",o.value="error";return}localStorage.setItem("currentUser",JSON.stringify({id:s.id,username:s.username,email:s.email,nickname:s.nickname,avatar_url:s.avatar_url})),a.value="登录成功！正在跳转...",o.value="success";const u=g.currentRoute.value.query.redirect||"/";setTimeout(()=>{g.push(u)},1e3)}catch(s){console.error("登录失败:",s),a.value="登录失败，请稍后重试",o.value="error"}finally{l.value=!1}}return(s,e)=>{const u=T("router-link");return p(),m("div",z,[t("div",L,[e[6]||(e[6]=t("div",{class:"text-center mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800 mb-2"},"用户登录"),t("p",{class:"text-sm text-gray-600"},"请登录以访问学习平台")],-1)),t("form",{onSubmit:P(E,["prevent"]),class:"space-y-4"},[t("div",null,[e[2]||(e[2]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"用户名",-1)),v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>r.username=n),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入用户名"},null,512),[[x,r.username]])]),t("div",null,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"密码",-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>r.password=n),type:"password",minlength:"6",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入密码（至少6位）"},null,512),[[x,r.password]]),r.password&&r.password.length<6?(p(),m("div",M," 密码不能少于6位 ")):y("",!0)]),a.value?(p(),m("div",{key:0,class:U(["p-3 rounded-md text-sm",o.value==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},w(a.value),3)):y("",!0),t("button",{type:"submit",disabled:l.value,class:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},w(l.value?"登录中...":"登录"),9,O)],32),t("div",F,[h(u,{to:"/register",class:"text-blue-600 hover:underline text-sm"},{default:_(()=>[...e[4]||(e[4]=[I(" 还没有账号？立即注册 ",-1)])]),_:1})]),t("div",G,[h(u,{to:"/",class:"text-gray-600 hover:underline text-sm"},{default:_(()=>[...e[5]||(e[5]=[I(" 返回首页 ",-1)])]),_:1})])])])}}}),Y=B(R,[["__file","E:/前端初级课程/program/EduMatch/src/views/LoginPage.vue"]]);export{Y as default};
