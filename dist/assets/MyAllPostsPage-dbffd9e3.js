import{d as B,b as l,e as i,f as e,t as m,l as _,g as C,_ as V,s as $,r as p,o as T,u as g,n as F,p as x,F as L,j as I,h as N}from"./index-0e60331d.js";import{supabaseService as b}from"./supabase-b4265a88.js";import{s as S,g as U,m as D,a as q,b as J,c as k}from"./message-2c75333d.js";const O={class:"flex items-center mb-4"},R={class:"text-sm text-gray-600 dark:text-gray-400"},W=B({__name:"DeleteConfirmDialog",props:{show:{type:Boolean,required:!0},message:{type:String,required:!1}},emits:["confirm","cancel"],setup(y,{emit:h}){const n=h,v=()=>{n("confirm")},u=()=>{n("cancel")};return(c,a)=>y.show?(l(),i("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:u},[e("div",{class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm mx-4 shadow-xl",onClick:a[0]||(a[0]=_(()=>{},["stop"]))},[e("div",O,[a[2]||(a[2]=e("div",{class:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/20 flex items-center justify-center mr-3"},[e("svg",{class:"w-6 h-6 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])],-1)),e("div",null,[a[1]||(a[1]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"ç¡®è®¤åˆ é™¤",-1)),e("p",R,m(y.message),1)])]),e("div",{class:"flex justify-end space-x-3"},[e("button",{onClick:u,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors"}," æ‰‹æ»‘äº† "),e("button",{onClick:v,class:"px-4 py-2 text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors"}," ç¡®è®¤åˆ é™¤ ")])])])):C("",!0)}}),G=V(W,[["__file","E:/å‰ç«¯åˆçº§è¯¾ç¨‹/program/EduMatch/src/components/DeleteConfirmDialog.vue"]]),K={class:"p-6 md:p-8"},Q=["innerHTML"],X={class:"bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden"},Y={class:"p-6"},Z={key:0,class:"text-center py-12"},ee={key:1,class:"text-center py-12"},te={key:2,class:"space-y-4"},se=["onClick"],oe={class:"flex justify-between items-start mb-3"},re={class:"flex-1"},ne={class:"font-semibold text-gray-900 dark:text-white mb-2"},ae={class:"text-sm text-gray-600 dark:text-gray-400 line-clamp-3 mb-2"},le={class:"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400"},ie={key:0,class:"px-2 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-full"},de={class:"flex items-center space-x-2"},ce=["onClick"],ue=["onClick"],ge={class:"text-sm text-gray-500 dark:text-gray-400 pt-3 border-t border-gray-200 dark:border-gray-600"},me={class:"flex items-center"},he=B({__name:"MyAllPostsPage",setup(y){const h=$(),n=p([]),v=p(!1),u=p(!1),c=p(null),a=o=>{h.push(`/post/${o}`)},P=()=>{h.push("/community")},j=()=>{h.push("/profile")},A=o=>new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),E=o=>{c.value=o,u.value=!0},M=()=>{u.value=!1,c.value=null},H=async()=>{if(c.value)try{const o=c.value.title,t=c.value.id;console.log("ğŸ—‘ï¸ å¼€å§‹åˆ é™¤å¸–å­:",t),await b.deleteCommunityPost(t),n.value=n.value.filter(d=>d.id!==t),M(),k(`å¸–å­ã€Œ${o}ã€å·²æˆåŠŸåˆ é™¤`,"success")}catch(o){console.error("âŒ åˆ é™¤å¸–å­å¤±è´¥:",o);let t="åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";o instanceof Error&&(o.message.includes("Failed to fetch")?t="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•":o.message.includes("permission")?t="æ²¡æœ‰åˆ é™¤æƒé™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜":o.message.includes("row-level security")?t="å®‰å…¨ç­–ç•¥é˜»æ­¢åˆ é™¤ï¼Œè¯·è”ç³»ç®¡ç†å‘˜":t=`åˆ é™¤å¤±è´¥: ${o.message}`),k(t,"error")}},z=async()=>{v.value=!0;try{console.log("ğŸ”„ å¼€å§‹åŠ è½½ç”¨æˆ·å…¨éƒ¨å¸–å­...");let o=null;const t=localStorage.getItem("currentUser");if(t){const s=JSON.parse(t);s.id&&(o=s.id,console.log("âœ… å½“å‰ç”¨æˆ·ID:",o))}if(!o){console.error("âŒ ç”¨æˆ·æœªç™»å½•"),n.value=[],k("è¯·å…ˆç™»å½•åå†æŸ¥çœ‹æ‚¨çš„å¸–å­","warning");return}const d=await b.getCommunityPostsByUserId(o);if(!d||d.length===0){console.log("â„¹ï¸ è¯¥ç”¨æˆ·æ²¡æœ‰å‘å¸ƒä»»ä½•å¸–å­"),n.value=[];return}const r=[];for(const s of d)try{const f=await b.getPostCommentsCount(s.id),w={id:s.id,title:s.title||"æ— æ ‡é¢˜",content:s.content||"",category:s.category||"æœªåˆ†ç±»",tags:[],status:"published",views:s.views_count||0,likes:s.likes_count||0,comments:f,created_at:s.created_at,updated_at:s.updated_at};r.push(w)}catch(f){console.error("âŒ å¤„ç†å¸–å­è¯¦æƒ…æ—¶å‡ºé”™:",s.id,f);const w={id:s.id,title:s.title||"æ— æ ‡é¢˜",content:s.content||"",category:s.category||"æœªåˆ†ç±»",tags:[],status:"published",views:s.views_count||0,likes:s.likes_count||0,comments:0,created_at:s.created_at,updated_at:s.updated_at};r.push(w)}n.value=r,console.log("âœ… æˆåŠŸåŠ è½½æˆ‘çš„å…¨éƒ¨å¸–å­:",n.value.length)}catch(o){console.error("âŒ åŠ è½½æˆ‘çš„å¸–å­æ—¶å‡ºé”™:",o),n.value=[],k("åŠ è½½å¸–å­å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•","error")}finally{v.value=!1}};return T(()=>{z()}),(o,t)=>{var d;return l(),i("div",K,[g(S)?(l(),i("div",{key:0,class:F([g(U)(g(D)),"flex items-center space-x-2"])},[e("span",{innerHTML:g(q)(g(D))},null,8,Q),e("span",null,m(g(J)),1)],2)):C("",!0),e("div",{class:"mb-8"},[e("button",{onClick:j,class:"flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white mb-4 transition-colors"},[...t[0]||(t[0]=[e("svg",{class:"h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),x(" è¿”å›ä¸ªäººä¸­å¿ƒ ",-1)])]),t[1]||(t[1]=e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white flex items-center"},[e("svg",{class:"h-8 w-8 mr-3 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})]),x(" æˆ‘çš„å…¨éƒ¨å¸–å­ ")],-1)),t[2]||(t[2]=e("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"ç®¡ç†ä½ åœ¨ç¤¾åŒºå‘å¸ƒçš„æ‰€æœ‰å¸–å­",-1))]),e("div",X,[e("div",Y,[v.value?(l(),i("div",Z,[...t[3]||(t[3]=[e("div",{class:"inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-green-500 hover:bg-green-400 transition ease-in-out duration-150"},[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),x(" åŠ è½½ä¸­... ")],-1)])])):n.value.length===0?(l(),i("div",ee,[t[4]||(t[4]=e("svg",{class:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})],-1)),t[5]||(t[5]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"æš‚æ— å‘å¸ƒçš„å¸–å­",-1)),t[6]||(t[6]=e("p",{class:"text-gray-500 dark:text-gray-400 mb-6"},"æ‚¨è¿˜æ²¡æœ‰åœ¨ç¤¾åŒºå‘å¸ƒä»»ä½•å¸–å­",-1)),e("button",{onClick:P,class:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors"}," å»ç¤¾åŒºå‘å¸– ")])):(l(),i("div",te,[(l(!0),i(L,null,I(n.value,r=>(l(),i("div",{key:r.id,class:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:s=>a(r.id)},[e("div",oe,[e("div",re,[e("h4",ne,m(r.title),1),e("p",ae,m(r.content),1),e("div",le,[r.category?(l(),i("span",ie,m(r.category),1)):C("",!0),t[7]||(t[7]=e("span",{class:"flex items-center"},[e("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})]),x(" å·²å‘å¸ƒ ")],-1))])]),e("div",de,[e("button",{onClick:_(s=>a(r.id),["stop"]),class:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"æŸ¥çœ‹è¯¦æƒ…"},[...t[8]||(t[8]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,ce),e("button",{onClick:_(s=>E(r),["stop"]),class:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"åˆ é™¤å¸–å­"},[...t[9]||(t[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ue)])]),e("div",ge,[e("div",me,[t[10]||(t[10]=e("svg",{class:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),x(" "+m(A(r.created_at)),1)])])],8,se))),128))]))])]),N(G,{show:u.value,message:`ç¡®å®šè¦åˆ é™¤å¸–å­ã€Œ${(d=c.value)==null?void 0:d.title}ã€å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚`,onConfirm:H,onCancel:M},null,8,["show","message"])])}}}),ke=V(he,[["__file","E:/å‰ç«¯åˆçº§è¯¾ç¨‹/program/EduMatch/src/views/MyAllPostsPage.vue"]]);export{ke as default};
