import{I as b,r as g,m as c,J as o,K as u}from"./index-03b3e23e.js";import{supabaseService as r}from"./supabase-979167fa.js";const T=b("database",()=>{const s=g(!1),a=g(null),i=c(()=>o.status==="connected"),y=c(()=>o.status==="connecting"),f=c(()=>o.status==="error");async function d(e,n){if(!i.value)throw new Error("数据库未连接");s.value=!0,a.value=null;try{return await u.query(e,n)}catch(t){throw a.value=t instanceof Error?t.message:"查询失败",t}finally{s.value=!1}}async function l(){try{const e=r.getClient(),{data:n,error:t}=await e.from("users").select("*");if(t)throw t;return n}catch(e){return console.error("获取用户数据失败:",e),[]}}async function m(e){return r.createUser(e)}async function v(e){return r.getUserByUsername(e)}async function U(e){return r.getUserByEmail(e)}async function h(e){return r.getUserByNickname(e)}async function p(e,n){return r.updateUserNickname(e,n)}async function F(e={}){return r.getResources(e)}async function R(e){return r.getResources({search:e})}async function w(e,n){return r.addLearningRecord({user_id:e,resource_id:n,progress:0})}async function B(e){return r.getLearningRecords(e)}async function C(e){return r.getFavorites(e)}async function E(e,n){return r.addToFavorites(e,n)}async function L(e,n){return r.removeFromFavorites(e,n)}return{isLoading:s,error:a,isConnected:i,isConnecting:y,hasError:f,executeQuery:d,getClient:async()=>u.getClient(),getUsers:l,createUser:m,getUserByUsername:v,getUserByEmail:U,getUserByNickname:h,updateUserNickname:p,getResources:F,searchResources:R,addLearningRecord:w,getLearningRecords:B,getFavorites:C,addToFavorites:E,removeFromFavorites:L,reconnect:async()=>{await u.init()}}});export{T as useDatabaseStore};
