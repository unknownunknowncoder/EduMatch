import{d as S,u as T,r as d,p as U,q as V,b as i,e as t,s as A,w as p,v as g,i as v,n as B,t as f,j as b,x,a as c,l as y,_ as C}from"./index-f8367010.js";import{useDatabaseStore as D}from"./database-93964f75.js";import"./supabase-a1abc191.js";const L={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4"},N={class:"max-w-md mx-auto bg-white rounded-lg shadow-lg p-8"},P={key:0,class:"mt-1 text-xs text-red-600"},q=["disabled"],E={class:"mt-6 text-center"},M={class:"mt-4 text-center"},j=S({__name:"LoginPage",setup(H){const m=T(),w=D(),u=d(!1),a=d(""),o=d("success"),r=U({username:"",password:""});async function h(s){const n=new TextEncoder().encode(s),l=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(l)).map(k=>k.toString(16).padStart(2,"0")).join("")}async function _(){if(!r.username||!r.password){a.value="请填写用户名和密码",o.value="error";return}if(r.password.length<6){a.value="密码不能少于6位",o.value="error";return}u.value=!0,a.value="";try{const s=await w.getUserByUsername(r.username);if(!s){a.value="用户不存在",o.value="error";return}const e=await h(r.password);if(s.password_hash!==e){a.value="密码错误",o.value="error";return}localStorage.setItem("currentUser",JSON.stringify({id:s.id,username:s.username,email:s.email,nickname:s.nickname,avatar_url:s.avatar_url})),a.value="登录成功！正在跳转...",o.value="success";const n=m.currentRoute.value.query.redirect||"/";setTimeout(()=>{m.push(n)},1e3)}catch(s){console.error("登录失败:",s),a.value="登录失败，请稍后重试",o.value="error"}finally{u.value=!1}}return(s,e)=>{const n=V("router-link");return c(),i("div",L,[t("div",N,[e[6]||(e[6]=t("div",{class:"text-center mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800 mb-2"},"用户登录"),t("p",{class:"text-sm text-gray-600"},"请登录以访问学习平台")],-1)),t("form",{onSubmit:A(_,["prevent"]),class:"space-y-4"},[t("div",null,[e[2]||(e[2]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"用户名",-1)),p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.username=l),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入用户名"},null,512),[[g,r.username]])]),t("div",null,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"密码",-1)),p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>r.password=l),type:"password",minlength:"6",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入密码（至少6位）"},null,512),[[g,r.password]]),r.password&&r.password.length<6?(c(),i("div",P," 密码不能少于6位 ")):v("",!0)]),a.value?(c(),i("div",{key:0,class:B(["p-3 rounded-md text-sm",o.value==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},f(a.value),3)):v("",!0),t("button",{type:"submit",disabled:u.value,class:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},f(u.value?"登录中...":"登录"),9,q)],32),t("div",E,[b(n,{to:"/register",class:"text-blue-600 hover:underline text-sm"},{default:x(()=>[...e[4]||(e[4]=[y(" 还没有账号？立即注册 ",-1)])]),_:1})]),t("div",M,[b(n,{to:"/",class:"text-gray-600 hover:underline text-sm"},{default:x(()=>[...e[5]||(e[5]=[y(" 返回首页 ",-1)])]),_:1})])])])}}}),O=C(j,[["__file","D:/education resource/EduMatch/src/views/LoginPage.vue"]]);export{O as default};
