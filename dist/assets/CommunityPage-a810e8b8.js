import{c as w,d as N,r as g,p as U,a as o,b as t,e as d,f as u,l as m,i as C,v as F,F as D,q as P,z as I,t as l,j as B,o as n,U as $,D as z,_ as O}from"./index-9b7d0a80.js";import{useDatabaseStore as K}from"./database-dd77cb4c.js";import{S as R}from"./search-aef6f2cc.js";import{C as Z}from"./clock-0ab8c2f5.js";import{T as G}from"./thumbs-up-8332c191.js";import{B as H}from"./book-open-6ebccaa5.js";import"./supabase-2d6ad7e7.js";/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=w("AwardIcon",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=w("ChevronDownIcon",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=w("MessageCircleIcon",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),W={class:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 p-6"},X={class:"mb-8"},Y={class:"text-3xl font-bold text-gray-900 dark:text-white flex items-center"},ee={class:"grid grid-cols-1 lg:grid-cols-4 gap-6"},te={class:"lg:col-span-1 space-y-6"},se={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md"},re={class:"relative"},ae={class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},oe={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md"},le={class:"font-semibold mb-4 flex items-center"},ne={key:0,class:"flex flex-wrap gap-2"},ie=["onClick"],ce={class:"ml-1 text-xs opacity-70"},de={key:1,class:"text-gray-500 dark:text-gray-400 text-sm"},ue={class:"lg:col-span-3"},ge={class:"mb-6 flex justify-between items-center bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md"},ye={class:"font-bold text-xl flex items-center"},ve={class:"relative"},me={class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},xe={key:0,class:"flex justify-center py-12"},_e={key:1,class:"text-center py-12"},he={key:2,class:"space-y-6"},be={class:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center"},fe={class:"flex items-center"},pe={class:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600 dark:text-blue-400 font-semibold mr-3"},ke={class:"font-medium"},we={class:"flex items-center text-xs text-gray-500 dark:text-gray-400"},Ce={class:"flex items-center"},De={class:"p-4"},Pe={class:"text-lg font-semibold mb-2 hover:text-blue-600 dark:hover:text-blue-400 transition-colors cursor-pointer"},Be={class:"text-gray-600 dark:text-gray-300 mb-3 text-sm"},Le={key:0,class:"flex flex-wrap gap-2 mb-4"},Me={class:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg text-xs"},Ee={class:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700"},Se=["onClick"],Te={class:"text-sm"},Ae={class:"flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"},Ve={class:"text-sm"},je={class:"flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"},qe={key:3,class:"mt-8 text-center"},Ne=["disabled"],Ue=N({__name:"CommunityPage",setup(Fe){const M=K(),i=g([]),x=g([]),y=g(""),b=g("latest"),a=g(!1),v=g(0),f=g(!0),E=r=>r?new Date(r).toLocaleDateString("zh-CN"):"",_=async()=>{const{supabaseService:r}=await z(()=>import("./supabase-2d6ad7e7.js"),["assets/supabase-2d6ad7e7.js","assets/index-9b7d0a80.js","assets/index-875cf341.css"]);return r.getClient()},p=async()=>{if(!(a.value||!f.value)){a.value=!0;try{const r=await _(),{data:e,error:s}=await r.from("community_posts").select("*").order("created_at",{ascending:!1}).range(v.value*10,(v.value+1)*10-1);if(s){console.error("获取社区帖子失败:",s);return}v.value===0?i.value=e||[]:i.value=[...i.value,...e||[]],f.value=(e||[]).length===10,v.value++}catch(r){console.error("加载社区数据失败:",r)}finally{a.value=!1}}},S=async()=>{try{x.value=[]}catch(r){console.error("加载热门标签失败:",r),x.value=[]}},T=async()=>{if(!y.value.trim()){await p();return}a.value=!0;try{const{data:r,error:e}=await M.getClient().from("community_posts").select("*").or(`title.ilike.%${y.value}%,content.ilike.%${y.value}%`).order("created_at",{ascending:!1}).limit(20);if(e){console.error("搜索帖子失败:",e);return}i.value=r||[]}catch(r){console.error("搜索失败:",r)}finally{a.value=!1}},A=async()=>{v.value=0,f.value=!0,a.value=!0;try{let e=(await _()).from("community_posts").select("*");switch(b.value){case"latest":e=e.order("created_at",{ascending:!1});break;case"popular":e=e.order("views_count",{ascending:!1});break;case"mostLiked":e=e.order("likes_count",{ascending:!1});break}const{data:s,error:c}=await e.range(0,9);if(c){console.error("排序失败:",c);return}i.value=s||[]}catch(r){console.error("排序失败:",r)}finally{a.value=!1}},V=async r=>{a.value=!0;try{const e=await _(),{data:s,error:c}=await e.from("community_posts").select("*").eq("category",r).order("created_at",{ascending:!1}).limit(20);if(c){console.error("按标签过滤失败:",c);return}i.value=s||[]}catch(e){console.error("过滤失败:",e)}finally{a.value=!1}},j=()=>{p()},q=async r=>{var e;try{const s=await _(),{error:c}=await s.from("community_posts").update({likes_count:(((e=i.value.find(k=>k.id===r))==null?void 0:e.likes_count)||0)+1}).eq("id",r);if(c){console.error("点赞失败:",c);return}const h=i.value.find(k=>k.id===r);h&&(h.likes_count=(h.likes_count||0)+1)}catch(s){console.error("点赞失败:",s)}};return U(()=>{p(),S()}),(r,e)=>(n(),o("div",W,[t("div",X,[t("h1",Y,[d(u($),{class:"h-8 w-8 mr-3 text-blue-600 dark:text-blue-400"}),e[2]||(e[2]=m(" 学习社区 ",-1))]),e[3]||(e[3]=t("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"与学习伙伴交流，分享学习经验",-1))]),t("div",ee,[t("div",te,[t("div",se,[t("div",re,[t("div",ae,[d(u(R),{class:"h-4 w-4"})]),C(t("input",{type:"text",placeholder:"搜索社区内容","onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),onInput:T,class:"w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg outline-none text-sm"},null,544),[[F,y.value]])])]),t("div",oe,[t("h3",le,[d(u(J),{class:"h-4 w-4 mr-2 text-blue-600 dark:text-blue-400"}),e[4]||(e[4]=m(" 热门标签 ",-1))]),x.value.length>0?(n(),o("div",ne,[(n(!0),o(D,null,P(x.value,s=>(n(),o("a",{key:s.id,href:"#",onClick:c=>V(s.name),class:"px-3 py-1 bg-gray-100 dark:bg-gray-700 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 rounded-full text-sm flex items-center transition-all duration-200 hover:scale-105 active:scale-95"},[m(l(s.name)+" ",1),t("span",ce,"("+l(s.count)+")",1)],8,ie))),128))])):(n(),o("div",de," 暂无热门标签 "))])]),t("div",ue,[t("div",ge,[t("h2",ye,[d(u(L),{class:"h-5 w-5 mr-2 text-blue-600 dark:text-blue-400"}),e[5]||(e[5]=m(" 最新讨论 ",-1))]),t("div",ve,[C(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>b.value=s),onChange:A,class:"appearance-none bg-gray-100 dark:bg-gray-700 border-none outline-none rounded-lg px-3 py-2 pr-8 text-sm cursor-pointer"},[...e[6]||(e[6]=[t("option",{value:"latest"},"最新发布",-1),t("option",{value:"popular"},"最热讨论",-1),t("option",{value:"mostLiked"},"最多点赞",-1)])],544),[[I,b.value]]),t("div",me,[d(u(Q),{class:"h-4 w-4 text-gray-500"})])])]),a.value?(n(),o("div",xe,[...e[7]||(e[7]=[t("div",{class:"text-gray-500 dark:text-gray-400"},"加载中...",-1)])])):i.value.length===0?(n(),o("div",_e,[...e[8]||(e[8]=[t("div",{class:"text-gray-500 dark:text-gray-400 mb-4"}," 暂无社区内容 ",-1),t("p",{class:"text-sm text-gray-400 dark:text-gray-500"}," 成为第一个分享学习经验的人吧！ ",-1)])])):(n(),o("div",he,[(n(!0),o(D,null,P(i.value,(s,c)=>(n(),o("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-md transition-all duration-300 hover:shadow-lg"},[t("div",be,[t("div",fe,[t("div",pe,l(s.author[0]),1),t("div",null,[t("h4",ke,l(s.author),1),t("div",we,[t("span",null,l(E(s.created_at)),1),e[9]||(e[9]=t("span",{class:"mx-1"},"•",-1)),t("span",Ce,[d(u(Z),{class:"h-3 w-3 mr-1"}),m(" "+l(s.views_count||0)+" 浏览 ",1)])])])])]),t("div",De,[t("h3",Pe,l(s.title),1),t("p",Be,l(s.content),1),s.category?(n(),o("div",Le,[t("span",Me,l(s.category),1)])):B("",!0),t("div",Ee,[t("button",{onClick:h=>q(s.id),class:"flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"},[d(u(G),{class:"h-4 w-4 mr-1"}),t("span",Te,l(s.likes_count||0),1)],8,Se),t("button",Ae,[d(u(L),{class:"h-4 w-4 mr-1"}),t("span",Ve,l(s.comments_count||0),1)]),t("button",je,[d(u(H),{class:"h-4 w-4 mr-1"}),e[10]||(e[10]=t("span",{class:"text-sm"},"收藏",-1))])])])]))),128))])),i.value.length>0?(n(),o("div",qe,[t("button",{onClick:j,disabled:a.value,class:"px-6 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 rounded-full text-gray-700 dark:text-gray-300 transition-colors shadow-sm"},l(a.value?"加载中...":"加载更多内容"),9,Ne)])):B("",!0)])])]))}}),Ge=O(Ue,[["__file","E:/前端初级课程/program/EduMatch/src/views/CommunityPage.vue"]]);export{Ge as default};
