import{d as j,s as A,r as g,o as E,b as d,e as c,f as t,n as h,F as N,i as z,g as F,t as v,j as S,l as T,_ as L}from"./index-9cc4628e.js";import{supabaseService as w}from"./supabase-7d3cd435.js";import{D as q}from"./DeleteConfirmDialog-63391b7a.js";const I={class:"p-6 md:p-8"},U={class:"bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden"},R={class:"p-6"},J={key:0,class:"text-center py-12"},O={key:1,class:"text-center py-12"},W={key:2,class:"space-y-4"},G=["onClick"],K={class:"flex justify-between items-start mb-3"},Q={class:"flex-1"},X={class:"font-semibold text-gray-900 dark:text-white mb-2"},Y={class:"text-sm text-gray-600 dark:text-gray-400 line-clamp-3 mb-2"},Z={class:"flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400"},ee={key:0,class:"px-2 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-full"},te=["onClick"],oe={class:"text-sm text-gray-500 dark:text-gray-400 pt-3 border-t border-gray-200 dark:border-gray-600"},se={class:"flex items-center"},re=j({__name:"MyAllPostsPage",setup(ae){const x=A(),n=g([]),f=g(!1),k=g(!1),i=g(null),_=r=>{x.push(`/post/${r}`)},b=()=>{x.push("/community")},C=()=>{x.push("/profile")},M=r=>new Date(r).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),V=r=>{i.value=r,k.value=!0},p=()=>{k.value=!1,i.value=null},D=async()=>{if(i.value)try{console.log("ğŸ—‘ï¸ å¼€å§‹åˆ é™¤å¸–å­:",i.value.id);const r=w.getClient();let e=0;const a=3;let o=null;for(;e<a;){try{console.log(`ğŸ”„ å°è¯•åˆ é™¤å¸–å­ (${e+1}/${a})...`);const{error:s}=await r.from("community_posts").delete().eq("id",i.value.id);if(o=s,s)console.error(`âŒ åˆ é™¤å¤±è´¥ (${e+1}/${a}):`,s),e<a-1&&await new Promise(u=>setTimeout(u,1e3));else{console.log("âœ… å¸–å­åˆ é™¤æˆåŠŸ");break}}catch(s){console.error(`âŒ åˆ é™¤å¼‚å¸¸ (${e+1}/${a}):`,s),o=s,e<a-1&&await new Promise(u=>setTimeout(u,1e3))}e++}if(o){console.error("âŒ åˆ é™¤å¸–å­æœ€ç»ˆå¤±è´¥:",o);let s="åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";o.message&&(o.message.includes("Failed to fetch")?s="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•":o.message.includes("permission")?s="æ²¡æœ‰åˆ é™¤æƒé™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜":o.message.includes("row-level security")?s="å®‰å…¨ç­–ç•¥é˜»æ­¢åˆ é™¤ï¼Œè¯·è”ç³»ç®¡ç†å‘˜":s=`åˆ é™¤å¤±è´¥: ${o.message}`),alert(s);return}n.value=n.value.filter(s=>s.id!==i.value.id),p()}catch(r){console.error("âŒ åˆ é™¤å¸–å­æ—¶å‡ºç°æ„å¤–é”™è¯¯:",r),alert("åˆ é™¤è¿‡ç¨‹ä¸­å‡ºç°æ„å¤–é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•")}},P=async()=>{f.value=!0;try{console.log("ğŸ”„ å¼€å§‹åŠ è½½ç”¨æˆ·å…¨éƒ¨å¸–å­...");const r=w.getClient();let e=null;const a=localStorage.getItem("currentUser");if(a){const m=JSON.parse(a);m.id&&(e=m.id,console.log("âœ… å½“å‰ç”¨æˆ·ID:",e))}if(!e){console.error("âŒ ç”¨æˆ·æœªç™»å½•"),n.value=[];return}const{data:o,error:s}=await r.from("community_posts").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(s){console.error("âŒ è·å–æˆ‘çš„å¸–å­å¤±è´¥:",s),n.value=[];return}if(!o||o.length===0){console.log("â„¹ï¸ è¯¥ç”¨æˆ·æ²¡æœ‰å‘å¸ƒä»»ä½•å¸–å­"),n.value=[];return}const u=[];for(let m=0;m<o.length;m++){const l=o[m],{data:y,error:B}=await r.from("post_comments").select("id").eq("post_id",l.id),$=B?0:y?y.length:0,H={id:l.id,title:l.title,content:l.content||"",category:l.category,tags:[],status:"published",views:l.views_count||0,likes:l.likes_count||0,comments:$,created_at:l.created_at,updated_at:l.updated_at};u.push(H)}n.value=u,console.log("âœ… æˆåŠŸåŠ è½½æˆ‘çš„å…¨éƒ¨å¸–å­:",n.value.length)}catch(r){console.error("âŒ åŠ è½½æˆ‘çš„å¸–å­æ—¶å‡ºé”™:",r),n.value=[]}finally{f.value=!1}};return E(()=>{P()}),(r,e)=>{var a;return d(),c("div",I,[t("div",{class:"mb-8"},[t("button",{onClick:C,class:"flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white mb-4 transition-colors"},[...e[0]||(e[0]=[t("svg",{class:"h-5 w-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),h(" è¿”å›ä¸ªäººä¸­å¿ƒ ",-1)])]),e[1]||(e[1]=t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white flex items-center"},[t("svg",{class:"h-8 w-8 mr-3 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})]),h(" æˆ‘çš„å…¨éƒ¨å¸–å­ ")],-1)),e[2]||(e[2]=t("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"ç®¡ç†ä½ åœ¨ç¤¾åŒºå‘å¸ƒçš„æ‰€æœ‰å¸–å­",-1))]),t("div",U,[t("div",R,[f.value?(d(),c("div",J,[...e[3]||(e[3]=[t("svg",{class:"animate-spin h-8 w-8 text-blue-500 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),t("p",{class:"text-gray-500 dark:text-gray-400 mt-2"},"åŠ è½½ä¸­...",-1)])])):n.value.length===0?(d(),c("div",O,[e[4]||(e[4]=t("svg",{class:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})],-1)),e[5]||(e[5]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"æš‚æ— å‘å¸ƒçš„å¸–å­",-1)),e[6]||(e[6]=t("p",{class:"text-gray-500 dark:text-gray-400 mb-6"},"æ‚¨è¿˜æ²¡æœ‰åœ¨ç¤¾åŒºå‘å¸ƒä»»ä½•å¸–å­",-1)),t("button",{onClick:b,class:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors"}," å»ç¤¾åŒºå‘å¸– ")])):(d(),c("div",W,[(d(!0),c(N,null,z(n.value,o=>(d(),c("div",{key:o.id,class:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:s=>_(o.id)},[t("div",K,[t("div",Q,[t("h4",X,v(o.title),1),t("p",Y,v(o.content),1),t("div",Z,[o.category?(d(),c("span",ee,v(o.category),1)):S("",!0),e[7]||(e[7]=t("span",{class:"flex items-center"},[t("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})]),h(" å·²å‘å¸ƒ ")],-1))])]),t("button",{onClick:T(s=>V(o),["stop"]),class:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"åˆ é™¤å¸–å­"},[...e[8]||(e[8]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,te)]),t("div",oe,[t("div",se,[e[9]||(e[9]=t("svg",{class:"h-4 w-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),h(" "+v(M(o.created_at)),1)])])],8,G))),128))]))])]),F(q,{show:k.value,message:`ç¡®å®šè¦åˆ é™¤å¸–å­ã€Œ${(a=i.value)==null?void 0:a.title}ã€å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚`,onConfirm:D,onCancel:p},null,8,["show","message"])])}}}),de=L(re,[["__file","E:/å‰ç«¯åˆçº§è¯¾ç¨‹/program/EduMatch/src/views/MyAllPostsPage.vue"]]);export{de as default};
