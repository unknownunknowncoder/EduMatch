var f=Object.defineProperty;var g=(o,e,r)=>e in o?f(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r;var l=(o,e,r)=>(g(o,typeof e!="symbol"?e+"":e,r),r);import{M as d}from"./index-0e60331d.js";const a=class a{constructor(){if(a.instance)return a.instance;a.instance=this}getClient(){return d.getClient()}async createUser(e){const r=this.getClient(),s=Object.fromEntries(Object.entries(e).filter(([i,u])=>u!==void 0)),{data:t,error:n}=await r.from("users").insert([s]).select();if(n)throw n;return t[0]}async getUserById(e){const r=this.getClient(),{data:s,error:t}=await r.from("users").select("*").eq("id",e).single();if(t)throw t;return s}async getUserByEmail(e){const r=this.getClient(),{data:s,error:t}=await r.from("users").select("*").eq("email",e).single();if(t&&t.code!=="PGRST116")throw t;return s}async getUserByUsername(e){const r=this.getClient(),{data:s,error:t}=await r.from("users").select("*").eq("username",e).single();if(t&&t.code!=="PGRST116")throw t;return s}async getUserByNickname(e){const r=this.getClient(),{data:s,error:t}=await r.from("users").select("*").eq("nickname",e).single();if(t&&t.code!=="PGRST116")throw t;return s}async updateUserNickname(e,r){const s=this.getClient(),{data:t,error:n}=await s.from("users").update({nickname:r}).eq("id",e).select();if(n)throw n;return t[0]}async updateUserPassword(e,r){const s=this.getClient(),t=await this.hashPassword(r),{data:n,error:i}=await s.from("users").update({password_hash:t}).eq("id",e).select();if(i)throw i;return n[0]}async hashPassword(e){const s=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")}async verifyPassword(e,r){return await this.hashPassword(e)===r}async getResources(e={}){let s=this.getClient().from("resources").select("*");e.category&&(s=s.eq("category",e.category)),e.difficulty&&(s=s.eq("difficulty",e.difficulty)),e.search&&(s=s.or(`title.ilike.%${e.search}%,description.ilike.%${e.search}%`)),s=s.order("created_at",{ascending:!1}),e.limit&&(s=s.limit(e.limit)),e.offset&&(s=s.range(e.offset,e.offset+(e.limit||10)-1));const{data:t,error:n}=await s;if(n)throw n;return t}async getResourceById(e){const r=this.getClient(),{data:s,error:t}=await r.from("resources").select("*").eq("id",e).single();if(t)throw t;return s}async createResource(e){const r=this.getClient(),{data:s,error:t}=await r.from("resources").insert([e]).select();if(t)throw t;return s[0]}async createCommunityPost(e){console.log("ðŸ”„ SupabaseæœåŠ¡ï¼šå‡†å¤‡åˆ›å»ºç¤¾åŒºå¸–å­ï¼Œæ•°æ®:",e);const r=this.getClient(),{data:s,error:t}=await r.from("community_posts").insert([e]).select();if(t)throw console.error("âŒ SupabaseæœåŠ¡ï¼šåˆ›å»ºç¤¾åŒºå¸–å­å¤±è´¥:",t),console.error("âŒ é”™è¯¯è¯¦æƒ…:",t.message,t.details,t.hint),t;return console.log("âœ… SupabaseæœåŠ¡ï¼šç¤¾åŒºå¸–å­åˆ›å»ºæˆåŠŸï¼Œè¿”å›žæ•°æ®:",s[0]),s[0]}async getCommunityPostsByUserId(e){console.log("ðŸ”„ èŽ·å–ç”¨æˆ·å‘å¸ƒçš„ç¤¾åŒºå¸–å­ï¼Œç”¨æˆ·ID:",e);const r=this.getClient(),{data:s,error:t}=await r.from("community_posts").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw console.error("âŒ èŽ·å–ç”¨æˆ·ç¤¾åŒºå¸–å­å¤±è´¥:",t),t;return console.log("âœ… æˆåŠŸèŽ·å–ç”¨æˆ·ç¤¾åŒºå¸–å­:",(s==null?void 0:s.length)||0,"æ¡"),s}async getPostById(e){const r=this.getClient(),{data:s,error:t}=await r.from("community_posts").select("*").eq("id",e).single();if(t)throw t;return s}async deleteCommunityPost(e){console.log("ðŸ”„ åˆ é™¤ç¤¾åŒºå¸–å­ï¼Œå¸–å­ID:",e);const r=this.getClient(),{error:s}=await r.from("community_posts").delete().eq("id",e);if(s)throw console.error("âŒ åˆ é™¤ç¤¾åŒºå¸–å­å¤±è´¥:",s),s;console.log("âœ… æˆåŠŸåˆ é™¤ç¤¾åŒºå¸–å­")}async getPostCommentsCount(e){console.log("ðŸ”„ èŽ·å–å¸–å­è¯„è®ºæ•°ï¼Œå¸–å­ID:",e);const r=this.getClient(),{data:s,error:t}=await r.from("post_comments").select("id").eq("post_id",e);if(t)return console.error("âŒ èŽ·å–å¸–å­è¯„è®ºæ•°å¤±è´¥:",t),0;const n=s?s.length:0;return console.log("âœ… æˆåŠŸèŽ·å–å¸–å­è¯„è®ºæ•°:",n),n}async addLearningRecord(e){const r=this.getClient(),{data:s,error:t}=await r.from("learning_records").insert([e]).select();if(t)throw t;return s[0]}async getLearningRecords(e,r={}){let t=this.getClient().from("learning_records").select(`
        *,
        resources (
          id,
          title,
          description,
          category,
          difficulty,
          rating,
          duration,
          provider,
          url
        )
      `).order("created_at",{ascending:!1});r.limit&&(t=t.limit(r.limit)),r.offset&&(t=t.range(r.offset,r.offset+(r.limit||10)-1));const{data:n,error:i}=await t;if(i)throw i;return n}async updateLearningProgress(e,r){const s=this.getClient(),{data:t,error:n}=await s.from("learning_records").update({progress:r,completed_at:r>=100?new Date().toISOString():null}).eq("id",e).select();if(n)throw n;return t[0]}async addToFavorites(e,r){const s=this.getClient(),{data:t,error:n}=await s.from("favorites").insert([{user_id:e,resource_id:r}]).select();if(n)throw n;return t[0]}async removeFromFavorites(e,r){const s=this.getClient(),{error:t}=await s.from("favorites").delete().eq("user_id",e).eq("resource_id",r);if(t)throw t}async getFavorites(e,r={}){let t=this.getClient().from("favorites").select(`
        *,
        resources (
          id,
          title,
          description,
          category,
          difficulty,
          rating,
          duration,
          provider,
          url,
          created_at
        )
      `).order("created_at",{ascending:!1});r.limit&&(t=t.limit(r.limit)),r.offset&&(t=t.range(r.offset,r.offset+(r.limit||10)-1));const{data:n,error:i}=await t;if(i)throw i;return n}async getStudyPlanById(e){const r=this.getClient(),{data:s,error:t}=await r.from("study_plans").select(`
        *,
        user:user_id (
          id,
          username,
          nickname
        )
      `).eq("id",e).single();if(t)throw t;return s}async deleteStudyPlan(e){const r=this.getClient(),{error:s}=await r.from("study_plans").delete().eq("id",e);if(s)throw s;return!0}async deleteResource(e){const r=this.getClient(),{error:s}=await r.from("resources").delete().eq("id",e);if(s)throw s;return!0}async updateStudyPlan(e,r){const s=this.getClient(),{data:t,error:n}=await s.from("study_plans").update(r).eq("id",e).select();if(n)throw n;return t[0]}async deleteStudyPlan(e){const r=this.getClient(),{error:s}=await r.from("study_plans").delete().eq("id",e);if(s)throw s;return!0}async getStudyPlanCheckins(e){const r=this.getClient(),{data:s,error:t}=await r.from("study_plan_checkins").select("*").eq("plan_id",e).order("created_at",{ascending:!1});if(t)throw t;return s}async addStudyPlanCheckin(e,r){const s=this.getClient(),t=JSON.parse(localStorage.getItem("currentUser")||"{}");if(!t.id)throw new Error("ç”¨æˆ·æœªç™»å½•");const{data:n,error:i}=await s.from("study_plan_checkins").insert([{plan_id:e,user_id:t.id,hours:r.hours,notes:r.notes,checkin_date:r.date||new Date().toISOString().split("T")[0],created_at:new Date().toISOString()}]).select();if(i)throw i;return n[0]}async customQuery(e,r={}){return d.query(e,r)}};l(a,"instance");let c=a;const m=new c;export{c as SupabaseService,m as supabaseService};
