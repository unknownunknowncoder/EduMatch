import{d as k,u as S,r as g,g as E,h as U,a as d,b as t,w as D,i as c,v as m,j as v,n as A,t as y,e as T,k as V,o as p,l as B,B as h,_ as R}from"./index-03b3e23e.js";import{useDatabaseStore as C}from"./database-321ae14c.js";import"./supabase-979167fa.js";const N={class:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4"},I={class:"max-w-md mx-auto bg-white rounded-lg shadow-lg p-8"},q={key:0,class:"mt-1 text-xs text-red-600"},H={key:0,class:"mt-1 text-xs text-red-600"},L=["disabled"],O={class:"mt-6 text-center"},j=k({__name:"RegisterPage",setup(F){const b=S(),w=C(),i=g(!1),o=g(""),l=g("success"),s=E({username:"",nickname:"",password:"",confirmPassword:""});function x(){s.password.length>=6&&s.confirmPassword&&s.password===s.confirmPassword&&(o.value="")}async function _(r){const a=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(n)).map(f=>f.toString(16).padStart(2,"0")).join("")}async function P(){if(!s.username||!s.password){o.value="请填写用户名和密码",l.value="error";return}if(s.password!==s.confirmPassword){o.value="两次输入的密码不一致",l.value="error";return}if(s.password.length<6){o.value="密码长度至少为6位",l.value="error";return}if(s.username.length<3){o.value="用户名长度至少为3位",l.value="error";return}i.value=!0,o.value="";try{if(await w.getUserByUsername(s.username)){o.value="该用户名已被注册",l.value="error";return}const e=await _(s.password);await w.createUser({username:s.username,password_hash:e}),o.value="注册成功！正在为您自动登录...",l.value="success";try{const{useDatabaseStore:a}=await h(()=>import("./database-321ae14c.js"),["assets/database-321ae14c.js","assets/index-03b3e23e.js","assets/index-1fa98120.css","assets/supabase-979167fa.js"]),u=await a().getUserByUsername(s.username);if(u)await h(()=>import("./index-03b3e23e.js").then(f=>f.N),["assets/index-03b3e23e.js","assets/index-1fa98120.css"]),localStorage.setItem("currentUser",JSON.stringify(u)),o.value="注册成功！已自动登录",l.value="success",setTimeout(()=>{b.push("/")},1e3);else throw new Error("无法获取刚创建的用户信息")}catch(a){console.error("自动登录失败:",a),o.value="注册成功，请手动登录",l.value="success",setTimeout(()=>{b.push("/login")},2e3)}}catch(r){console.error("注册失败:",r);const e=r instanceof Error?r.message:"未知错误",a=r==null?void 0:r.code,n=r==null?void 0:r.details,u=r==null?void 0:r.hint;console.error("错误详情:",{message:e,code:a,details:n,hint:u}),e!=null&&e.includes("duplicate key")||a==="23505"?o.value="用户名已存在，请选择其他用户名":e!=null&&e.includes("connection")||a==="PGRST301"?o.value="数据库连接失败，请检查网络连接":e!=null&&e.includes("validation")||a==="PGRST116"?o.value="数据格式错误，请检查输入信息":o.value=`注册失败: ${e||"请稍后重试"}`,l.value="error"}finally{i.value=!1}}return(r,e)=>{const a=U("router-link");return p(),d("div",N,[t("div",I,[e[9]||(e[9]=t("div",{class:"text-center mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-800 mb-2"},"用户注册"),t("p",{class:"text-sm text-gray-600"},"创建账号以开始您的学习之旅")],-1)),t("form",{onSubmit:D(P,["prevent"]),class:"space-y-4"},[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"用户名",-1)),c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.username=n),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入用户名"},null,512),[[m,s.username]])]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"昵称",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.nickname=n),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入昵称（可选）"},null,512),[[m,s.nickname]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"密码",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>s.password=n),type:"password",minlength:"6",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请输入密码（至少6位）",onInput:x},null,544),[[m,s.password]]),s.password&&s.password.length<6?(p(),d("div",q," 密码长度不足6位 ")):v("",!0)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"确认密码",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>s.confirmPassword=n),type:"password",minlength:"6",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"请再次输入密码",onInput:x},null,544),[[m,s.confirmPassword]]),s.confirmPassword&&s.password!==s.confirmPassword?(p(),d("div",H," 两次输入的密码不一致 ")):v("",!0)]),o.value?(p(),d("div",{key:0,class:A(["p-3 rounded-md text-sm",l.value==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},y(o.value),3)):v("",!0),t("button",{type:"submit",disabled:i.value,class:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},y(i.value?"注册中...":"注册"),9,L)],32),t("div",O,[T(a,{to:"/login",class:"text-blue-600 hover:underline text-sm"},{default:V(()=>[...e[8]||(e[8]=[B(" 已有账号？立即登录 ",-1)])]),_:1})])])])}}}),$=R(j,[["__file","E:/前端初级课程/program/EduMatch/src/views/RegisterPage.vue"]]);export{$ as default};
