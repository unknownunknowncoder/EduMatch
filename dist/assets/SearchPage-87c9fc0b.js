var j=Object.defineProperty;var T=(p,t,o)=>t in p?j(p,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):p[t]=o;var f=(p,t,o)=>(T(p,typeof t!="symbol"?t+"":t,o),o);import{c as V,d as N,u as P,r as y,o as $,b as g,e,j as b,g as x,w as k,v as z,k as E,t as l,y as w,f as U,i as v,l as F,F as R,m as S,a as u,n as D,_ as J}from"./index-f8367010.js";import{S as C}from"./search-853977b4.js";import{S as Q,L as Z}from"./sparkles-b23f3ca6.js";import{B as q}from"./book-open-103438f5.js";/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=V("ArrowLeftIcon",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);class H{constructor(){f(this,"apiKey");f(this,"baseUrl");f(this,"knowledgeBaseIds");this.apiKey={}.VITE_COZE_API_KEY||"",this.baseUrl="https://api.coze.cn/v1",this.knowledgeBaseIds={mooc:{}.VITE_COZE_MOOC_KB_ID||"",bilibili:{}.VITE_COZE_BILIBILI_KB_ID||""}}async searchResources(t){try{const o=await this.analyzeUserIntent(t.query),[s,d]=await Promise.all([this.searchKnowledgeBase(this.knowledgeBaseIds.mooc,o.searchQuery),this.searchKnowledgeBase(this.knowledgeBaseIds.bilibili,o.searchQuery)]),r=this.mergeResults(s,d,o),c=this.generateRecommendations(r,t),m=await this.generateLearningAdvice(o,c);return{topRecommendation:c[0]||this.getFallbackResource(),otherRecommendations:c.slice(1,4),learningAdvice:m,relatedKeywords:o.relatedKeywords}}catch(o){return console.error("AI搜索失败:",o),this.getFallbackResponse(t.query)}}async analyzeUserIntent(t){const o=`
      分析以下用户查询，提取关键信息：
      
      用户查询："${t}"
      
      请提取：
      1. 核心关键词
      2. 用户技能水平（初学者/进阶/高级）
      3. 学习目标（就业/兴趣/提升）
      4. 相关扩展关键词
      
      返回JSON格式。
    `;try{const d=await(await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"coze-chat",messages:[{role:"system",content:"你是专业的教育需求分析助手，擅长理解用户的学习需求和意图。"},{role:"user",content:o}],temperature:.3})})).json();return JSON.parse(d.choices[0].message.content)}catch{return{coreKeywords:[t],userLevel:"beginner",learningGoal:"interest",searchQuery:t,relatedKeywords:[]}}}async searchKnowledgeBase(t,o){var s;try{return((s=(await(await fetch(`${this.baseUrl}/knowledge/retrieve`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({knowledge_id:t,query:o,top_k:20,score_threshold:.6})})).json()).data)==null?void 0:s.matches)||[]}catch(d){return console.error("知识库搜索失败:",d),[]}}mergeResults(t,o,s){const d=t.map(c=>({...c,provider:"MOOC",providerName:"中国大学MOOC"})),r=o.map(c=>({...c,provider:"Bilibili",providerName:"B站"}));return[...d,...r]}generateRecommendations(t,o){return t.map(s=>this.transformToResource(s,o)).filter(s=>s.matchScore>.5).sort((s,d)=>d.matchScore-s.matchScore).slice(0,10)}transformToResource(t,o){const s=this.calculateMatchScore(t,o);return{id:t.id||Math.random().toString(),title:t.title||t.name||"未知标题",description:t.description||t.summary||"暂无描述",provider:t.provider,url:t.url||t.link,difficulty:t.difficulty||"未知",duration:t.duration||t.total_time||"未知",rating:t.rating||t.score||0,tags:t.tags||[],thumbnail:t.thumbnail||t.cover,instructor:t.instructor||t.teacher||t.uploader,matchScore:s,recommendedReason:this.generateRecommendReason(t,s)}}calculateMatchScore(t,o){let s=.5;return t.score&&(s+=t.score*.3),t.rating&&t.rating>4&&(s+=.2),o.userLevel&&({beginner:["入门","基础","初级"],intermediate:["进阶","中级"],advanced:["高级","深入","精通"]}[o.userLevel]||[]).some(c=>{var m;return(m=t.difficulty)==null?void 0:m.includes(c)})&&(s+=.2),Math.min(s,1)}generateRecommendReason(t,o){const s=[];return o>.8&&s.push("高度匹配您的学习需求"),t.rating>4.5&&s.push("用户评价优秀"),t.provider==="MOOC"&&s.push("权威机构认证"),s.join("，")||"符合您的搜索条件"}async generateLearningAdvice(t,o){if(o.length===0)return"抱歉，暂时没有找到完全匹配的资源。建议尝试调整关键词或浏览更多类别。";const s=[];return t.userLevel==="beginner"?s.push("建议从基础课程开始，循序渐进地学习。"):t.userLevel==="advanced"&&s.push("可以结合多个高级课程，形成完整的知识体系。"),o[0]&&s.push(`重点推荐《${o[0].title}》，这是与您需求最匹配的资源。`),s.push("学习过程中记得多实践，遇到问题可以到社区寻求帮助。"),s.join(" ")}getFallbackResource(){return{id:"fallback",title:"暂无匹配资源",description:"建议尝试其他关键词或浏览全部资源",provider:"MOOC",difficulty:"未知",matchScore:0,recommendedReason:"请调整搜索条件"}}getFallbackResponse(t){return{topRecommendation:this.getFallbackResource(),otherRecommendations:[],learningAdvice:"抱歉，搜索服务暂时不可用。请稍后重试或联系客服。",relatedKeywords:[]}}}const W=new H,Y={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},X={class:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700"},ee={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},te={class:"flex items-center space-x-4"},ae={class:"flex-1"},oe={class:"relative"},se=["disabled"],re={class:"flex items-center space-x-4 mt-4"},ne={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ie={key:0,class:"space-y-8"},le={key:0},de={class:"mb-6"},ce={class:"flex items-center mb-4"},ge={class:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-6 border border-blue-200 dark:border-blue-700"},ue={class:"flex items-start space-x-4"},me={class:"flex-1"},pe={class:"flex items-center space-x-2 mb-2"},ye={class:"text-sm text-gray-500 dark:text-gray-400"},be={class:"text-xl font-bold text-gray-900 dark:text-white mb-2"},xe={class:"text-gray-600 dark:text-gray-300 mb-4"},ve={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},he={class:"font-semibold text-gray-900 dark:text-white"},fe={class:"font-semibold text-gray-900 dark:text-white"},ke={class:"font-semibold text-gray-900 dark:text-white"},_e={key:0},we={class:"font-semibold text-gray-900 dark:text-white"},Re={class:"bg-blue-100 dark:bg-blue-800/30 rounded-lg p-3 mb-4"},Se={class:"text-sm text-blue-800 dark:text-blue-200"},Ce={class:"flex space-x-3"},Oe={key:1},Ie={class:"flex items-center justify-between mb-4"},Me={class:"text-sm text-gray-500 dark:text-gray-400"},Be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Ke=["onClick"],Ae={class:"p-6"},Le={class:"flex items-center justify-between mb-3"},je={class:"flex items-center text-sm text-gray-500 dark:text-gray-400"},Te={class:"font-bold text-lg text-gray-900 dark:text-white mb-2 line-clamp-2"},Ve={class:"text-gray-600 dark:text-gray-300 text-sm mb-4 line-clamp-3"},Ne={class:"flex items-center justify-between text-sm"},Pe={class:"text-gray-500 dark:text-gray-400"},$e={key:2,class:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 border border-green-200 dark:border-green-700"},ze={class:"flex items-center mb-3"},Ee={class:"text-gray-700 dark:text-gray-300 leading-relaxed"},Ue={key:3,class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4"},Fe={class:"flex flex-wrap gap-2"},De=["onClick"],Je={key:1,class:"text-center py-12"},Qe={class:"max-w-md mx-auto"},Ze={key:2,class:"text-center py-12"},qe={class:"max-w-md mx-auto"},Ge=N({__name:"SearchPage",setup(p){const t=P(),o=y(""),s=y(!1),d=y(!1),r=y(null),c=y(""),m=y(""),h=async()=>{if(!(!o.value.trim()||s.value)){s.value=!0,d.value=!0;try{const i=await W.searchResources({query:o.value.trim(),userLevel:c.value,category:m.value,limit:10});r.value=i}catch(i){console.error("搜索失败:",i)}finally{s.value=!1}}},O=()=>{t.back()},_=i=>{i.url&&window.open(i.url,"_blank")},I=i=>{console.log("收藏资源:",i)},M=i=>{o.value=i,h()},B=()=>{o.value="",r.value=null,d.value=!1},K=()=>{const i=["Vue.js","Python","前端开发","数据分析","机器学习"];o.value=i[Math.floor(Math.random()*i.length)]},A=i=>i==="MOOC"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200";return $(()=>{const i=t.currentRoute.value.query.q;i&&(o.value=i,h())}),(i,a)=>(u(),g("div",Y,[e("div",X,[e("div",ee,[e("div",te,[e("button",{onClick:O,class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[b(x(G),{class:"h-5 w-5 text-gray-600 dark:text-gray-400"})]),e("div",ae,[e("div",oe,[b(x(C),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),k(e("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>o.value=n),onKeyup:E(h,["enter"]),type:"text",placeholder:"搜索课程、视频、技能...",class:"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"},null,544),[[z,o.value]]),e("button",{onClick:h,disabled:s.value||!o.value.trim(),class:"absolute right-2 top-1/2 transform -translate-y-1/2 px-4 py-1.5 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white text-sm rounded-md transition-colors"},l(s.value?"搜索中...":"搜索"),9,se)])])]),e("div",re,[k(e("select",{"onUpdate:modelValue":a[1]||(a[1]=n=>c.value=n),class:"px-3 py-1.5 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"},[...a[5]||(a[5]=[e("option",{value:""},"全部难度",-1),e("option",{value:"beginner"},"初学者",-1),e("option",{value:"intermediate"},"进阶",-1),e("option",{value:"advanced"},"高级",-1)])],512),[[w,c.value]]),k(e("select",{"onUpdate:modelValue":a[2]||(a[2]=n=>m.value=n),class:"px-3 py-1.5 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"},[...a[6]||(a[6]=[U('<option value="" data-v-4d270a57>全部分类</option><option value="frontend" data-v-4d270a57>前端开发</option><option value="backend" data-v-4d270a57>后端开发</option><option value="mobile" data-v-4d270a57>移动开发</option><option value="ai" data-v-4d270a57>人工智能</option><option value="data" data-v-4d270a57>数据科学</option><option value="design" data-v-4d270a57>设计</option>',7)])],512),[[w,m.value]])])])]),e("div",ne,[r.value?(u(),g("div",ie,[r.value.topRecommendation&&!r.value.topRecommendation.id.startsWith("fallback")?(u(),g("div",le,[e("div",de,[e("div",ce,[b(x(Q),{class:"h-6 w-6 text-blue-500 mr-2"}),a[7]||(a[7]=e("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"AI 智能推荐",-1))]),e("div",ge,[e("div",ue,[a[14]||(a[14]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-3 h-3 bg-blue-500 rounded-full mt-2"})],-1)),e("div",me,[e("div",pe,[a[8]||(a[8]=e("span",{class:"text-xs font-semibold bg-blue-500 text-white px-2 py-1 rounded"},"最推荐",-1)),e("span",ye," 匹配度: "+l(Math.round(r.value.topRecommendation.matchScore*100))+"% ",1)]),e("h3",be,l(r.value.topRecommendation.title),1),e("p",xe,l(r.value.topRecommendation.description),1),e("div",ve,[e("div",null,[a[9]||(a[9]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"平台",-1)),e("p",he,l(r.value.topRecommendation.provider==="MOOC"?"中国大学MOOC":"B站"),1)]),e("div",null,[a[10]||(a[10]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"难度",-1)),e("p",fe,l(r.value.topRecommendation.difficulty),1)]),e("div",null,[a[11]||(a[11]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"时长",-1)),e("p",ke,l(r.value.topRecommendation.duration),1)]),r.value.topRecommendation.rating?(u(),g("div",_e,[a[12]||(a[12]=e("span",{class:"text-sm text-gray-500 dark:text-gray-400"},"评分",-1)),e("p",we," ⭐ "+l(r.value.topRecommendation.rating),1)])):v("",!0)]),e("div",Re,[e("p",Se,[a[13]||(a[13]=e("strong",null,"推荐理由：",-1)),F(l(r.value.topRecommendation.recommendedReason),1)])]),e("div",Ce,[e("button",{onClick:a[3]||(a[3]=n=>_(r.value.topRecommendation)),class:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors"}," 立即学习 "),e("button",{onClick:a[4]||(a[4]=n=>I(r.value.topRecommendation)),class:"px-6 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors"}," 收藏 ")])])])])])])):v("",!0),r.value.otherRecommendations.length>0?(u(),g("div",Oe,[e("div",Ie,[a[15]||(a[15]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"其他推荐",-1)),e("span",Me," 找到 "+l(r.value.otherRecommendations.length)+" 个相关资源 ",1)]),e("div",Be,[(u(!0),g(R,null,S(r.value.otherRecommendations,n=>(u(),g("div",{key:n.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer",onClick:L=>_(n)},[e("div",Ae,[e("div",Le,[e("span",{class:D(`px-2 py-1 text-xs font-semibold rounded ${A(n.provider)}`)},l(n.provider==="MOOC"?"中国大学MOOC":"B站"),3),e("div",je,[a[16]||(a[16]=e("span",{class:"mr-1"},"⭐",-1)),e("span",null,l(n.rating||"暂无评分"),1)])]),e("h4",Te,l(n.title),1),e("p",Ve,l(n.description),1),e("div",Ne,[e("div",Pe,l(n.difficulty)+" · "+l(n.duration),1),a[17]||(a[17]=e("div",{class:"text-blue-500 hover:text-blue-600"}," 查看详情 → ",-1))])])],8,Ke))),128))])])):v("",!0),r.value.learningAdvice?(u(),g("div",$e,[e("div",ze,[b(x(Z),{class:"h-6 w-6 text-green-500 mr-2"}),a[18]||(a[18]=e("h3",{class:"text-lg font-bold text-gray-900 dark:text-white"},"AI 学习建议",-1))]),e("p",Ee,l(r.value.learningAdvice),1)])):v("",!0),r.value.relatedKeywords.length>0?(u(),g("div",Ue,[a[19]||(a[19]=e("h4",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"},"相关搜索",-1)),e("div",Fe,[(u(!0),g(R,null,S(r.value.relatedKeywords,n=>(u(),g("button",{key:n,onClick:L=>M(n),class:"px-3 py-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-full text-sm text-gray-700 dark:text-gray-300 hover:border-blue-500 hover:text-blue-500 transition-colors"},l(n),9,De))),128))])])):v("",!0)])):!s.value&&d.value?(u(),g("div",Je,[e("div",Qe,[b(x(C),{class:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),a[20]||(a[20]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"}," 没有找到相关资源 ",-1)),a[21]||(a[21]=e("p",{class:"text-gray-500 dark:text-gray-400 mb-6"}," 试试调整关键词或选择不同的筛选条件 ",-1)),e("div",{class:"flex justify-center space-x-4"},[e("button",{onClick:B,class:"px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"}," 清空搜索 "),e("button",{onClick:K,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"}," 热门搜索 ")])])])):d.value?v("",!0):(u(),g("div",Ze,[e("div",qe,[b(x(q),{class:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),a[22]||(a[22]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"}," 开始搜索学习资源 ",-1)),a[23]||(a[23]=e("p",{class:"text-gray-500 dark:text-gray-400"}," 输入您想学习的技能或课程，AI 将为您智能匹配最佳资源 ",-1))])]))])]))}});const tt=J(Ge,[["__scopeId","data-v-4d270a57"],["__file","D:/education resource/EduMatch/src/views/SearchPage.vue"]]);export{tt as default};
