import{c as z,d as Le,s as Te,r as v,a as ze,A as fe,o as Ae,b as c,e as d,u as f,n as K,f as t,t as u,g as w,h as p,w as V,v as B,k as Q,p as y,F as S,j as L,q as Oe,T as Fe,z as W,i as Xe,l as T,U as Ze,H as De,y as me,m as Re,_ as $e}from"./index-0e60331d.js";import{useDatabaseStore as Ge}from"./database-6609ebe8.js";import{s as Ye,g as He,m as ve,a as qe,b as Ke,c as E}from"./message-2c75333d.js";import{S as Be}from"./search-bc78feee.js";import{M as ge}from"./message-square-581d132d.js";import{C as Qe}from"./chevron-right-cc1ad30d.js";import"./supabase-b4265a88.js";/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=z("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=z("HashIcon",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=z("LoaderCircleIcon",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=z("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=z("TagIcon",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-vue-next v0.420.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=z("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ot={class:"min-h-screen bg-[#F3F4F6] font-sans text-slate-800 pb-10"},rt=["innerHTML"],lt={class:"bg-white border-b border-slate-200 pt-8 pb-12 mb-8"},at={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},nt={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-6"},it={class:"relative w-full md:w-96"},ct={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},dt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ut={class:"grid lg:grid-cols-12 gap-8"},ft={class:"lg:col-span-8 space-y-6"},mt={key:0,class:"flex items-center justify-between bg-white px-4 py-3 rounded-lg border border-slate-200 shadow-sm"},vt={class:"text-sm text-slate-600"},gt={class:"font-bold text-indigo-600"},pt={key:1,class:"space-y-4"},xt={key:2,class:"text-center py-12 bg-white rounded-xl border border-red-100"},ht={class:"text-red-500 mb-4"},bt={key:3,class:"text-center py-16 bg-white rounded-xl border border-dashed border-slate-300"},_t=["onClick"],yt={class:"flex items-center justify-between mb-3"},wt={class:"flex items-center gap-3"},kt=["onClick"],It=["onClick"],Ct={class:"text-xs text-slate-400 flex items-center gap-1"},Mt={class:"flex space-x-3"},St=["onClick","disabled"],Et={class:"text-sm font-medium"},Jt=["onClick","disabled"],Nt={class:"text-sm font-medium"},Ut={class:"text-xl font-bold text-slate-900 mb-2 group-hover:text-indigo-600 transition-colors line-clamp-1"},jt={class:"text-slate-600 text-sm leading-relaxed mb-4 line-clamp-2"},Pt={key:0,class:"mb-4 p-4 rounded-2xl border border-indigo-100 bg-indigo-50/60"},Vt={class:"flex items-start justify-between gap-3"},Lt={class:"text-sm font-semibold text-indigo-900"},Tt={class:"text-xs text-indigo-500"},zt={class:"text-sm text-slate-600 mt-2 line-clamp-2"},At=["href"],Ot={class:"flex items-center justify-between pt-4 border-t border-slate-50"},Ft={class:"flex flex-wrap gap-2"},Xt={class:"flex items-center gap-4 text-slate-400 text-sm"},Zt={class:"flex items-center gap-1.5 hover:text-indigo-500 transition-colors"},Dt={class:"flex items-center justify-center gap-4 py-4"},Rt=["disabled"],$t={class:"text-sm text-slate-600 font-medium"},Gt=["disabled"],Yt={class:"lg:col-span-4 space-y-6"},Ht={class:"bg-white rounded-xl shadow-sm border border-slate-100 p-6"},qt={class:"font-bold text-slate-900 mb-4 flex items-center gap-2"},Kt={class:"flex flex-wrap gap-2"},Bt=["onClick"],Qt={class:"text-xs bg-slate-200 text-slate-500 px-1.5 py-0.5 rounded-md group-hover:bg-indigo-200 group-hover:text-indigo-700"},Wt={key:0,class:"text-slate-400 text-sm"},es={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},ts={class:"relative bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]"},ss={class:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50"},os={class:"p-6 overflow-y-auto space-y-5"},rs={class:"flex flex-wrap items-center gap-2 p-2 bg-slate-50 border border-slate-200 rounded-xl min-h-[46px] focus-within:ring-2 focus-within:ring-indigo-500 focus-within:border-transparent"},ls=["onClick"],as=["onKeydown"],ns={class:"space-y-2"},is={key:0,class:"text-sm text-slate-500"},cs={key:1,class:"text-sm text-red-500"},ds={key:2,class:"text-sm text-slate-500 flex flex-wrap items-center gap-2"},us={key:3,class:"space-y-3"},fs=["value"],ms={key:0,class:"p-3 rounded-xl border border-slate-200 bg-slate-50"},vs={class:"text-sm font-semibold text-slate-800"},gs={class:"text-xs text-slate-500"},ps={class:"text-sm text-slate-600 mt-1 line-clamp-2"},xs={class:"px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3"},hs=["disabled"],bs=Le({__name:"CommunityPage",setup(_s){const k=Te(),b=Ge(),F=v(!0),X=v(!1),Z=v(""),I=v(""),J=v(!1),ee=v(!1),N=v(!1),D=v(!1),R=v(!1),U=v([]),te=v(!1),$=v(""),h=v(1),se=v(10),G=v(0),C=v([]),j=v([]),oe=v([]),i=ze({title:"",content:"",category:"",tags:[],resourceId:""}),P=v(""),Y=fe(()=>i.resourceId&&U.value.find(s=>s.id===i.resourceId)||null),ae=fe(()=>{const s=J.value?j.value:C.value,e=(h.value-1)*se.value,o=e+se.value;return s.slice(e,o)}),xe=()=>{I.value.trim()||A()},A=()=>{I.value="",J.value=!1,j.value=[],h.value=1,O()},he=async()=>{const s=I.value.trim();if(!s){A();return}J.value=!0;const e=s.toLowerCase(),o=C.value.filter(l=>!!(l.title&&l.title.toLowerCase().includes(e)||l.content&&l.content.toLowerCase().includes(e)||l.category&&l.category.toLowerCase().includes(e)||l.author&&l.author.toLowerCase().includes(e)||l.tags&&Array.isArray(l.tags)&&l.tags.some(a=>typeof a=="string"&&a.toLowerCase().includes(e))));j.value=o,h.value=1,O()},O=()=>{const s=J.value?j.value:C.value;G.value=Math.ceil(s.length/se.value)},be=()=>{h.value>1&&(h.value--,window.scrollTo({top:0,behavior:"smooth"}))},_e=()=>{h.value<G.value&&(h.value++,window.scrollTo({top:0,behavior:"smooth"}))},ye=s=>{k.push(`/post/${s}`)},we=s=>{const e=new Date(s),l=new Date().getTime()-e.getTime(),r=Math.floor(l/(1e3*60*60*24));return r===0?"ä»Šå¤©":r===1?"æ˜¨å¤©":r<7?`${r}å¤©å‰`:r<30?`${Math.floor(r/7)}å‘¨å‰`:`${e.getMonth()+1}æœˆ${e.getDate()}æ—¥`},ke=async s=>{const e=s.toLowerCase(),o=C.value.filter(l=>!!(l.tags&&Array.isArray(l.tags)&&l.tags.some(a=>typeof a=="string"&&a.toLowerCase().includes(e))));j.value=o,J.value=!0,h.value=1,I.value=s,O()},Ie=async s=>{te.value=!0,$.value="";try{const e=await b.getUserResources(s);U.value=(e||[]).map(o=>({id:o.id,title:o.title||"æœªå‘½åèµ„æº",description:o.description,category:o.category,url:o.url}))}catch(e){console.error("è·å–ç”¨æˆ·èµ„æºå¤±è´¥:",e),$.value="åŠ è½½èµ„æºå¤±è´¥ï¼Œè¯·ç¨åå†è¯•",U.value=[]}finally{te.value=!1}},Ce=async s=>{if(!D.value){D.value=!0;try{let e=null;const o=localStorage.getItem("currentUser");if(o)try{const r=JSON.parse(o);r.id&&(e=r.id.toString())}catch(r){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",r)}if(!e){k.push("/login");return}let l=null;try{const{createClient:r}=await W(()=>import("./index-31c5edd2.js"),[]),a="https://aonlahundnkxuyxfsmcy.supabase.co",m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";a&&m&&(l=r(a,m))}catch(r){console.error("âŒ æ•°æ®åº“è¿æ¥å¤±è´¥:",r.message),E("æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•","error");return}if(s.is_liked){const{error:r}=await l.from("post_likes").delete().eq("user_id",e).eq("post_id",s.id);r?console.error("âŒ å–æ¶ˆç‚¹èµå¤±è´¥:",r):(s.is_liked=!1,s.like_count=Math.max((s.like_count||0)-1,0))}else{const{data:r}=await l.from("post_likes").select("*").eq("user_id",e).eq("post_id",s.id).limit(1);if(r&&r.length>0)s.is_liked=!0;else{const{error:a}=await l.from("post_likes").insert({user_id:e,post_id:s.id});if(a)if(a.code==="23503"&&a.message.includes("fk_post_likes_user")){s.is_liked=!0,s.like_count=(s.like_count||0)+1;return}else throw a;else s.is_liked=!0,s.like_count=(s.like_count||0)+1}}}catch(e){console.error("âŒ ç‚¹èµæ“ä½œå¤±è´¥:",e),E("æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•","error")}finally{D.value=!1}}},Me=async s=>{if(!R.value){R.value=!0;try{let e=null;const o=localStorage.getItem("currentUser");if(o)try{const r=JSON.parse(o);r.id&&(e=r.id.toString())}catch(r){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",r)}if(!e){k.push("/login");return}let l=null;try{const{createClient:r}=await W(()=>import("./index-31c5edd2.js"),[]),a="https://aonlahundnkxuyxfsmcy.supabase.co",m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";a&&m&&(l=r(a,m))}catch(r){console.error("âŒ æ•°æ®åº“è¿æ¥å¤±è´¥:",r.message),E("æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•","error");return}if(s.is_favorited){const{error:r}=await l.from("post_favorites").delete().eq("user_id",e).eq("post_id",s.id);r?console.error("âŒ å–æ¶ˆæ”¶è—å¤±è´¥:",r):(s.is_favorited=!1,s.favorite_count=Math.max((s.favorite_count||0)-1,0))}else{const{data:r}=await l.from("post_favorites").select("*").eq("user_id",e).eq("post_id",s.id).limit(1);if(r&&r.length>0)s.is_favorited=!0;else{const{error:a}=await l.from("post_favorites").insert({user_id:e,post_id:s.id});if(a)if(a.code==="23503"&&a.message.includes("fk_post_favorites_user")){s.is_favorited=!0,s.favorite_count=(s.favorite_count||0)+1;return}else throw a;else s.is_favorited=!0,s.favorite_count=(s.favorite_count||0)+1}}}catch(e){console.error("âŒ æ”¶è—æ“ä½œå¤±è´¥:",e),E("æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•","error")}finally{R.value=!1}}},ne=async()=>{F.value=!0;try{let s=await b.getClient();if(s||(await b.reconnect(),s=await b.getClient()),!s)throw new Error("æ•°æ®åº“å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥");const{data:e,error:o}=await s.from("community_posts").select("*").order("created_at",{ascending:!1});if(o)throw o;const l=Array.from(new Set((e||[]).map(n=>n.user_id).filter(n=>!!n))),r={};if(l.length>0){const{data:n,error:g}=await s.from("users").select("id, username, nickname").in("id",l);g?console.warn("åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",g):n==null||n.forEach(_=>{r[_.id]=_})}const a=Array.from(new Set((e||[]).map(n=>n.resource_id).filter(n=>!!n))),m={};if(a.length>0){const{data:n,error:g}=await s.from("resources").select("id, title, description, category, url").in("id",a);g?console.warn("åŠ è½½èµ„æºä¿¡æ¯å¤±è´¥:",g):n==null||n.forEach(_=>{m[_.id]={id:_.id,title:_.title||"æœªå‘½åèµ„æº",description:_.description,category:_.category,url:_.url}})}const{data:M,error:x}=await s.from("post_comments").select("post_id").not("post_id","is",null);x&&console.error("è·å–è¯„è®ºæ•°æ®å¤±è´¥:",x);const re={};M&&M.forEach(n=>{const g=n.post_id;re[g]=(re[g]||0)+1});let q=null,Pe="";const ue=localStorage.getItem("currentUser");if(ue)try{const n=JSON.parse(ue);n.id&&(q=n.id,Pe=n.nickname||n.username||"")}catch(n){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",n)}C.value=(e||[]).map(n=>{const g=n.user_id?r[n.user_id]:null,_=(g==null?void 0:g.nickname)||(g==null?void 0:g.username)||(n.user_id?`ç”¨æˆ·${n.user_id.substring(0,8)}`:"åŒ¿åç”¨æˆ·"),Ve=n.resource_id&&m[n.resource_id]||null;return{...n,author:_,is_liked:!1,is_favorited:!1,like_count:n.like_count||0,favorite_count:n.favorite_count||0,comment_count:re[n.id]||0,resource:Ve}}),q&&(await Se(q),await Ee(q)),O()}catch(s){console.error("âŒ åŠ è½½å¸–å­å¤±è´¥:",s),X.value=!0,Z.value="åŠ è½½å¸–å­å¤±è´¥ï¼š"+(s.message||"æœªçŸ¥é”™è¯¯")}finally{F.value=!1}},Se=async s=>{try{const{createClient:e}=await W(()=>import("./index-31c5edd2.js"),[]),o="https://aonlahundnkxuyxfsmcy.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(o&&l){const r=e(o,l),{data:a,error:m}=await r.from("post_likes").select("post_id").eq("user_id",s);if(!m&&a){const M=new Set(a.map(x=>x.post_id));C.value.forEach(x=>{x.is_liked=M.has(x.id)})}}}catch(e){console.error("âŒ åŠ è½½ç‚¹èµçŠ¶æ€å¤±è´¥:",e)}},Ee=async s=>{try{const{createClient:e}=await W(()=>import("./index-31c5edd2.js"),[]),o="https://aonlahundnkxuyxfsmcy.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(o&&l){const r=e(o,l),{data:a,error:m}=await r.from("post_favorites").select("post_id").eq("user_id",s);if(!m&&a){const M=new Set(a.map(x=>x.post_id));C.value.forEach(x=>{x.is_favorited=M.has(x.id)})}}}catch(e){console.error("âŒ åŠ è½½æ”¶è—çŠ¶æ€å¤±è´¥:",e)}},ie=async()=>{try{let s=await b.getClient();if(s||(await b.reconnect(),s=await b.getClient()),!s)return;const{data:e,error:o}=await s.from("community_posts").select("tags");if(o){console.error("âŒ åŠ è½½æ ‡ç­¾å¤±è´¥:",o);return}const l={};e==null||e.forEach(r=>{r.tags&&Array.isArray(r.tags)&&r.tags.forEach(a=>{l[a]=(l[a]||0)+1})}),oe.value=Object.entries(l).map(([r,a])=>({name:r,count:a,id:r})).sort((r,a)=>a.count-r.count).slice(0,6)}catch(s){console.error("âŒ åŠ è½½æ ‡ç­¾å¼‚å¸¸:",s)}},Je=async()=>{X.value=!1,Z.value="",h.value=1,await ne()},ce=async()=>{const s=localStorage.getItem("currentUser");if(!s){k.push("/login");return}try{const e=JSON.parse(s);e!=null&&e.id&&await Ie(e.id)}catch(e){console.error("è§£æå½“å‰ç”¨æˆ·å¤±è´¥:",e)}ee.value=!0},H=()=>{ee.value=!1,i.title="",i.content="",i.category="",i.tags=[],i.resourceId="",P.value=""},Ne=()=>{const s=P.value.trim();s&&!i.tags.includes(s)&&i.tags.push(s),P.value=""},Ue=s=>{i.tags.splice(s,1)},je=async()=>{if(!i.title.trim()){E("è¯·å¡«å†™æ ‡é¢˜","warning");return}N.value=!0;try{let s=await b.getClient();if(s||(await b.reconnect(),s=await b.getClient()),!s)throw new Error("æ•°æ®åº“å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥");let e=null,o="";const l=localStorage.getItem("currentUser");if(l)try{const m=JSON.parse(l);m.id&&(e=m.id,o=m.nickname||m.username||"")}catch(m){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",m)}if(!e){k.push("/login"),N.value=!1;return}const{data:r,error:a}=await s.from("community_posts").insert([{title:i.title,content:i.content,category:i.category||"å­¦ä¹ ç»éªŒ",tags:i.tags,resource_id:i.resourceId||null,user_id:e,like_count:0,favorite_count:0,view_count:0,comment_count:0}]).select();if(a)throw a;if(r&&r[0]){const m=i.resourceId&&U.value.find(x=>x.id===i.resourceId)||null,M={...r[0],author:o||(e?`ç”¨æˆ·${e.substring(0,8)}`:"åŒ¿å"),is_liked:!1,is_favorited:!1,like_count:r[0].like_count||0,favorite_count:r[0].favorite_count||0,comment_count:r[0].comment_count||0,resource:m};C.value.unshift(M),h.value=1,O()}H(),ie(),E("å‘å¸ƒç»éªŒæˆåŠŸ","success")}catch(s){console.error("âŒ å‘å¸ƒå¸–å­å¤±è´¥:",s),E("å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•","error")}finally{N.value=!1}},de=s=>{if(!s)return;JSON.parse(localStorage.getItem("currentUser")||"{}").id===s?k.push("/profile"):k.push(`/user/${s}`)};return Ae(async()=>{try{b.isConnected?console.log("âœ… æ•°æ®åº“å·²è¿æ¥"):await b.reconnect(),await Promise.all([ne(),ie()]),console.log("ğŸ‰ CommunityPage åˆå§‹åŒ–å®Œæˆ")}catch(s){console.error("âŒ åˆå§‹åŒ–å¤±è´¥:",s),X.value=!0,Z.value="åˆå§‹åŒ–å¤±è´¥ï¼š"+(s.message||"æœªçŸ¥é”™è¯¯")}finally{F.value=!1}}),(s,e)=>(c(),d("div",ot,[f(Ye)?(c(),d("div",{key:0,class:K([f(He)(f(ve)),"flex items-center space-x-2"])},[t("span",{innerHTML:f(qe)(f(ve))},null,8,rt),t("span",null,u(f(Ke)),1)],2)):w("",!0),t("div",lt,[t("div",at,[t("div",nt,[e[9]||(e[9]=t("div",null,[t("h1",{class:"text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight"},"å­¦ä¹ ç¤¾åŒº"),t("p",{class:"mt-2 text-slate-500 text-lg"},"ä¸å¿—åŒé“åˆçš„ä¼™ä¼´äº¤æµï¼Œåˆ†äº«ä½ çš„å­¦ä¹ ç»éªŒã€‚")],-1)),t("div",it,[t("div",ct,[p(f(Be),{class:"h-5 w-5 text-slate-400"})]),V(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>I.value=o),onInput:xe,onKeyup:[Q(he,["enter"]),Q(A,["escape"])],type:"text",class:"block w-full pl-10 pr-10 py-3 border border-slate-200 rounded-xl leading-5 bg-slate-50 placeholder-slate-400 focus:outline-none focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all sm:text-sm shadow-sm",placeholder:"æœç´¢å¸–å­ã€è¯é¢˜æˆ–å…³é”®è¯..."},null,544),[[B,I.value]]),I.value?(c(),d("button",{key:0,onClick:A,class:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 cursor-pointer"},[p(f(le),{class:"w-4 h-4"})])):w("",!0)])])])]),t("main",dt,[t("div",ut,[t("div",ft,[J.value?(c(),d("div",mt,[t("span",vt,[e[10]||(e[10]=y(' æœç´¢ "',-1)),t("span",gt,u(I.value),1),y('" çš„ç»“æœï¼š'+u(j.value.length)+" æ¡ ",1)]),t("button",{onClick:A,class:"text-xs text-slate-400 hover:text-red-500 transition-colors"},"æ¸…é™¤æœç´¢")])):w("",!0),F.value?(c(),d("div",pt,[(c(),d(S,null,L(3,o=>t("div",{key:o,class:"bg-white p-6 rounded-xl border border-slate-100 shadow-sm animate-pulse"},[...e[11]||(e[11]=[Xe('<div class="flex items-center gap-3 mb-4" data-v-d1168fcb><div class="w-10 h-10 rounded-full bg-slate-200" data-v-d1168fcb></div><div class="h-4 bg-slate-200 w-32 rounded" data-v-d1168fcb></div></div><div class="h-6 bg-slate-200 w-3/4 rounded mb-2" data-v-d1168fcb></div><div class="h-4 bg-slate-200 w-full rounded mb-2" data-v-d1168fcb></div><div class="h-4 bg-slate-200 w-1/2 rounded" data-v-d1168fcb></div>',4)])])),64))])):X.value?(c(),d("div",xt,[t("p",ht,u(Z.value),1),t("button",{onClick:Je,class:"text-indigo-600 hover:underline"},"é‡æ–°åŠ è½½")])):ae.value.length===0?(c(),d("div",bt,[p(f(ge),{class:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-slate-900"},"æœªæ‰¾åˆ°ç›¸å…³å†…å®¹",-1)),e[13]||(e[13]=t("p",{class:"text-slate-500 mt-1"},"å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯ï¼Œæˆ–æˆä¸ºç¬¬ä¸€ä¸ªå‘å¸–çš„äººï¼",-1)),t("button",{onClick:ce,class:"mt-6 px-6 py-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors"}," å‘è¡¨ç¬¬ä¸€ç¯‡ç»éªŒ ")])):(c(),d(S,{key:4},[(c(!0),d(S,null,L(ae.value,o=>(c(),d("div",{key:o.id,class:"group bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md hover:-translate-y-1 transition-all duration-300 cursor-pointer",onClick:l=>ye(o.id)},[t("div",yt,[t("div",wt,[t("button",{onClick:T(l=>de(o.user_id),["stop"]),class:"w-10 h-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-sm hover:bg-indigo-200 hover:ring-2 hover:ring-indigo-500 transition-all"},[p(f(Ze),{class:"w-5 h-5"})],8,kt),t("div",null,[t("button",{onClick:T(l=>de(o.user_id),["stop"]),class:"text-sm font-bold text-slate-800 hover:text-indigo-600 transition-colors text-left"},u(o.author||"åŒ¿åç”¨æˆ·"),9,It),t("div",Ct,[t("span",null,u(we(o.created_at)),1),e[14]||(e[14]=t("span",null,"Â·",-1)),t("span",null,u(o.category||"æœªåˆ†ç±»"),1)])])]),t("div",Mt,[t("button",{onClick:T(l=>Ce(o),["stop"]),disabled:D.value,class:K(["flex items-center space-x-1 px-3 py-1 rounded-full text-gray-500 hover:text-red-500 hover:bg-red-50 transition-colors disabled:opacity-50",o.is_liked?"text-red-500 bg-red-50":"bg-gray-100"])},[p(f(De),{class:K(["w-4 h-4",{"fill-current":o.is_liked}])},null,8,["class"]),t("span",Et,u(o.like_count||0),1)],10,St),t("button",{onClick:T(l=>Me(o),["stop"]),disabled:R.value,class:K(["flex items-center space-x-1 px-3 py-1 rounded-full text-gray-500 hover:text-yellow-500 hover:bg-yellow-50 transition-colors disabled:opacity-50",o.is_favorited?"text-yellow-500 bg-yellow-50":"bg-gray-100"])},[p(f(pe),{class:"w-4 h-4"}),t("span",Nt,u(o.favorite_count||0),1)],10,Jt)])]),t("h2",Ut,u(o.title),1),t("p",jt,u(o.content),1),o.resource?(c(),d("div",Pt,[t("div",Vt,[t("div",null,[t("p",Lt,u(o.resource.title),1),t("p",Tt,u(o.resource.category||"æœªåˆ†ç±»"),1),t("p",zt,u(o.resource.description||"æš‚æ— èµ„æºæè¿°"),1)]),o.resource.url?(c(),d("a",{key:0,href:o.resource.url,target:"_blank",rel:"noopener noreferrer",class:"text-sm font-medium text-indigo-600 hover:text-indigo-800 whitespace-nowrap",onClick:e[1]||(e[1]=T(()=>{},["stop"]))}," æŸ¥çœ‹èµ„æº ",8,At)):w("",!0)])])):w("",!0),t("div",Ot,[t("div",Ft,[(c(!0),d(S,null,L(o.tags,l=>(c(),d("span",{key:l,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-600"},[p(f(et),{class:"w-3 h-3 mr-0.5 text-slate-400"}),y(" "+u(l),1)]))),128))]),t("div",Xt,[t("button",Zt,[p(f(ge),{class:"w-4 h-4"}),y(" "+u(o.comment_count||0),1)])])])],8,_t))),128)),t("div",Dt,[t("button",{onClick:be,disabled:h.value===1,class:"p-2 rounded-lg border border-slate-200 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-slate-600"},[p(f(We),{class:"w-5 h-5"})],8,Rt),t("span",$t,"ç¬¬ "+u(h.value)+" / "+u(G.value)+" é¡µ",1),t("button",{onClick:_e,disabled:h.value===G.value,class:"p-2 rounded-lg border border-slate-200 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-slate-600"},[p(f(Qe),{class:"w-5 h-5"})],8,Gt)])],64))]),t("div",Yt,[t("button",{onClick:ce,class:"w-full py-3.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl font-bold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 group"},[p(f(st),{class:"w-5 h-5 group-hover:rotate-90 transition-transform duration-300"}),e[15]||(e[15]=y(" å‘è¡¨æˆ‘çš„ç»éªŒ ",-1))]),t("div",Ht,[t("h3",qt,[p(f(pe),{class:"w-5 h-5 text-indigo-500"}),e[16]||(e[16]=y(" çƒ­é—¨è¯é¢˜ ",-1))]),t("div",Kt,[(c(!0),d(S,null,L(oe.value,o=>(c(),d("span",{key:o.name,onClick:l=>ke(o.name),class:"cursor-pointer px-3 py-1.5 bg-slate-50 text-slate-600 rounded-lg text-sm hover:bg-indigo-50 hover:text-indigo-600 transition-colors flex items-center gap-2 group"},[y(u(o.name)+" ",1),t("span",Qt,u(o.count),1)],8,Bt))),128)),oe.value.length===0?(c(),d("div",Wt,"æš‚æ— çƒ­é—¨æ ‡ç­¾")):w("",!0)])]),e[17]||(e[17]=t("div",{class:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100"},[t("h3",{class:"font-bold text-slate-800 mb-2 text-sm uppercase tracking-wider"},"ğŸŒŸ ç¤¾åŒºå…¬çº¦"),t("ul",{class:"text-sm text-slate-600 space-y-2 list-disc list-inside marker:text-indigo-400"},[t("li",null,"å‹å–„äº¤æµï¼Œäº’ç›¸å°Šé‡"),t("li",null,"åˆ†äº«çœŸå®ã€æœ‰ä»·å€¼çš„å­¦ä¹ ç»éªŒ"),t("li",null,"ç¦æ­¢å‘å¸ƒå¹¿å‘Šæˆ–è¿è§„å†…å®¹")])],-1))])])]),p(Fe,{name:"modal"},{default:Oe(()=>[ee.value?(c(),d("div",es,[t("div",{class:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm",onClick:H}),t("div",ts,[t("div",ss,[e[18]||(e[18]=t("h3",{class:"text-lg font-bold text-slate-800"},"å‘è¡¨å­¦ä¹ ç»éªŒ",-1)),t("button",{onClick:H,class:"p-2 text-slate-400 hover:bg-slate-100 rounded-full transition-colors"},[p(f(le),{class:"w-5 h-5"})])]),t("div",os,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1.5"},"æ ‡é¢˜",-1)),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>i.title=o),type:"text",placeholder:"ä¸€å¥è¯æ¦‚æ‹¬ä½ çš„æ ¸å¿ƒè§‚ç‚¹",class:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none"},null,512),[[B,i.title]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1.5"},"åˆ†ç±»",-1)),V(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>i.category=o),class:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none text-slate-600"},[...e[20]||(e[20]=[t("option",{value:"",disabled:"",selected:""},"é€‰æ‹©åˆ†ç±»",-1),t("option",{value:"å‰ç«¯å¼€å‘"},"å‰ç«¯å¼€å‘",-1),t("option",{value:"åç«¯å¼€å‘"},"åç«¯å¼€å‘",-1),t("option",{value:"ç®—æ³•ä¸æ•°æ®ç»“æ„"},"ç®—æ³•ä¸æ•°æ®ç»“æ„",-1),t("option",{value:"è¯­è¨€å­¦ä¹ "},"è¯­è¨€å­¦ä¹ ",-1),t("option",{value:"è€ƒç ”/è€ƒè¯"},"è€ƒç ”/è€ƒè¯",-1),t("option",{value:"å…¶ä»–"},"å…¶ä»–",-1)])],512),[[me,i.category]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1.5"},"å†…å®¹è¯¦æƒ…",-1)),V(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>i.content=o),rows:"6",placeholder:"è¯¦ç»†åˆ†äº«ä½ çš„ç»éªŒã€å¿ƒå¾—æˆ–é—®é¢˜...ï¼ˆé€‰å¡«ï¼‰",class:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none resize-none"},null,512),[[B,i.content]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1.5"},"æ ‡ç­¾ (Enteræ·»åŠ )",-1)),t("div",rs,[(c(!0),d(S,null,L(i.tags,(o,l)=>(c(),d("span",{key:l,class:"inline-flex items-center px-2 py-1 rounded-md text-sm bg-indigo-100 text-indigo-700"},[y(u(o)+" ",1),t("button",{onClick:r=>Ue(l),class:"ml-1 hover:text-indigo-900"},[p(f(le),{class:"w-3 h-3"})],8,ls)]))),128)),V(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>P.value=o),onKeydown:[Q(T(Ne,["prevent"]),["enter"]),e[6]||(e[6]=Q(o=>P.value===""&&i.tags.length?i.tags.pop():null,["backspace"]))],type:"text",placeholder:"æ·»åŠ æ ‡ç­¾...",class:"flex-1 bg-transparent border-none outline-none text-sm min-w-[80px]"},null,40,as),[[B,P.value]])])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-slate-700 mb-1.5"},"å…³è”æˆ‘çš„èµ„æº",-1)),t("div",ns,[te.value?(c(),d("p",is,"æ­£åœ¨åŠ è½½èµ„æº...")):$.value?(c(),d("p",cs,u($.value),1)):U.value.length===0?(c(),d("div",ds,[e[24]||(e[24]=y(" ä½ è¿˜æ²¡æœ‰åˆ›å»ºå­¦ä¹ èµ„æº ",-1)),t("button",{onClick:e[7]||(e[7]=o=>f(k).push("/my-all-resources")),class:"text-indigo-600 hover:underline font-medium"}," å‰å¾€åˆ›å»º ")])):(c(),d("div",us,[V(t("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>i.resourceId=o),class:"w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none text-slate-600"},[e[25]||(e[25]=t("option",{value:""},"ä¸å…³è”èµ„æº",-1)),(c(!0),d(S,null,L(U.value,o=>(c(),d("option",{key:o.id,value:o.id},u(o.title),9,fs))),128))],512),[[me,i.resourceId]]),Y.value?(c(),d("div",ms,[t("p",vs,u(Y.value.title),1),t("p",gs,u(Y.value.category||"æœªåˆ†ç±»"),1),t("p",ps,u(Y.value.description||"æš‚æ— æè¿°"),1)])):w("",!0)]))])])]),t("div",xs,[t("button",{onClick:H,class:"px-5 py-2 text-slate-600 font-medium hover:bg-white border border-transparent hover:border-slate-200 rounded-lg transition-all"},"å–æ¶ˆ"),t("button",{onClick:je,disabled:N.value||!i.title,class:"px-5 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 shadow-md hover:shadow-lg transition-all"},[N.value?(c(),Re(f(tt),{key:0,class:"w-4 h-4 animate-spin"})):w("",!0),y(" "+u(N.value?"å‘å¸ƒä¸­...":"å‘å¸ƒç»éªŒ"),1)],8,hs)])])])):w("",!0)]),_:1})]))}});const Es=$e(bs,[["__scopeId","data-v-d1168fcb"],["__file","E:/å‰ç«¯åˆçº§è¯¾ç¨‹/program/EduMatch/src/views/CommunityPage.vue"]]);export{Es as default};
