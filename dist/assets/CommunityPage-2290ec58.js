import{d as ue,u as de,r as v,q as ge,E as fe,a as c,A as B,b as t,i as V,v as E,x as X,t as f,j as O,l as C,F as P,y as U,w as Z,z as ve,B as N,o as u,n as ee,_ as me}from"./index-fbee997b.js";import{useDatabaseStore as ye}from"./database-f936e93a.js";import"./supabase-f56aac63.js";const ke={class:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 p-6"},he={class:"grid grid-cols-1 lg:grid-cols-4 gap-6"},be={class:"lg:col-span-1 space-y-6"},pe={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md"},xe={class:"flex space-x-2"},_e={class:"relative flex-1"},we=["disabled"],Ie={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Ce={key:1},Me={key:0,class:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800"},Se={class:"flex items-center justify-between"},Je={class:"text-sm text-blue-700 dark:text-blue-300"},je={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md"},Ve={key:0,class:"flex flex-wrap gap-2"},Ne=["onClick"],ze={class:"ml-1 text-xs opacity-70"},Le={key:1,class:"text-gray-500 dark:text-gray-400 text-sm"},Ee={class:"lg:col-span-3"},Oe={key:0,class:"text-center py-12"},Pe={key:1,class:"text-center py-12"},Ue={key:2,class:"text-center py-12"},Ae={key:3,class:"space-y-6"},De=["onClick"],Te={class:"p-6"},Fe={class:"flex items-start justify-between mb-4"},Be={class:"flex-1"},Xe={class:"text-lg font-semibold text-gray-900 dark:text-white mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"},Ze={class:"text-gray-600 dark:text-gray-400 line-clamp-3"},Ge={class:"ml-4 flex space-x-3"},Ye=["onClick","disabled"],He={class:"text-sm font-medium"},Ke=["onClick","disabled"],Re={class:"text-sm font-medium"},$e={class:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400"},Qe={class:"flex items-center space-x-4"},We={class:"flex items-center"},qe={class:"flex items-center"},et={key:0,class:"flex flex-wrap gap-2 mt-3"},tt={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},ot={class:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},st={class:"space-y-2"},rt={class:"flex flex-wrap gap-2"},at=["onClick"],lt={class:"flex space-x-2"},nt={class:"flex justify-end space-x-3 pt-4"},it=["disabled"],ct={key:0,class:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24"},ut=ue({__name:"CommunityPage",setup(dt){const te=de(),m=v([]),x=v([]),M=v([]),h=v(""),S=v(!1),b=v(!1),_=v(!0),A=v(!1),w=v(!1),z=v(!1),L=v(!1),d=v({title:"",content:"",category:"",tags:[]}),J=v(""),I=ye(),oe=()=>{h.value.trim()||j()},j=()=>{h.value="",b.value=!1,x.value=[],S.value=!1},G=async()=>{const o=h.value.trim();if(!o){j();return}S.value=!0,b.value=!0;try{m.value.length===0&&await Y();const e=o.toLowerCase(),r=m.value.filter(a=>!!(a.title&&a.title.toLowerCase().includes(e)||a.content&&a.content.toLowerCase().includes(e)||a.category&&a.category.toLowerCase().includes(e)||a.author&&a.author.toLowerCase().includes(e)||a.tags&&Array.isArray(a.tags)&&a.tags.some(l=>typeof l=="string"&&l.toLowerCase().includes(e))));x.value=r}catch{}finally{S.value=!1}},se=o=>{console.log("ğŸ“– æŸ¥çœ‹å¸–å­è¯¦æƒ…ï¼ŒID:",o),te.push(`/post/${o}`)},re=o=>{const e=new Date(o),a=new Date().getTime()-e.getTime(),s=Math.floor(a/(1e3*60*60*24));return s===0?"ä»Šå¤©":s===1?"æ˜¨å¤©":s<7?`${s}å¤©å‰`:s<30?`${Math.floor(s/7)}å‘¨å‰`:e.toLocaleDateString("zh-CN")},ae=async o=>{if(!z.value){z.value=!0;try{let e=null;const r=localStorage.getItem("currentUser");if(r)try{const s=JSON.parse(r);s.id&&(e=s.id)}catch(s){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",s)}if(!e){alert("è¯·å…ˆç™»å½•åå†ç‚¹èµ");return}let a=!1;try{const{createClient:s}=await N(()=>import("./index-31c5edd2.js"),[]),l="https://aonlahundnkxuyxfsmcy.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(l&&n){const g=s(l,n);if(o.is_liked){const{error:i}=await g.from("post_likes").delete().eq("user_id",e).eq("post_id",o.id);if(i)throw i;o.is_liked=!1,o.like_count=Math.max((o.like_count||0)-1,0),console.log("âœ… æ•°æ®åº“å–æ¶ˆç‚¹èµæˆåŠŸ")}else{const{error:i}=await g.from("post_likes").insert([{user_id:e,post_id:o.id}]);if(i)throw i;o.is_liked=!0,o.like_count=(o.like_count||0)+1,console.log("âœ… æ•°æ®åº“æ·»åŠ ç‚¹èµæˆåŠŸ")}a=!0}}catch(s){console.warn("âš ï¸ æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨:",s.message),a=!1}if(!a){const s=`edumatch_likes_${e}`;let l=JSON.parse(localStorage.getItem(s)||"[]");o.is_liked?(l=l.filter(n=>n.post_id!==o.id),o.is_liked=!1,o.like_count=Math.max((o.like_count||0)-1,0),console.log("âœ… æœ¬åœ°å–æ¶ˆç‚¹èµæˆåŠŸ")):(l.push({post_id:o.id,user_id:e,timestamp:Date.now()}),o.is_liked=!0,o.like_count=(o.like_count||0)+1,console.log("âœ… æœ¬åœ°æ·»åŠ ç‚¹èµæˆåŠŸ")),localStorage.setItem(s,JSON.stringify(l))}await $(e)}catch(e){console.error("ç‚¹èµæ“ä½œå¤±è´¥:",e),alert("æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{z.value=!1}}},le=async o=>{if(!L.value){L.value=!0;try{let e=null;const r=localStorage.getItem("currentUser");if(r)try{const s=JSON.parse(r);s.id&&(e=s.id)}catch(s){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",s)}if(!e){alert("è¯·å…ˆç™»å½•åå†æ”¶è—å¸–å­");return}let a=!1;try{const{createClient:s}=await N(()=>import("./index-31c5edd2.js"),[]),l="https://aonlahundnkxuyxfsmcy.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(l&&n){const g=s(l,n);if(o.is_favorited){const{error:i}=await g.from("post_favorites").delete().eq("user_id",e).eq("post_id",o.id);if(i)throw i;o.is_favorited=!1,o.favorite_count=Math.max((o.favorite_count||0)-1,0),console.log("âœ… æ•°æ®åº“å–æ¶ˆæ”¶è—æˆåŠŸ")}else{const{error:i}=await g.from("post_favorites").insert([{user_id:e,post_id:o.id}]);if(i)throw i;o.is_favorited=!0,o.favorite_count=(o.favorite_count||0)+1,console.log("âœ… æ•°æ®åº“æ·»åŠ æ”¶è—æˆåŠŸ")}a=!0}}catch(s){console.warn("âš ï¸ æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨:",s.message),a=!1}if(!a){const s=`edumatch_favorites_${e}`;let l=JSON.parse(localStorage.getItem(s)||"[]");o.is_favorited?(l=l.filter(n=>n.post_id!==o.id),o.is_favorited=!1,o.favorite_count=Math.max((o.favorite_count||0)-1,0),console.log("âœ… æœ¬åœ°å–æ¶ˆæ”¶è—æˆåŠŸ")):(l.push({post_id:o.id,user_id:e,timestamp:Date.now()}),o.is_favorited=!0,o.favorite_count=(o.favorite_count||0)+1,console.log("âœ… æœ¬åœ°æ·»åŠ æ”¶è—æˆåŠŸ")),localStorage.setItem(s,JSON.stringify(l))}await $(e)}catch(e){console.error("æ”¶è—æ“ä½œå¼‚å¸¸:",e),alert("æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{L.value=!1}}},ne=async o=>{_.value=!0,b.value=!0;try{const e=o.toLowerCase(),r=m.value.filter(a=>!!(a.tags&&Array.isArray(a.tags)&&a.tags.some(l=>typeof l=="string"&&l.toLowerCase().includes(e))));x.value=r,h.value=o}catch{}finally{_.value=!1}},Y=async()=>{if(!_.value){_.value=!0;try{console.log("ğŸ”„ å¼€å§‹åŠ è½½å¸–å­...");let o=!1,e=null;try{const{createClient:r}=await N(()=>import("./index-31c5edd2.js"),[]),a="https://aonlahundnkxuyxfsmcy.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(a&&s){console.log("ğŸ”— å°è¯•è¿æ¥Supabaseæ•°æ®åº“...");const n=await r(a,s).from("community_posts").select(`
            *,
            user:user_id (
              id,
              username,
              nickname
            ),
            post_likes!post_likes_post_id_fkey(count),
            post_favorites(count)
          `).order("created_at",{ascending:!1}).limit(50);if(n.error)throw console.warn("âš ï¸ æ•°æ®åº“æŸ¥è¯¢é”™è¯¯:",n.error.message),n.error;e=n.data,o=!0,console.log("âœ… æ•°æ®åº“åŠ è½½æˆåŠŸï¼Œå¸–å­æ•°é‡:",(e==null?void 0:e.length)||0)}}catch(r){console.warn("âš ï¸ æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:",r.message),o=!1}if(o&&e){let r=null;const a=localStorage.getItem("currentUser");if(a)try{const s=JSON.parse(a);s.id&&(r=s.id)}catch(s){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",s)}m.value=(e||[]).map(s=>{var l,n,g,i,k,y;return{...s,author:((l=s.user)==null?void 0:l.nickname)||((n=s.user)==null?void 0:n.username)||"åŒ¿åç”¨æˆ·",is_liked:!1,is_favorited:!1,like_count:((i=(g=s.post_likes)==null?void 0:g[0])==null?void 0:i.count)||0,favorite_count:((y=(k=s.post_favorites)==null?void 0:k[0])==null?void 0:y.count)||0}}),r&&(await K(r),await R(r)),console.log("âœ… æ•°æ®åº“å¸–å­åŠ è½½å®Œæˆï¼Œæ•°é‡:",m.value.length)}else console.log("ğŸ“ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®..."),await H()}catch(o){console.error("âŒ åŠ è½½å¸–å­å¼‚å¸¸:",o),await H()}finally{_.value=!1,console.log("âœ… åŠ è½½å®Œæˆï¼ŒisLoadingè®¾ç½®ä¸ºfalse")}}},H=async()=>{console.log("ğŸ“ åŠ è½½æ¨¡æ‹Ÿå¸–å­æ•°æ®...");const o=[{id:"1",title:"æ¬¢è¿æ¥åˆ°å­¦ä¹ ç¤¾åŒºï¼",content:"è¿™æ˜¯ç¬¬ä¸€ä¸ªæµ‹è¯•å¸–å­ï¼Œæ¬¢è¿å¤§å®¶åˆ†äº«å­¦ä¹ ç»éªŒå’Œå¿ƒå¾—ï¼",author:"ç³»ç»Ÿç®¡ç†å‘˜",category:"å­¦ä¹ ç»éªŒ",tags:["æ¬¢è¿","æµ‹è¯•"],like_count:5,favorite_count:2,is_liked:!1,is_favorited:!1,created_at:new Date().toISOString()},{id:"2",title:"å‰ç«¯å­¦ä¹ è·¯çº¿åˆ†äº«",content:"åˆ†äº«æˆ‘çš„å‰ç«¯å­¦ä¹ è·¯çº¿ï¼Œä»HTML/CSSåˆ°Vue.jsï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°åˆå­¦è€…ã€‚",author:"å‰ç«¯å¼€å‘è€…",category:"å‰ç«¯å¼€å‘",tags:["å‰ç«¯","å­¦ä¹ è·¯çº¿","Vue.js"],like_count:12,favorite_count:8,is_liked:!1,is_favorited:!1,created_at:new Date(Date.now()-864e5).toISOString()},{id:"3",title:"ç®—æ³•å­¦ä¹ å¿ƒå¾—",content:"æœ€è¿‘åœ¨å­¦ä¹ ç®—æ³•ï¼Œå‘ç°åˆ·é¢˜çœŸçš„å¾ˆæœ‰å¸®åŠ©ï¼Œè®°å½•ä¸€ä¸‹è‡ªå·±çš„å­¦ä¹ å¿ƒå¾—ã€‚",author:"ç®—æ³•çˆ±å¥½è€…",category:"ç®—æ³•ä¸æ•°æ®ç»“æ„",tags:["ç®—æ³•","æ•°æ®ç»“æ„","åˆ·é¢˜"],like_count:8,favorite_count:3,is_liked:!1,is_favorited:!1,created_at:new Date(Date.now()-1728e5).toISOString()}];m.value=o,console.log("âœ… æ¨¡æ‹Ÿå¸–å­æ•°æ®åŠ è½½å®Œæˆï¼Œæ•°é‡:",m.value.length)},K=async o=>{try{let e=!1,r=[];try{const{createClient:a}=await N(()=>import("./index-31c5edd2.js"),[]),s="https://aonlahundnkxuyxfsmcy.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(s&&l){const n=a(s,l);console.log("ğŸ‘ å¼€å§‹ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ç‚¹èµçŠ¶æ€...");const{data:g,error:i}=await n.from("post_likes").select("post_id").eq("user_id",o);if(i)throw i;r=g.map(k=>k.post_id),e=!0,console.log("âœ… æ•°æ®åº“ç‚¹èµçŠ¶æ€åŠ è½½å®Œæˆï¼Œå·²ç‚¹èµå¸–å­æ•°é‡:",r.length)}}catch(a){console.warn("âš ï¸ æ•°æ®åº“ç‚¹èµçŠ¶æ€åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨:",a.message),e=!1}if(!e){console.log("ğŸ”„ ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç‚¹èµçŠ¶æ€");const a=`edumatch_likes_${o}`;r=JSON.parse(localStorage.getItem(a)||"[]").map(l=>l.post_id),console.log("âœ… æœ¬åœ°å­˜å‚¨ç‚¹èµçŠ¶æ€åŠ è½½å®Œæˆï¼Œå·²ç‚¹èµå¸–å­æ•°é‡:",r.length)}m.value.forEach(a=>{a.is_liked=r.includes(a.id)}),console.log("âœ… ç‚¹èµçŠ¶æ€åŠ è½½å®Œæˆ")}catch(e){console.error("âŒ åŠ è½½ç‚¹èµçŠ¶æ€å¼‚å¸¸:",e)}},R=async o=>{try{let e=!1,r=[];try{const{createClient:a}=await N(()=>import("./index-31c5edd2.js"),[]),s="https://aonlahundnkxuyxfsmcy.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFvbmxhaHVuZG5reHV5eGZzbWN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjYwNTUsImV4cCI6MjA3ODY0MjA1NX0.IQswPG1NkJKht83isjWJk5nzuhymzETAf81_71kXaVE";if(s&&l){const n=a(s,l);console.log("â­ å¼€å§‹ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·æ”¶è—çŠ¶æ€...");const{data:g,error:i}=await n.from("post_favorites").select("post_id").eq("user_id",o);if(i)throw i;r=g.map(k=>k.post_id),e=!0,console.log("âœ… æ•°æ®åº“æ”¶è—çŠ¶æ€åŠ è½½å®Œæˆï¼Œå·²æ”¶è—å¸–å­æ•°é‡:",r.length)}}catch(a){console.warn("âš ï¸ æ•°æ®åº“æ”¶è—çŠ¶æ€åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨:",a.message),e=!1}if(!e){console.log("ğŸ”„ ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ”¶è—çŠ¶æ€");const a=`edumatch_favorites_${o}`;r=JSON.parse(localStorage.getItem(a)||"[]").map(l=>l.post_id),console.log("âœ… æœ¬åœ°å­˜å‚¨æ”¶è—çŠ¶æ€åŠ è½½å®Œæˆï¼Œå·²æ”¶è—å¸–å­æ•°é‡:",r.length)}m.value.forEach(a=>{a.is_favorited=r.includes(a.id)}),console.log("âœ… æ”¶è—çŠ¶æ€åŠ è½½å®Œæˆ")}catch(e){console.error("âŒ åŠ è½½æ”¶è—çŠ¶æ€å¼‚å¸¸:",e)}},$=async o=>{console.log("ğŸ”„ é‡æ–°åŠ è½½å¸–å­çŠ¶æ€..."),await K(o),await R(o),console.log("âœ… å¸–å­çŠ¶æ€é‡æ–°åŠ è½½å®Œæˆ")},Q=async()=>{try{console.log("ğŸ·ï¸ å¼€å§‹åŠ è½½çƒ­é—¨æ ‡ç­¾...");let o=await I.getClient();if(o||(console.log("æ ‡ç­¾åŠ è½½ï¼šæ•°æ®åº“å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œå°è¯•é‡æ–°è¿æ¥..."),await I.reconnect(),o=await I.getClient()),!o){console.warn("âš ï¸ æ ‡ç­¾åŠ è½½ï¼šæ•°æ®åº“å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ ‡ç­¾"),await D();return}let e=null,r=null;try{const s=await o.from("community_posts").select("tags");e=s.data,r=s.error}catch(s){console.error("âŒ æ ‡ç­¾åŠ è½½å¼‚å¸¸:",s),r=s}if(r){console.warn("âš ï¸ æ•°æ®åº“æ ‡ç­¾åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ ‡ç­¾:",r.message),await D();return}const a={};e==null||e.forEach(s=>{s.tags&&Array.isArray(s.tags)&&s.tags.forEach(l=>{a[l]=(a[l]||0)+1})}),M.value=Object.entries(a).map(([s,l])=>({name:s,count:l,id:s})).sort((s,l)=>l.count-s.count).slice(0,10),console.log("âœ… çƒ­é—¨æ ‡ç­¾åŠ è½½å®Œæˆ:",M.value)}catch(o){console.error("âŒ åŠ è½½æ ‡ç­¾å¼‚å¸¸:",o),await D()}},D=async()=>{console.log("ğŸ“ åŠ è½½æ¨¡æ‹Ÿæ ‡ç­¾æ•°æ®...");const o=[{id:"1",name:"å‰ç«¯",count:15},{id:"2",name:"Vue.js",count:12},{id:"3",name:"ç®—æ³•",count:10},{id:"4",name:"å­¦ä¹ è·¯çº¿",count:8},{id:"5",name:"æ•°æ®åº“",count:6},{id:"6",name:"åç«¯",count:5},{id:"7",name:"TypeScript",count:4},{id:"8",name:"React",count:3},{id:"9",name:"Python",count:2},{id:"10",name:"Java",count:1}];M.value=o,console.log("âœ… æ¨¡æ‹Ÿæ ‡ç­¾æ•°æ®åŠ è½½å®Œæˆ")},ie=async()=>{var o,e,r,a,s,l;if(!(!d.value.title.trim()||!d.value.content.trim())){w.value=!0;try{let n=await I.getClient();if(n||(console.log("åˆ›å»ºå¸–å­ï¼šæ•°æ®åº“å®¢æˆ·ç«¯æœªåˆå§‹åŒ–ï¼Œå°è¯•é‡æ–°è¿æ¥..."),await I.reconnect(),n=await I.getClient()),!n){console.error("åˆ›å»ºå¸–å­ï¼šæ•°æ®åº“å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥");return}let g=null,i=null;const k=localStorage.getItem("currentUser");if(k)try{const p=JSON.parse(k);p.id&&(g=p.id,i=p)}catch(p){console.error("è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:",p)}if(!g){alert("è¯·å…ˆç™»å½•åå†å‘å¸ƒå¸–å­"),w.value=!1;return}console.log("ğŸ’¾ å¼€å§‹åˆ›å»ºå¸–å­ï¼Œç”¨æˆ·ID:",g,"æ•°æ®:",d.value);const{data:y,error:F}=await n.from("community_posts").insert([{title:d.value.title,content:d.value.content,category:d.value.category||"å­¦ä¹ ç»éªŒ",tags:d.value.tags,user_id:g,likes_count:0,views_count:0,comments_count:0}]).select(`
        *,
        user:user_id (
          id,
          username,
          nickname
        ),
        post_likes!post_likes_post_id_fkey(count),
        post_favorites(count)
      `);if(F)throw console.error("âŒ åˆ›å»ºå¸–å­å¤±è´¥:",F),F;if(console.log("âœ… å¸–å­åˆ›å»ºæˆåŠŸ:",y),y&&y[0]){const p={...y[0],author:((o=y[0].user)==null?void 0:o.nickname)||((e=y[0].user)==null?void 0:e.username)||"åŒ¿åç”¨æˆ·",is_liked:!1,is_favorited:!1,like_count:((a=(r=y[0].post_likes)==null?void 0:r[0])==null?void 0:a.count)||0,favorite_count:((l=(s=y[0].post_favorites)==null?void 0:s[0])==null?void 0:l.count)||0};m.value.unshift(p)}T(),Q()}catch(n){console.error("âŒ å‘å¸ƒå¸–å­å¼‚å¸¸:",n)}finally{w.value=!1}}},ce=o=>{const e=d.value.tags.indexOf(o);e>-1&&d.value.tags.splice(e,1)},W=()=>{const o=J.value.trim();o&&(d.value.tags.includes(o)||d.value.tags.push(o),J.value="")},T=()=>{A.value=!1,d.value={title:"",content:"",category:"",tags:[]},J.value=""},q=o=>{o.key==="Escape"&&b.value&&j()};return ge(async()=>{console.log("ğŸš€ CommunityPage ç»„ä»¶æŒ‚è½½"),console.log("ğŸ“ å¼€å§‹åŠ è½½ç¤¾åŒºæ•°æ®..."),await Promise.all([Y(),Q()]),document.addEventListener("keyup",q),console.log("ğŸ‰ CommunityPage åˆå§‹åŒ–å®Œæˆ")}),fe(()=>{document.removeEventListener("keyup",q)}),(o,e)=>(u(),c("div",ke,[e[26]||(e[26]=B('<div class="mb-8"><h1 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center"><svg class="h-8 w-8 mr-3 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg> å­¦ä¹ ç¤¾åŒº </h1><p class="text-gray-600 dark:text-gray-400 mt-2">ä¸å­¦ä¹ ä¼™ä¼´äº¤æµï¼Œåˆ†äº«å­¦ä¹ ç»éªŒ</p></div>',1)),t("div",he,[t("div",be,[t("div",pe,[t("div",xe,[t("div",_e,[e[6]||(e[6]=t("div",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),V(t("input",{type:"text",placeholder:"æœç´¢ç¤¾åŒºå†…å®¹","onUpdate:modelValue":e[0]||(e[0]=r=>h.value=r),onKeyup:[X(G,["enter"]),X(j,["escape"])],onInput:oe,class:"w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg outline-none text-sm"},null,544),[[E,h.value]])]),t("button",{onClick:G,disabled:S.value,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center"},[S.value?(u(),c("svg",Ie,[...e[7]||(e[7]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V8C6.47 4 4 5.47 4 8s-.47 4-4 4 4.47 4 4zm0 0a8 8 0 1008z"},null,-1)])])):(u(),c("span",Ce,"æœç´¢"))],8,we)]),b.value&&h.value?(u(),c("div",Me,[t("div",Se,[t("span",Je,' æœç´¢ "'+f(h.value)+'" çš„ç»“æœï¼š'+f(x.value.length)+" æ¡ ",1),t("button",{onClick:j,class:"text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200"}," æ¸…é™¤æœç´¢ ")])])):O("",!0)]),t("button",{onClick:e[1]||(e[1]=r=>A.value=!0),class:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl p-4 shadow-md transition-all duration-300 flex items-center justify-center space-x-2 font-medium"},[...e[8]||(e[8]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5h-1v5a1 1 0 01-1 1H6a1 1 0 01-1-1v-5H3a2 2 0 00-2-2V4a2 2 0 012-2h7m-1 4v4h8v-4m0 0V5a2 2 0 00-2-2H6a2 2 0 00-2 2v1m5-1h7a2 2 0 012 2v4a2 2 0 01-2 2h-7a2 2 0 01-2-2v-4z"})],-1),t("span",null,"å‘è¡¨æˆ‘çš„ç»éªŒ",-1)])]),t("div",je,[e[9]||(e[9]=t("h3",{class:"font-semibold mb-4 flex items-center"},[t("svg",{class:"h-4 w-4 mr-2 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})]),C(" çƒ­é—¨æ ‡ç­¾ ")],-1)),M.value.length>0?(u(),c("div",Ve,[(u(!0),c(P,null,U(M.value,r=>(u(),c("a",{key:r.id,href:"#",onClick:a=>ne(r.name),class:"px-3 py-1 bg-gray-100 dark:bg-gray-700 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 rounded-full text-sm flex items-center transition-all duration-200 hover:scale-105 active:scale-95"},[C(f(r.name)+" ",1),t("span",ze,"("+f(r.count)+")",1)],8,Ne))),128))])):(u(),c("div",Le," æš‚æ— çƒ­é—¨æ ‡ç­¾ "))])]),t("div",Ee,[_.value?(u(),c("div",Oe,[...e[10]||(e[10]=[B('<div class="inline-flex flex-col items-center space-y-4 bg-white dark:bg-gray-800 rounded-xl p-8 shadow-md"><div class="relative w-16 h-16"><div class="absolute inset-0 border-4 border-blue-200 dark:border-blue-800 rounded-full"></div><div class="absolute inset-0 border-4 border-transparent border-t-blue-600 dark:border-t-blue-400 rounded-full animate-spin"></div></div><span class="text-lg font-medium text-gray-700 dark:text-gray-300">åŠ è½½ä¸­...</span></div>',1)])])):!b.value&&m.value.length===0?(u(),c("div",Pe,[...e[11]||(e[11]=[t("svg",{class:"w-16 h-16 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1),t("h3",{class:"text-lg font-medium mb-2"},"æš‚æ— ç¤¾åŒºå¸–å­",-1),t("p",{class:"text-gray-500 dark:text-gray-400"},"å¿«æ¥å‘è¡¨ä½ çš„ç¬¬ä¸€ä¸ªå­¦ä¹ ç»éªŒå§ï¼",-1)])])):b.value&&x.value.length===0?(u(),c("div",Ue,[...e[12]||(e[12]=[t("svg",{class:"w-16 h-16 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),t("h3",{class:"text-lg font-medium mb-2"},"æœªæ‰¾åˆ°ç›¸å…³å†…å®¹",-1),t("p",{class:"text-gray-500 dark:text-gray-400"},"å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢",-1)])])):(u(),c("div",Ae,[(u(!0),c(P,null,U(b.value?x.value:m.value,(r,a)=>(u(),c("div",{key:r.id,class:"bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-md transition-all duration-300 hover:shadow-lg cursor-pointer group",onClick:s=>se(r.id)},[t("div",Te,[t("div",Fe,[t("div",Be,[t("h3",Xe,f(r.title),1),t("p",Ze,f(r.content),1)]),t("div",Ge,[t("button",{onClick:Z(s=>ae(r),["stop"]),disabled:z.value,class:ee(["flex items-center space-x-1 px-3 py-1 rounded-full text-gray-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors disabled:opacity-50",r.is_liked?"text-red-500 bg-red-50 dark:bg-red-900/20":"bg-gray-100 dark:bg-gray-700"])},[e[13]||(e[13]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})],-1)),t("span",He,f(r.like_count||0),1)],10,Ye),t("button",{onClick:Z(s=>le(r),["stop"]),disabled:L.value,class:ee(["flex items-center space-x-1 px-3 py-1 rounded-full text-gray-500 hover:text-yellow-500 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 transition-colors disabled:opacity-50",r.is_favorited?"text-yellow-500 bg-yellow-50 dark:bg-yellow-900/20":"bg-gray-100 dark:bg-gray-700"])},[e[14]||(e[14]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})],-1)),t("span",Re,f(r.favorite_count||0),1)],10,Ke)])]),t("div",$e,[t("div",Qe,[t("span",We,[e[15]||(e[15]=t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),C(" "+f(r.author||"åŒ¿åç”¨æˆ·"),1)]),t("span",qe,[e[16]||(e[16]=t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 002.828 0l.586-.586c.391-.39.586-.902.586-1.414V15a2 2 0 01-2 2H7a2 2 0 01-2-2v-4c0-.814.195-1.523.586-1.914L7.414 5.586C7.004 5.195 6.492 5 6 5z"})],-1)),C(" "+f(r.category||"æœªåˆ†ç±»"),1)])]),t("span",null,f(re(r.created_at)),1)]),r.tags&&r.tags.length>0?(u(),c("div",et,[(u(!0),c(P,null,U(r.tags,s=>(u(),c("span",{key:s,class:"px-2 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-full text-xs"},f(s),1))),128))])):O("",!0)])],8,De))),128))]))])]),A.value?(u(),c("div",tt,[t("div",ot,[t("div",{class:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700"},[e[18]||(e[18]=t("h2",{class:"text-xl font-bold text-gray-900 dark:text-white"},"å‘è¡¨å­¦ä¹ ç»éªŒ",-1)),t("button",{onClick:T,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[...e[17]||(e[17]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:Z(ie,["prevent"]),class:"p-6 space-y-4"},[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"æ ‡é¢˜",-1)),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>d.value.title=r),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"åˆ†äº«ä½ çš„å­¦ä¹ å¿ƒå¾—..."},null,512),[[E,d.value.title]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"å†…å®¹",-1)),V(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=r=>d.value.content=r),rows:"6",required:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"è¯¦ç»†æè¿°ä½ çš„å­¦ä¹ ç»éªŒã€é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•..."},null,512),[[E,d.value.content]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"åˆ†ç±»",-1)),V(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>d.value.category=r),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},[...e[21]||(e[21]=[B('<option value="">é€‰æ‹©åˆ†ç±»</option><option value="å‰ç«¯å¼€å‘">å‰ç«¯å¼€å‘</option><option value="åç«¯å¼€å‘">åç«¯å¼€å‘</option><option value="ç®—æ³•ä¸æ•°æ®ç»“æ„">ç®—æ³•ä¸æ•°æ®ç»“æ„</option><option value="æ•°æ®åº“">æ•°æ®åº“</option><option value="å…¶ä»–">å…¶ä»–</option>',6)])],512),[[ve,d.value.category]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"æ ‡ç­¾",-1)),t("div",st,[t("div",rt,[(u(!0),c(P,null,U(d.value.tags,r=>(u(),c("span",{key:r,class:"px-3 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-full text-sm flex items-center"},[C(f(r)+" ",1),t("button",{type:"button",onClick:a=>ce(r),class:"ml-2 text-blue-500 hover:text-blue-700"},[...e[23]||(e[23]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,at)]))),128))]),t("div",lt,[V(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>J.value=r),type:"text",onKeyup:X(W,["enter"]),class:"flex-1 px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white text-sm",placeholder:"è¾“å…¥è‡ªå®šä¹‰æ ‡ç­¾..."},null,544),[[E,J.value]]),t("button",{type:"button",onClick:W,class:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm"}," æ·»åŠ  ")])])]),t("div",nt,[t("button",{type:"button",onClick:T,class:"px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg"}," å–æ¶ˆ "),t("button",{type:"submit",disabled:w.value,class:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white rounded-lg flex items-center"},[w.value?(u(),c("svg",ct,[...e[25]||(e[25]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V8C6.47 4 4 5.47 4 8s-.47 4-4 4 4.47 4 4zm0 0a8 8 0 1008z"},null,-1)])])):O("",!0),C(" "+f(w.value?"å‘å¸ƒä¸­...":"å‘å¸ƒç»éªŒ"),1)],8,it)])],32)])])):O("",!0)]))}}),mt=me(ut,[["__file","E:/å‰ç«¯åˆçº§è¯¾ç¨‹/program/EduMatch/src/views/CommunityPage.vue"]]);export{mt as default};
