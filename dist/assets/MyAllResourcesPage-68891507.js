import{d as R,s as $,r as p,o as j,b as i,e as d,f as e,n as u,F as V,i as z,g as A,t as c,q as S,l as E,j as v,_ as N}from"./index-9cc4628e.js";import{supabaseService as y}from"./supabase-7d3cd435.js";import{D as T}from"./DeleteConfirmDialog-63391b7a.js";const F={class:"p-6 md:p-8"},L={class:"bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden"},P={class:"p-6"},I={key:0,class:"text-center py-12"},q={key:1,class:"text-center py-12"},H={key:2,class:"space-y-4"},U=["onClick"],J={class:"flex items-start justify-between mb-4"},O={class:"flex-1"},G={class:"flex items-center gap-3 mb-2"},K={class:"text-lg font-semibold text-gray-900 dark:text-white"},Q={class:"text-gray-600 dark:text-gray-400"},W=["onClick"],X={class:"flex flex-wrap items-center gap-4 mb-4"},Y={key:0,class:"flex items-center text-sm text-gray-500 dark:text-gray-400"},Z={key:1,class:"flex items-center text-sm text-gray-500 dark:text-gray-400"},ee={key:2,class:"flex items-center text-sm text-gray-500 dark:text-gray-400"},te={key:3,class:"flex items-center text-sm text-gray-500 dark:text-gray-400"},re={class:"text-sm text-gray-500 dark:text-gray-400 pt-4 border-t border-gray-200 dark:border-gray-600"},oe={class:"flex items-center"},se=R({__name:"MyAllResourcesPage",setup(le){const m=$(),n=p([]),k=p(!1),x=p(!1),g=p(null),f=()=>{m.push("/profile")},w=l=>{m.push(`/resource/${l}`)},b=()=>{m.push("/create-resource")},C=l=>{const t={video:"bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400",article:"bg-green-100 text-green-600 dark:bg-green-900/20 dark:text-green-400",book:"bg-purple-100 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400",course:"bg-orange-100 text-orange-600 dark:bg-orange-900/20 dark:text-orange-400",tool:"bg-pink-100 text-pink-600 dark:bg-pink-900/20 dark:text-pink-400",other:"bg-gray-100 text-gray-600 dark:bg-gray-900/20 dark:text-gray-400"};return t[l]||t.other},_=l=>new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),M=l=>{g.value=l,x.value=!0},h=()=>{x.value=!1,g.value=null},B=async()=>{if(g.value)try{console.log("ğŸ—‘ï¸ å¼€å§‹åˆ é™¤èµ„æº:",g.value.id);const l=y.getClient();let t=0;const a=3;let r=null;for(;t<a;){try{console.log(`ğŸ”„ å°è¯•åˆ é™¤èµ„æº (${t+1}/${a})...`);const{error:s}=await l.from("resources").delete().eq("id",g.value.id);if(r=s,s)console.error(`âŒ åˆ é™¤å¤±è´¥ (${t+1}/${a}):`,s),t<a-1&&await new Promise(o=>setTimeout(o,1e3));else{console.log("âœ… èµ„æºåˆ é™¤æˆåŠŸ");break}}catch(s){console.error(`âŒ åˆ é™¤å¼‚å¸¸ (${t+1}/${a}):`,s),r=s,t<a-1&&await new Promise(o=>setTimeout(o,1e3))}t++}if(r){console.error("âŒ åˆ é™¤èµ„æºæœ€ç»ˆå¤±è´¥:",r);let s="åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•";r.message&&(r.message.includes("Failed to fetch")?s="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•":r.message.includes("permission")?s="æ²¡æœ‰åˆ é™¤æƒé™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜":r.message.includes("row-level security")?s="å®‰å…¨ç­–ç•¥é˜»æ­¢åˆ é™¤ï¼Œè¯·è”ç³»ç®¡ç†å‘˜":s=`åˆ é™¤å¤±è´¥: ${r.message}`),alert(s);return}n.value=n.value.filter(s=>s.id!==g.value.id),h()}catch(l){console.error("âŒ åˆ é™¤èµ„æºæ—¶å‡ºç°æ„å¤–é”™è¯¯:",l),alert("åˆ é™¤è¿‡ç¨‹ä¸­å‡ºç°æ„å¤–é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•")}},D=async()=>{k.value=!0;try{console.log("ğŸ”„ å¼€å§‹åŠ è½½ç”¨æˆ·å…¨éƒ¨èµ„æº...");const l=y.getClient();let t=null;const a=localStorage.getItem("currentUser");if(a){const o=JSON.parse(a);o.id?(t=o.id,console.log("âœ… å½“å‰ç”¨æˆ·ID:",t)):console.error("âŒ ç”¨æˆ·æ•°æ®ä¸­æ²¡æœ‰IDå­—æ®µ:",o)}else console.error("âŒ localStorageä¸­æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯");if(!t){console.error("âŒ ç”¨æˆ·æœªç™»å½•ï¼Œå°†æ˜¾ç¤ºç©ºèµ„æºåˆ—è¡¨"),n.value=[];return}console.log("ğŸ” æŸ¥è¯¢ç”¨æˆ·èµ„æº...");const{data:r,error:s}=await l.from("resources").select("*").eq("created_by",t).order("created_at",{ascending:!1});if(s){console.error("âŒ è·å–æˆ‘çš„èµ„æºå¤±è´¥:",s),n.value=[];return}if(console.log("ğŸ“Š åŸå§‹èµ„æºæ•°æ®:",r),!r||r.length===0){console.log("â„¹ï¸ è¯¥ç”¨æˆ·æ²¡æœ‰åˆ›å»ºä»»ä½•èµ„æº"),n.value=[];return}n.value=r.map(o=>({id:o.id,title:o.title,description:o.description||"",type:o.type||"other",category:o.category,difficulty:o.difficulty,duration:o.duration,provider:o.provider,url:o.url,views:o.views||0,likes:o.likes||0,created_at:o.created_at})),console.log("âœ… æˆåŠŸåŠ è½½æˆ‘çš„èµ„æº:",n.value.length),console.log("ğŸ“‹ æœ€ç»ˆèµ„æºæ•°æ®:",n.value)}catch(l){console.error("âŒ åŠ è½½æˆ‘çš„èµ„æºæ—¶å‡ºé”™:",l),n.value=[]}finally{k.value=!1}};return j(()=>{D()}),(l,t)=>{var a;return i(),d("div",F,[e("div",{class:"flex items-center mb-8"},[e("button",{onClick:f,class:"mr-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[...t[0]||(t[0]=[e("svg",{class:"h-6 w-6 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t[1]||(t[1]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white flex items-center"},[e("svg",{class:"h-8 w-8 mr-3 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})]),u(" æˆ‘çš„å…¨éƒ¨èµ„æº ")]),e("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"ç®¡ç†ä½ åˆ›å»ºçš„æ‰€æœ‰å­¦ä¹ èµ„æº")],-1))]),e("div",L,[e("div",P,[k.value?(i(),d("div",I,[...t[2]||(t[2]=[e("div",{class:"inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-purple-500 hover:bg-purple-400 transition ease-in-out duration-150"},[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),u(" åŠ è½½ä¸­... ")],-1)])])):n.value.length===0?(i(),d("div",q,[t[3]||(t[3]=e("svg",{class:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})],-1)),t[4]||(t[4]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"æš‚æ— åˆ›å»ºçš„èµ„æº",-1)),t[5]||(t[5]=e("p",{class:"text-gray-500 dark:text-gray-400 mb-6"},"æ‚¨è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•å­¦ä¹ èµ„æº",-1)),e("button",{onClick:b,class:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors"}," åˆ›å»ºç¬¬ä¸€ä¸ªèµ„æº ")])):(i(),d("div",H,[(i(!0),d(V,null,z(n.value,r=>(i(),d("div",{key:r.id,class:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer border border-gray-200 dark:border-gray-600",onClick:s=>w(r.id)},[e("div",J,[e("div",O,[e("div",G,[e("h4",K,c(r.title),1),e("span",{class:S(`px-3 py-1 text-xs rounded-full ${C(r.type)}`)},c(r.type),3)]),e("p",Q,c(r.description),1)]),e("button",{onClick:E(s=>M(r),["stop"]),class:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"åˆ é™¤èµ„æº"},[...t[6]||(t[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,W)]),e("div",X,[r.category?(i(),d("div",Y,[t[7]||(t[7]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})],-1)),u(" "+c(r.category),1)])):v("",!0),r.difficulty?(i(),d("div",Z,[t[8]||(t[8]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)),u(" "+c(r.difficulty),1)])):v("",!0),r.duration?(i(),d("div",ee,[t[9]||(t[9]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),u(" "+c(r.duration),1)])):v("",!0),r.provider?(i(),d("div",te,[t[10]||(t[10]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),u(" "+c(r.provider),1)])):v("",!0)]),e("div",re,[e("div",oe,[t[11]||(t[11]=e("svg",{class:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),u(" "+c(_(r.created_at)),1)])])],8,U))),128))]))])]),A(T,{show:x.value,message:`ç¡®å®šè¦åˆ é™¤èµ„æºã€Œ${(a=g.value)==null?void 0:a.title}ã€å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚`,onConfirm:B,onCancel:h},null,8,["show","message"])])}}}),de=N(se,[["__file","E:/å‰ç«¯åˆçº§è¯¾ç¨‹/program/EduMatch/src/views/MyAllResourcesPage.vue"]]);export{de as default};
