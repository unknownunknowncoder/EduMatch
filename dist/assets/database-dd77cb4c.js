import{I as N,r as i,s as c,J as o,K as f}from"./index-9b7d0a80.js";import{supabaseService as r}from"./supabase-2d6ad7e7.js";const x=N("database",()=>{const s=i(!1),a=i(null),u=c(()=>o.status==="connected"),y=c(()=>o.status==="connecting"),d=c(()=>o.status==="error");async function g(e,n){if(!u.value)throw new Error("数据库未连接");s.value=!0,a.value=null;try{return await f.query(e,n)}catch(t){throw a.value=t instanceof Error?t.message:"查询失败",t}finally{s.value=!1}}async function l(){try{const e=r.getClient(),{data:n,error:t}=await e.from("users").select("*");if(t)throw t;return n}catch(e){return console.error("获取用户数据失败:",e),[]}}async function m(e){return r.createUser(e)}async function v(e){return r.getUserByUsername(e)}async function U(e){return r.getUserByEmail(e)}async function h(e){return r.getUserByNickname(e)}async function p(e,n){return r.updateUserNickname(e,n)}async function F(e={}){return r.getResources(e)}async function R(e){return r.getResources({search:e})}async function w(e,n){return r.addLearningRecord({user_id:e,resource_id:n,progress:0})}async function B(e){return r.getLearningRecords(e)}async function E(e){return r.getFavorites(e)}async function L(e,n){return r.addToFavorites(e,n)}async function b(e,n){return r.removeFromFavorites(e,n)}async function k(){await f.init()}return{isLoading:s,error:a,isConnected:u,isConnecting:y,hasError:d,executeQuery:g,getUsers:l,createUser:m,getUserByUsername:v,getUserByEmail:U,getUserByNickname:h,updateUserNickname:p,getResources:F,searchResources:R,addLearningRecord:w,getLearningRecords:B,getFavorites:E,addToFavorites:L,removeFromFavorites:b,reconnect:k}});export{x as useDatabaseStore};
