<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Import Test</title>
</head>
<body>
  <div id="app">
    <h1>Admin System Import Test</h1>
    <div id="status">Testing imports...</div>
    <div id="error-log"></div>
  </div>

  <script type="module">
    const statusEl = document.getElementById('status');
    const errorEl = document.getElementById('error-log');
    
    function log(message, isError = false) {
      const div = document.createElement('div');
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      div.style.color = isError ? 'red' : 'green';
      div.style.margin = '5px 0';
      div.style.padding = '5px';
      div.style.border = isError ? '1px solid red' : '1px solid green';
      div.style.borderRadius = '3px';
      (isError ? errorEl : statusEl).appendChild(div);
    }

    async function testImports() {
      log('å¼€å§‹æµ‹è¯•æ¨¡å—å¯¼å…¥...');
      
      try {
        // æµ‹è¯• Vue
        log('æµ‹è¯• Vue å¯¼å…¥...');
        const { createApp, ref } = await import('/node_modules/vue/dist/vue.esm-browser.js');
        log('âœ… Vue å¯¼å…¥æˆåŠŸ');
        
        // æµ‹è¯• Vue Router
        log('æµ‹è¯• Vue Router å¯¼å…¥...');
        const { createRouter, createWebHistory } = await import('/node_modules/vue-router/dist/vue-router.esm-browser.js');
        log('âœ… Vue Router å¯¼å…¥æˆåŠŸ');
        
        // æµ‹è¯• AdminSystem ç»„ä»¶
        log('æµ‹è¯• AdminSystem ç»„ä»¶å¯¼å…¥...');
        
        // ç”±äºè¿™æ˜¯ä¸€ä¸ª .vue æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å¼€å‘æœåŠ¡å™¨çš„è½¬æ¢æ¥æµ‹è¯•
        const response = await fetch('/src/views/AdminSystem.vue');
        if (response.ok) {
          const vueContent = await response.text();
          log('âœ… AdminSystem.vue æ–‡ä»¶å¯è®¿é—®');
          
          // æ£€æŸ¥æ˜¯å¦åŒ…å«å…³é”®å†…å®¹
          if (vueContent.includes('AdminSystem') && vueContent.includes('template')) {
            log('âœ… AdminSystem.vue å†…å®¹æ ¼å¼æ­£ç¡®');
          } else {
            log('âŒ AdminSystem.vue å†…å®¹æ ¼å¼å¼‚å¸¸', true);
          }
        } else {
          log(`âŒ AdminSystem.vue è®¿é—®å¤±è´¥: ${response.status} ${response.statusText}`, true);
        }
        
        // æµ‹è¯•ä¾èµ–çš„å·¥å…·æ–‡ä»¶
        const dependencies = [
          '/src/utils/adminAuth.ts',
          '/src/utils/message.ts',
          '/src/lib/utils.ts',
          '/src/stores/database.ts'
        ];
        
        for (const dep of dependencies) {
          log(`æµ‹è¯• ${dep}...`);
          try {
            const depResponse = await fetch(dep);
            if (depResponse.ok) {
              log(`âœ… ${dep} å¯è®¿é—®`);
            } else {
              log(`âŒ ${dep} ä¸å¯è®¿é—®: ${depResponse.status}`, true);
            }
          } catch (error) {
            log(`âŒ ${dep} å¯¼å…¥å¤±è´¥: ${error.message}`, true);
          }
        }
        
        // æµ‹è¯•ç»„ä»¶æ–‡ä»¶
        const components = [
          '/src/components/admin/UserManagement.vue',
          '/src/components/admin/ContentManagement.vue',
          '/src/components/admin/PlanManagement.vue',
          '/src/components/admin/ResourceManagement.vue'
        ];
        
        for (const comp of components) {
          log(`æµ‹è¯• ${comp}...`);
          try {
            const compResponse = await fetch(comp);
            if (compResponse.ok) {
              log(`âœ… ${comp} å¯è®¿é—®`);
            } else {
              log(`âŒ ${comp} ä¸å¯è®¿é—®: ${compResponse.status}`, true);
            }
          } catch (error) {
            log(`âŒ ${comp} å¯¼å…¥å¤±è´¥: ${error.message}`, true);
          }
        }
        
        log('ğŸ‰ å¯¼å…¥æµ‹è¯•å®Œæˆï¼');
        
      } catch (error) {
        log(`âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${error.message}`, true);
        console.error('Test error:', error);
      }
    }

    // æ£€æµ‹å¼€å‘æœåŠ¡å™¨ç«¯å£å¹¶æµ‹è¯•
    async function detectAndTest() {
      const ports = [3007, 3008, 3015];
      
      for (const port of ports) {
        try {
          const response = await fetch(`http://localhost:${port}/`, { mode: 'no-cors' });
          log(`æ£€æµ‹åˆ°å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ ${port}`);
          
          // æ›´æ–°æ‰€æœ‰ fetch è¯·æ±‚çš„ç«¯å£
          const originalFetch = window.fetch;
          window.fetch = function(url, options) {
            if (url.startsWith('/')) {
              url = `http://localhost:${port}${url}`;
            }
            return originalFetch(url, options);
          };
          
          await testImports();
          return;
        } catch (error) {
          log(`ç«¯å£ ${port} ä¸å¯è®¿é—®`);
        }
      }
      
      log('âŒ æœªæ£€æµ‹åˆ°è¿è¡Œä¸­çš„å¼€å‘æœåŠ¡å™¨', true);
    }

    // è¿è¡Œæµ‹è¯•
    detectAndTest();
  </script>
</body>
</html>