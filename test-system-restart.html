<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿé‡å¯åŠŸèƒ½æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .log-container {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-gray-900">ç³»ç»Ÿé‡å¯åŠŸèƒ½å®ç°</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">åŠŸèƒ½è¯´æ˜</h2>
            <div class="space-y-3 text-sm text-gray-600">
                <div class="flex items-start">
                    <span class="text-red-600 mr-2">âš ï¸</span>
                    <div><strong>é‡è¦æ“ä½œ</strong>ï¼šé‡å¯ç³»ç»Ÿä¼šå½±å“æ•´ä¸ªåº”ç”¨çš„è¿è¡ŒçŠ¶æ€</div>
                </div>
                <div class="flex items-start">
                    <span class="text-green-600 mr-2">âœ…</span>
                    <div><strong>æ¸…ç†ç¼“å­˜</strong>ï¼šè‡ªåŠ¨æ¸…ç†æµè§ˆå™¨ç¼“å­˜å’Œæœ¬åœ°å­˜å‚¨</div>
                </div>
                <div class="flex items-start">
                    <span class="text-blue-600 mr-2">ğŸ”„</span>
                    <div><strong>é‡æ–°åŠ è½½</strong>ï¼šå¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼Œç›¸å½“äºé‡å¯ç³»ç»Ÿ</div>
                </div>
                <div class="flex items-start">
                    <span class="text-purple-600 mr-2">ğŸ“Š</span>
                    <div><strong>æ“ä½œæ—¥å¿—</strong>ï¼šè®°å½•é‡å¯è¿‡ç¨‹å’Œç»“æœ</div>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">é‡å¯æµç¨‹</h2>
            <div class="space-y-2 text-sm">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">1</div>
                    <span>ç”¨æˆ·ç¡®è®¤ - æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†</span>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">2</div>
                    <span>æ¸…ç†æµè§ˆå™¨ç¼“å­˜</span>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">3</div>
                    <span>æ¸…ç†æœ¬åœ°å­˜å‚¨ï¼ˆä¿ç•™é‡è¦æ•°æ®ï¼‰</span>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">4</div>
                    <span>æ˜¾ç¤ºé‡å¯è¿›åº¦æç¤º</span>
                </div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">5</div>
                    <span>å¼ºåˆ¶é‡æ–°åŠ è½½é¡µé¢</span>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">å®é™…æµ‹è¯•</h2>
            <p class="text-sm text-gray-600 mb-4">
                åœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œç‚¹å‡»"é‡å¯ç³»ç»Ÿ"æŒ‰é’®å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
            </p>
            
            <div class="bg-gray-100 rounded p-4 mb-4">
                <button id="simulateRestart" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-medium w-full">
                    ğŸ”„ æ¨¡æ‹Ÿç³»ç»Ÿé‡å¯ï¼ˆä»…æ¼”ç¤ºï¼Œä¸ä¼šå®é™…é‡å¯ï¼‰
                </button>
            </div>
            
            <div id="restartStatus" class="hidden p-4 rounded-lg">
                <!-- é‡å¯çŠ¶æ€ -->
            </div>
        </div>
        
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
            <h3 class="text-lg font-semibold text-yellow-800 mb-2">ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
            <div class="space-y-2 text-sm text-yellow-700">
                <div>1. åœ¨å®é™…ç³»ç»Ÿä¸­è®¿é—® <code>http://localhost:3012/admin/maintenance</code></div>
                <div>2. ç‚¹å‡»çº¢è‰²çš„"é‡å¯ç³»ç»Ÿ"æŒ‰é’®</div>
                <div>3. ç¡®è®¤é‡å¯æ“ä½œ</div>
                <div>4. ç³»ç»Ÿå°†è‡ªåŠ¨æ‰§è¡Œé‡å¯æµç¨‹</div>
                <div>5. é¡µé¢ä¼šé‡æ–°åŠ è½½ï¼Œç›¸å½“äºç³»ç»Ÿé‡å¯</div>
            </div>
        </div>
    </div>

    <script>
        let logContainer = document.createElement('div');
        logContainer.className = 'log-container bg-gray-900 text-green-400 p-4 rounded text-sm mt-4';
        logContainer.innerHTML = 'ç­‰å¾…æµ‹è¯•å¼€å§‹...\n';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logContainer.innerHTML += logEntry;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }
        
        function showStatus(success, message) {
            const statusEl = document.getElementById('restartStatus');
            statusEl.classList.remove('hidden');
            
            if (success) {
                statusEl.className = 'p-4 rounded-lg bg-green-50 border border-green-200 text-green-800';
                statusEl.innerHTML = `
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="font-medium">é‡å¯åŠŸèƒ½æ­£å¸¸</span>
                    </div>
                    <div class="mt-2 text-sm">${message}</div>
                `;
            } else {
                statusEl.className = 'p-4 rounded-lg bg-red-50 border border-red-200 text-red-800';
                statusEl.innerHTML = `
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="font-medium">åŠŸèƒ½å¼‚å¸¸</span>
                    </div>
                    <div class="mt-2 text-sm">${message}</div>
                `;
            }
        }
        
        // æ¨¡æ‹Ÿé‡å¯åŠŸèƒ½
        document.getElementById('simulateRestart').addEventListener('click', async () => {
            const button = document.getElementById('simulateRestart');
            button.disabled = true;
            button.textContent = 'ğŸ”„ æ¨¡æ‹Ÿé‡å¯ä¸­...';
            
            // æ·»åŠ æ—¥å¿—å®¹å™¨
            const parent = button.parentElement;
            parent.appendChild(logContainer);
            
            log('ğŸ”„ å¼€å§‹æ¨¡æ‹Ÿç³»ç»Ÿé‡å¯...');
            
            try {
                // æ­¥éª¤1ï¼šç¡®è®¤å¯¹è¯æ¡†ï¼ˆæ¨¡æ‹Ÿï¼‰
                log('ğŸ“‹ æ­¥éª¤1: ç”¨æˆ·ç¡®è®¤é‡å¯æ“ä½œ');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥éª¤2ï¼šæ¸…ç†æµè§ˆå™¨ç¼“å­˜
                log('ğŸ—‘ï¸  æ­¥éª¤2: æ¸…ç†æµè§ˆå™¨ç¼“å­˜');
                if ('caches' in window) {
                    try {
                        const cacheNames = await caches.keys();
                        await Promise.all(cacheNames.map(name => caches.delete(name)));
                        log('   âœ… ç¼“å­˜æ¸…ç†å®Œæˆ');
                    } catch (error) {
                        log('   âš ï¸ ç¼“å­˜æ¸…ç†å¤±è´¥ï¼ˆè¿™å¾ˆæ­£å¸¸ï¼‰');
                    }
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥éª¤3ï¼šæ¸…ç†æœ¬åœ°å­˜å‚¨
                log('ğŸ’¾ æ­¥éª¤3: æ¸…ç†æœ¬åœ°å­˜å‚¨');
                try {
                    // ä¿å­˜é‡è¦æ•°æ®
                    const importantData = {
                        currentUser: localStorage.getItem('currentUser'),
                        adminUser: localStorage.getItem('adminUserInfo')
                    };
                    
                    // æ¸…ç†æ‰€æœ‰å­˜å‚¨
                    localStorage.clear();
                    sessionStorage.clear();
                    
                    // æ¢å¤é‡è¦æ•°æ®
                    if (importantData.currentUser) localStorage.setItem('currentUser', importantData.currentUser);
                    if (importantData.adminUser) localStorage.setItem('adminUserInfo', importantData.adminUser);
                    
                    log('   âœ… æœ¬åœ°å­˜å‚¨æ¸…ç†å®Œæˆ');
                } catch (error) {
                    log('   âš ï¸ æœ¬åœ°å­˜å‚¨æ¸…ç†å¤±è´¥');
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ­¥éª¤4ï¼šå‡†å¤‡é‡å¯
                log('âš¡ æ­¥éª¤4: å‡†å¤‡é‡å¯ç³»ç»Ÿ');
                log('   ğŸ“¢ ç³»ç»Ÿå°†åœ¨3ç§’åé‡å¯...');
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // æ­¥éª¤5ï¼šæ¨¡æ‹Ÿé‡å¯å®Œæˆ
                log('ğŸ”„ æ­¥éª¤5: æ‰§è¡Œç³»ç»Ÿé‡å¯');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log('âœ… ç³»ç»Ÿé‡å¯æ¨¡æ‹Ÿå®Œæˆï¼');
                log('ğŸ“Š é‡å¯ç»Ÿè®¡:');
                log('   - ç¼“å­˜æ¸…ç†: å·²å®Œæˆ');
                log('   - æœ¬åœ°å­˜å‚¨: å·²æ¸…ç†');
                log('   - é¡µé¢é‡è½½: æ¨¡æ‹Ÿå®Œæˆ');
                
                showStatus(true, 'é‡å¯åŠŸèƒ½æ¨¡æ‹ŸæˆåŠŸï¼åœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œé¡µé¢ä¼šé‡æ–°åŠ è½½ã€‚');
                
            } catch (error) {
                log(`âŒ æ¨¡æ‹Ÿé‡å¯å¤±è´¥: ${error.message}`);
                showStatus(false, `é‡å¯åŠŸèƒ½å¼‚å¸¸: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'ğŸ”„ æ¨¡æ‹Ÿç³»ç»Ÿé‡å¯ï¼ˆä»…æ¼”ç¤ºï¼Œä¸ä¼šå®é™…é‡å¯ï¼‰';
            }
        });
    </script>
</body>
</html>