# ğŸš¨ 504 è¶…æ—¶é”™è¯¯ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°
éƒ¨ç½²åå‡ºç°504è¶…æ—¶é”™è¯¯ï¼š
```
chat:1   Failed to load resource: the server responded with a status of 504 ()
Description: Too much time has passed without sending any data for document.
```

## æ ¹æœ¬åŸå› 
1. **Netlify Functions é»˜è®¤è¶…æ—¶æ—¶é—´**: 10ç§’
2. **æ‰£å­APIå“åº”æ…¢**: æœ‰æ—¶éœ€è¦è¶…è¿‡10ç§’
3. **ç½‘ç»œå»¶è¿Ÿ**: APIè°ƒç”¨æ—¶é—´è¶…è¿‡é¢„æœŸ
4. **å¤æ‚çš„æ•°æ®è§£æ**: å¢åŠ äº†å¤„ç†æ—¶é—´

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. åˆ›å»ºä¼˜åŒ–ç‰ˆAPI Function
- **æ–‡ä»¶**: `netlify/functions/coze-api-timeout.js`
- **ç‰¹ç‚¹**: 
  - 25ç§’è¯·æ±‚è¶…æ—¶
  - AbortController æ§åˆ¶è¶…æ—¶
  - è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
  - ä¼˜é›…çš„é”™è¯¯å¤„ç†

### 2. åˆ›å»ºç®€åŒ–ç‰ˆAPI Function  
- **æ–‡ä»¶**: `netlify/functions/coze-simple.js`
- **ç‰¹ç‚¹**:
  - 15ç§’è¶…æ—¶é™åˆ¶
  - ç®€åŒ–çš„æ•°æ®æ ¼å¼
  - åå¤‡æ•°æ®æœºåˆ¶
  - å¿«é€Ÿå“åº”

### 3. æ›´æ–°Netlifyé…ç½®
- **æ–‡ä»¶**: `netlify.toml`
- **æ”¹è¿›**:
  - Functionè¶…æ—¶æ—¶é—´å¢åŠ åˆ°30ç§’
  - é‡å®šå‘åˆ°ä¼˜åŒ–ç‰ˆFunction
  - ç¯å¢ƒå˜é‡ä¼˜åŒ–

### 4. å‰ç«¯é”™è¯¯å¤„ç†ä¼˜åŒ–
- **æ–‡ä»¶**: `src/services/coze-api-prod.ts`
- **æ”¹è¿›**:
  - è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
  - å“åº”æ—¶é—´ç›‘æ§
  - æ›´å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

## ğŸ“Š ä¿®å¤åçš„APIæµç¨‹

### ç”Ÿäº§ç¯å¢ƒæµç¨‹
```
ç”¨æˆ·æŸ¥è¯¢ â†’ coze-simple.js (15sè¶…æ—¶) â†’ æ‰£å­API â†’ è§£æå“åº” â†’ è¿”å›æ•°æ®
```

### é”™è¯¯å¤„ç†æµç¨‹
```
APIè¶…æ—¶ â†’ è¿”å›åå¤‡æ•°æ® â†’ ç”¨æˆ·æ”¶åˆ°åŸºæœ¬æ¨è â†’ ä¸ä¸­æ–­ä½“éªŒ
```

## ğŸ”§ å…³é”®é…ç½®å˜æ›´

### netlify.toml
```toml
[functions]
  [functions."coze-simple"]
    timeout = 30

[[redirects]]
  from = "/api/coze/*"
  to = "/.netlify/functions/coze-simple"
  status = 200
```

### coze-simple.js
```javascript
// 15ç§’è¶…æ—¶æ§åˆ¶
const controller = new AbortController();
const timeout = setTimeout(() => controller.abort(), 15000);

// åå¤‡æ•°æ®æœºåˆ¶
if (!cozeResponse.ok) {
  return {
    data: { /* é»˜è®¤æ¨èæ•°æ® */ },
    fallback: true
  };
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å“åº”æ—¶é—´ç›®æ ‡
- **æ­£å¸¸å“åº”**: < 10ç§’
- **è¶…æ—¶é™åˆ¶**: 15ç§’  
- **åå¤‡å“åº”**: < 1ç§’

### 2. é”™è¯¯æ¢å¤
- âœ… APIè¶…æ—¶ â†’ è¿”å›é»˜è®¤æ¨è
- âœ… ç½‘ç»œé”™è¯¯ â†’ è¿”å›æœ¬åœ°æ•°æ®
- âœ… è§£æå¤±è´¥ â†’ ä½¿ç”¨ç®€åŒ–æ ¼å¼

### 3. ç”¨æˆ·ä½“éªŒ
- âœ… æ— ä¸­æ–­ä½“éªŒ
- âœ… å¿«é€Ÿåé¦ˆ
- âœ… æ¸…æ™°é”™è¯¯æç¤º

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. æœ¬åœ°æµ‹è¯•
```bash
# å¯åŠ¨æœ¬åœ°Functions
netlify dev

# æµ‹è¯•API
curl -X POST http://localhost:8888/api/chat \
  -H "Content-Type: application/json" \
  -d '{"query":"Vue.js"}'
```

### 2. ç”Ÿäº§ç¯å¢ƒæµ‹è¯•
- è®¿é—®å·²éƒ¨ç½²çš„ç½‘ç«™
- æµ‹è¯•AIæœç´¢åŠŸèƒ½
- æ£€æŸ¥Netlify Functionsæ—¥å¿—

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### ç«‹å³éƒ¨ç½²
- [x] åˆ›å»º `coze-simple.js` Function
- [x] æ›´æ–° `netlify.toml` é…ç½®
- [x] ä¼˜åŒ–å‰ç«¯é”™è¯¯å¤„ç†
- [x] æ·»åŠ è¶…æ—¶æ§åˆ¶æœºåˆ¶

### éªŒè¯æ­¥éª¤
1. æäº¤ä»£ç åˆ°Git
2. è§¦å‘Netlifyè‡ªåŠ¨éƒ¨ç½²
3. æµ‹è¯•AIæœç´¢åŠŸèƒ½
4. æ£€æŸ¥Functionæ‰§è¡Œæ—¥å¿—
5. éªŒè¯å“åº”æ—¶é—´ < 15ç§’

## ğŸ”„ åç»­ä¼˜åŒ–

### çŸ­æœŸä¼˜åŒ–
- ç›‘æ§APIå“åº”æ—¶é—´
- æ”¶é›†ç”¨æˆ·åé¦ˆ
- è°ƒæ•´è¶…æ—¶å‚æ•°

### é•¿æœŸä¼˜åŒ–  
- è€ƒè™‘ä½¿ç”¨æ‰£å­æµå¼API
- å®ç°æœ¬åœ°ç¼“å­˜æœºåˆ¶
- æ·»åŠ å¤šä¸ªAIæœåŠ¡å¤‡é€‰

## ğŸ¯ é¢„æœŸæ•ˆæœ

ä¿®å¤åé¢„æœŸï¼š
- âœ… æ¶ˆé™¤504è¶…æ—¶é”™è¯¯
- âœ… å“åº”æ—¶é—´ç¨³å®šåœ¨15ç§’å†…
- âœ… ç”¨æˆ·ä½“éªŒæ— ä¸­æ–­
- âœ… é”™è¯¯å¤„ç†æ›´å‹å¥½

---

## ğŸš€ ç«‹å³è¡ŒåŠ¨

1. **æäº¤ä¿®æ”¹**:
```bash
git add .
git commit -m "ä¿®å¤504è¶…æ—¶é”™è¯¯ - ä¼˜åŒ–APIè°ƒç”¨"
git push origin main
```

2. **éƒ¨ç½²éªŒè¯**:
- ç­‰å¾…Netlifyè‡ªåŠ¨éƒ¨ç½²å®Œæˆ
- æµ‹è¯•AIæœç´¢åŠŸèƒ½
- ç¡®è®¤ä¸å†å‡ºç°504é”™è¯¯

3. **ç›‘æ§çŠ¶æ€**:
- æŸ¥çœ‹Netlify Functionsæ—¥å¿—
- ç›‘æ§APIå“åº”æ—¶é—´
- æ”¶é›†ç”¨æˆ·ä½¿ç”¨åé¦ˆ

ä¿®å¤å®Œæˆåï¼ŒAIåŠ©æ‰‹åŠŸèƒ½åº”è¯¥èƒ½å¤Ÿç¨³å®šå·¥ä½œï¼Œä¸å†å‡ºç°504è¶…æ—¶é”™è¯¯ï¼