<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»´æŠ¤æ—¥å¿—æŒä¹…åŒ–æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .log-container {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-gray-900">ç»´æŠ¤æ—¥å¿—æŒä¹…åŒ–æµ‹è¯•</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">åŠŸèƒ½è¯´æ˜</h2>
            <div class="space-y-2 text-sm text-gray-600">
                <div>âœ… <strong>æŒä¹…åŒ–å­˜å‚¨</strong>: ç»´æŠ¤æ—¥å¿—ä¿å­˜åœ¨localStorageä¸­</div>
                <div>âœ… <strong>é¡µé¢åˆ·æ–°ä¿ç•™</strong>: åˆ·æ–°é¡µé¢åæ—¥å¿—ä»ç„¶å­˜åœ¨</div>
                <div>âœ… <strong>é‡æ–°ç™»å½•ä¿ç•™</strong>: é€€å‡ºç™»å½•åé‡æ–°ç™»å½•ï¼Œæ—¥å¿—ä»ç„¶å­˜åœ¨</div>
                <div>âœ… <strong>ç³»ç»Ÿé‡å¯ä¿ç•™</strong>: ç³»ç»Ÿé‡å¯æ—¶è‡ªåŠ¨ä¿ç•™ç»´æŠ¤æ—¥å¿—</div>
                <div>âœ… <strong>æ—¥å¿—æ•°é‡é™åˆ¶</strong>: æœ€å¤šä¿å­˜100æ¡æ—¥å¿—è®°å½•</div>
            </div>
        </div>
        
        <div class="grid grid-cols-2 gap-6">
            <!-- æ“ä½œé¢æ¿ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">æµ‹è¯•æ“ä½œ</h2>
                
                <div class="space-y-4">
                    <button id="addLog" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        â• æ·»åŠ æµ‹è¯•æ—¥å¿—
                    </button>
                    
                    <button id="showLogs" class="w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        ğŸ“‹ æ˜¾ç¤ºå½“å‰æ—¥å¿—
                    </button>
                    
                    <button id="clearLogs" class="w-full bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                        ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ—¥å¿—
                    </button>
                    
                    <button id="simulateRefresh" class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                        ğŸ”„ æ¨¡æ‹Ÿé¡µé¢åˆ·æ–°
                    </button>
                    
                    <button id="checkStorage" class="w-full bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
                        ğŸ’¾ æ£€æŸ¥æœ¬åœ°å­˜å‚¨
                    </button>
                </div>
                
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="mt-6 p-4 bg-gray-50 rounded">
                    <h3 class="font-semibold mb-2">æ—¥å¿—ç»Ÿè®¡</h3>
                    <div class="space-y-1 text-sm">
                        <div>æ—¥å¿—æ•°é‡: <span id="logCount" class="font-bold">0</span></div>
                        <div>å­˜å‚¨å¤§å°: <span id="storageSize" class="font-bold">0</span> å­—èŠ‚</div>
                        <div>æœ€åæ›´æ–°: <span id="lastUpdate" class="font-bold">-</span></div>
                    </div>
                </div>
            </div>
            
            <!-- æ—¥å¿—æ˜¾ç¤º -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">ç»´æŠ¤æ—¥å¿—</h2>
                
                <div id="logsList" class="space-y-2 max-h-96 overflow-y-auto">
                    <div class="text-gray-500 text-center py-8">
                        æš‚æ— æ—¥å¿—ï¼Œç‚¹å‡»"æ·»åŠ æµ‹è¯•æ—¥å¿—"å¼€å§‹
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="mt-6 bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">æ“ä½œæ—¥å¿—</h2>
            <div id="testLog" class="log-container bg-gray-900 text-green-400 p-4 rounded text-sm">
                ç­‰å¾…æ“ä½œ...
            </div>
        </div>
    </div>

    <script>
        // æ—¥å¿—ç±»å‹
        const LOG_TYPES = {
            'clear-cache': { title: 'æ¸…ç†ç¼“å­˜', icon: 'ğŸ—‘ï¸' },
            'export-data': { title: 'æ•°æ®å¯¼å‡º', icon: 'ğŸ“Š' },
            'restart-system': { title: 'ç³»ç»Ÿé‡å¯', icon: 'ğŸ”„' },
            'test': { title: 'æµ‹è¯•æ“ä½œ', icon: 'ğŸ§ª' }
        };

        // æµ‹è¯•æ—¥å¿—
        function testLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            const logEl = document.getElementById('testLog');
            logEl.innerHTML += logEntry;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }

        // åŠ è½½ç»´æŠ¤æ—¥å¿—
        function loadMaintenanceLogs() {
            try {
                const savedLogs = localStorage.getItem('maintenanceLogs');
                if (savedLogs) {
                    const parsedLogs = JSON.parse(savedLogs);
                    if (Array.isArray(parsedLogs)) {
                        testLog(`âœ… å·²åŠ è½½ ${parsedLogs.length} æ¡ç»´æŠ¤æ—¥å¿—`);
                        return parsedLogs;
                    }
                }
                testLog('â„¹ï¸ æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„ç»´æŠ¤æ—¥å¿—');
                return [];
            } catch (error) {
                testLog(`âŒ åŠ è½½ç»´æŠ¤æ—¥å¿—å¤±è´¥: ${error.message}`);
                return [];
            }
        }

        // ä¿å­˜ç»´æŠ¤æ—¥å¿—
        function saveMaintenanceLogs(logs) {
            try {
                localStorage.setItem('maintenanceLogs', JSON.stringify(logs));
                testLog(`ğŸ’¾ å·²ä¿å­˜ ${logs.length} æ¡ç»´æŠ¤æ—¥å¿—åˆ°æœ¬åœ°å­˜å‚¨`);
                updateStats();
            } catch (error) {
                testLog(`âŒ ä¿å­˜ç»´æŠ¤æ—¥å¿—å¤±è´¥: ${error.message}`);
            }
        }

        // æ·»åŠ ç»´æŠ¤æ—¥å¿—
        function addMaintenanceLog(type, title, description, status = 'success') {
            const logs = loadMaintenanceLogs();
            
            const newLog = {
                id: Date.now().toString(),
                type,
                title,
                description,
                status,
                timestamp: new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                })
            };
            
            logs.unshift(newLog);
            
            // ä¿æŒæœ€å¤š100æ¡æ—¥å¿—
            if (logs.length > 100) {
                const removed = logs.length - 100;
                logs.splice(100);
                testLog(`âš ï¸ æ—¥å¿—æ•°é‡è¶…é™ï¼Œå·²åˆ é™¤æœ€æ—©çš„ ${removed} æ¡è®°å½•`);
            }
            
            saveMaintenanceLogs(logs);
            displayLogs();
            testLog(`â• æ·»åŠ æ–°æ—¥å¿—: ${title} (${status})`);
        }

        // æ˜¾ç¤ºæ—¥å¿—
        function displayLogs() {
            const logs = loadMaintenanceLogs();
            const container = document.getElementById('logsList');
            
            if (logs.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-8">æš‚æ— æ—¥å¿—ï¼Œç‚¹å‡»"æ·»åŠ æµ‹è¯•æ—¥å¿—"å¼€å§‹</div>';
                return;
            }
            
            container.innerHTML = logs.map(log => {
                const typeInfo = LOG_TYPES[log.type] || { title: log.type, icon: 'ğŸ“' };
                const statusColor = log.status === 'success' ? 'green' : 'red';
                const statusIcon = log.status === 'success' ? 'âœ…' : 'âŒ';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-3 hover:bg-gray-50">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-2">
                                <span class="text-lg">${typeInfo.icon}</span>
                                <div class="flex-1">
                                    <div class="font-medium text-gray-900">${log.title}</div>
                                    <div class="text-sm text-gray-600 mt-1">${log.description}</div>
                                    <div class="text-xs text-gray-500 mt-2">
                                        ${typeInfo.title} Â· ${log.timestamp} Â· ${statusIcon} ${log.status}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const logs = loadMaintenanceLogs();
            const storageData = localStorage.getItem('maintenanceLogs') || '';
            
            document.getElementById('logCount').textContent = logs.length;
            document.getElementById('storageSize').textContent = storageData.length;
            
            if (logs.length > 0) {
                const lastLog = logs[0];
                document.getElementById('lastUpdate').textContent = lastLog.timestamp;
            } else {
                document.getElementById('lastUpdate').textContent = '-';
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('addLog').addEventListener('click', () => {
            const testTypes = ['clear-cache', 'export-data', 'restart-system', 'test'];
            const randomType = testTypes[Math.floor(Math.random() * testTypes.length)];
            const testMessages = [
                'è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ—¥å¿—ï¼Œç”¨äºéªŒè¯æŒä¹…åŒ–åŠŸèƒ½',
                'æ¨¡æ‹Ÿç¼“å­˜æ¸…ç†æ“ä½œå®Œæˆ',
                'æ¨¡æ‹Ÿæ•°æ®å¯¼å‡ºæ“ä½œæˆåŠŸ',
                'æ¨¡æ‹Ÿç³»ç»Ÿé‡å¯æ“ä½œå®Œæˆ',
                'æµ‹è¯•æ—¥å¿—æŒä¹…åŒ–å­˜å‚¨åŠŸèƒ½'
            ];
            const randomMessage = testMessages[Math.floor(Math.random() * testMessages.length)];
            
            addMaintenanceLog(randomType, 'æµ‹è¯•æ“ä½œ', randomMessage, 'success');
        });

        document.getElementById('showLogs').addEventListener('click', () => {
            displayLogs();
            testLog('ğŸ“‹ å·²åˆ·æ–°æ—¥å¿—æ˜¾ç¤º');
        });

        document.getElementById('clearLogs').addEventListener('click', () => {
            const confirmed = confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç»´æŠ¤æ—¥å¿—å—ï¼Ÿ\n\næ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰å†å²ç»´æŠ¤è®°å½•ï¼Œä¸”æ— æ³•æ¢å¤ã€‚');
            
            if (confirmed) {
                localStorage.removeItem('maintenanceLogs');
                displayLogs();
                updateStats();
                testLog('ğŸ—‘ï¸ ç»´æŠ¤æ—¥å¿—å·²æ¸…ç©º');
            }
        });

        document.getElementById('simulateRefresh').addEventListener('click', () => {
            testLog('ğŸ”„ æ¨¡æ‹Ÿé¡µé¢åˆ·æ–°...');
            setTimeout(() => {
                displayLogs();
                updateStats();
                testLog('âœ… é¡µé¢"åˆ·æ–°"å®Œæˆï¼Œæ—¥å¿—åº”è¯¥ä»ç„¶å­˜åœ¨');
            }, 1000);
        });

        document.getElementById('checkStorage').addEventListener('click', () => {
            const storageData = localStorage.getItem('maintenanceLogs');
            if (storageData) {
                testLog(`ğŸ’¾ æœ¬åœ°å­˜å‚¨ä¸­çš„ç»´æŠ¤æ—¥å¿—æ•°æ®å¤§å°: ${storageData.length} å­—èŠ‚`);
                testLog(`ğŸ“Š æ•°æ®å†…å®¹é¢„è§ˆ: ${storageData.substring(0, 100)}...`);
            } else {
                testLog('ğŸ’¾ æœ¬åœ°å­˜å‚¨ä¸­æ²¡æœ‰ç»´æŠ¤æ—¥å¿—æ•°æ®');
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            testLog('ğŸš€ ç»´æŠ¤æ—¥å¿—æŒä¹…åŒ–æµ‹è¯•é¡µé¢å·²åŠ è½½');
            displayLogs();
            updateStats();
            testLog('ğŸ“Š åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰æ—¥å¿—çŠ¶æ€å·²æ˜¾ç¤º');
        });
    </script>
</body>
</html>